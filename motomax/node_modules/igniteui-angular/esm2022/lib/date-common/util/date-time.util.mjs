import { DatePart } from '../../directives/date-time-editor/date-time-editor.common';
import { formatDate, FormatWidth, getLocaleDateFormat } from '@angular/common';
import { isDate } from '../../core/utils';
import { DataType } from '../../data-operations/data-util';
const TIME_CHARS = ['h', 'H', 'm', 's', 'S', 't', 'T', 'a'];
const DATE_CHARS = ['d', 'D', 'M', 'y', 'Y'];
/** Maps of the pre-defined date-time format options supported by the Angular DatePipe
 * - predefinedNumericFormats resolve to numeric parts only (and period) for the default 'en' culture
 * - predefinedNonNumericFormats usually contain non-numeric date/time parts, which cannot be
 *   handled for editing by the date/time editors
 *  Ref: https://angular.dev/api/common/DatePipe?tab=usage-notes
 * @hidden
 */
const predefinedNumericFormats = new Map([
    ['short', ["month" /* DateParts.Month */, "day" /* DateParts.Day */, "year" /* DateParts.Year */, "hour" /* DateParts.Hour */, "minute" /* DateParts.Minute */]],
    ['shortDate', ["month" /* DateParts.Month */, "day" /* DateParts.Day */, "year" /* DateParts.Year */]],
    ['shortTime', ["hour" /* DateParts.Hour */, "minute" /* DateParts.Minute */]],
    ['mediumTime', ["hour" /* DateParts.Hour */, "minute" /* DateParts.Minute */, "second" /* DateParts.Second */]],
]);
const predefinedNonNumericFormats = new Set([
    'medium', 'long', 'full', 'mediumDate', 'longDate', 'fullDate', 'longTime', 'fullTime',
]);
/** @hidden */
export class DateTimeUtil {
    static { this.DEFAULT_INPUT_FORMAT = 'MM/dd/yyyy'; }
    static { this.DEFAULT_TIME_INPUT_FORMAT = 'hh:mm tt'; }
    static { this.SEPARATOR = 'literal'; }
    static { this.DEFAULT_LOCALE = 'en'; }
    /**
     * Parse a Date value from masked string input based on determined date parts
     *
     * @param inputData masked value to parse
     * @param dateTimeParts Date parts array for the mask
     */
    static parseValueFromMask(inputData, dateTimeParts, promptChar) {
        const parts = {};
        dateTimeParts.forEach(dp => {
            let value = parseInt(DateTimeUtil.getCleanVal(inputData, dp, promptChar), 10);
            if (!value) {
                value = dp.type === DatePart.Date || dp.type === DatePart.Month ? 1 : 0;
            }
            parts[dp.type] = value;
        });
        parts[DatePart.Month] -= 1;
        if (parts[DatePart.Month] < 0 || 11 < parts[DatePart.Month]) {
            return null;
        }
        // TODO: Century threshold
        if (parts[DatePart.Year] < 50) {
            parts[DatePart.Year] += 2000;
        }
        if (parts[DatePart.Date] > DateTimeUtil.daysInMonth(parts[DatePart.Year], parts[DatePart.Month])) {
            return null;
        }
        if (parts[DatePart.Hours] > 23 || parts[DatePart.Minutes] > 59
            || parts[DatePart.Seconds] > 59 || parts[DatePart.FractionalSeconds] > 999) {
            return null;
        }
        const amPm = dateTimeParts.find(p => p.type === DatePart.AmPm);
        if (amPm) {
            parts[DatePart.Hours] %= 12;
        }
        if (amPm) {
            const cleanVal = DateTimeUtil.getCleanVal(inputData, amPm, promptChar);
            if (DateTimeUtil.isPm(cleanVal)) {
                parts[DatePart.Hours] += 12;
            }
        }
        return new Date(parts[DatePart.Year] || 2000, parts[DatePart.Month] || 0, parts[DatePart.Date] || 1, parts[DatePart.Hours] || 0, parts[DatePart.Minutes] || 0, parts[DatePart.Seconds] || 0, parts[DatePart.FractionalSeconds] || 0);
    }
    /** Parse the mask into date/time and literal parts */
    static parseDateTimeFormat(mask, locale) {
        const format = mask || DateTimeUtil.getDefaultInputFormat(locale);
        const dateTimeParts = [];
        const formatArray = Array.from(format);
        let currentPart = null;
        let position = 0;
        let lastPartAdded = false;
        for (let i = 0; i < formatArray.length; i++, position++) {
            const type = DateTimeUtil.determineDatePart(formatArray[i]);
            if (currentPart) {
                if (currentPart.type === type) {
                    currentPart.format += formatArray[i];
                    if (i < formatArray.length - 1) {
                        continue;
                    }
                }
                if (currentPart.type === DatePart.AmPm && currentPart.format.indexOf('a') !== -1) {
                    currentPart = DateTimeUtil.simplifyAmPmFormat(currentPart);
                }
                DateTimeUtil.addCurrentPart(currentPart, dateTimeParts);
                lastPartAdded = true;
                position = currentPart.end;
                if (i === formatArray.length - 1 && currentPart.type !== type) {
                    lastPartAdded = false;
                }
            }
            currentPart = {
                start: position,
                end: position + formatArray[i].length,
                type,
                format: formatArray[i]
            };
        }
        // make sure the last member of a format like H:m:s is not omitted
        if (!lastPartAdded) {
            if (currentPart.type === DatePart.AmPm) {
                currentPart = DateTimeUtil.simplifyAmPmFormat(currentPart);
            }
            DateTimeUtil.addCurrentPart(currentPart, dateTimeParts);
        }
        // formats like "y" or "yyy" are treated like "yyyy" while editing
        const yearPart = dateTimeParts.filter(p => p.type === DatePart.Year)[0];
        if (yearPart && yearPart.format !== 'yy') {
            yearPart.end += 4 - yearPart.format.length;
            yearPart.format = 'yyyy';
        }
        return dateTimeParts;
    }
    /** Simplifies the AmPm part to as many chars as will be displayed */
    static simplifyAmPmFormat(currentPart) {
        currentPart.format = currentPart.format.length === 5 ? 'a' : 'aa';
        currentPart.end = currentPart.start + currentPart.format.length;
        return { ...currentPart };
    }
    static getPartValue(value, datePartInfo, partLength) {
        let maskedValue;
        const datePart = datePartInfo.type;
        switch (datePart) {
            case DatePart.Date:
                maskedValue = value.getDate();
                break;
            case DatePart.Month:
                // months are zero based
                maskedValue = value.getMonth() + 1;
                break;
            case DatePart.Year:
                if (partLength === 2) {
                    maskedValue = this.prependValue(parseInt(value.getFullYear().toString().slice(-2), 10), partLength, '0');
                }
                else {
                    maskedValue = value.getFullYear();
                }
                break;
            case DatePart.Hours:
                if (datePartInfo.format.indexOf('h') !== -1) {
                    maskedValue = this.prependValue(this.toTwelveHourFormat(value.getHours().toString()), partLength, '0');
                }
                else {
                    maskedValue = value.getHours();
                }
                break;
            case DatePart.Minutes:
                maskedValue = value.getMinutes();
                break;
            case DatePart.Seconds:
                maskedValue = value.getSeconds();
                break;
            case DatePart.FractionalSeconds:
                maskedValue = value.getMilliseconds();
                break;
            case DatePart.AmPm:
                maskedValue = DateTimeUtil.getAmPmValue(partLength, value.getHours() < 12);
                break;
        }
        if (datePartInfo.type !== DatePart.AmPm && datePartInfo.type !== DatePart.Literal) {
            return this.prependValue(maskedValue, partLength, '0');
        }
        return maskedValue;
    }
    /** Returns the AmPm part value depending on the part length and a
     * conditional expression indicating whether the value is AM or PM.
     */
    static getAmPmValue(partLength, isAm) {
        if (isAm) {
            return partLength === 1 ? "a" /* AmPmValues.A */ : "AM" /* AmPmValues.AM */;
        }
        else {
            return partLength === 1 ? "p" /* AmPmValues.P */ : "PM" /* AmPmValues.PM */;
        }
    }
    /** Returns true if a string value indicates an AM period */
    static isAm(value) {
        value = value.toLowerCase();
        return (value === "AM" /* AmPmValues.AM */.toLowerCase() || value === "a" /* AmPmValues.A */.toLowerCase());
    }
    /** Returns true if a string value indicates a PM period */
    static isPm(value) {
        value = value.toLowerCase();
        return (value === "PM" /* AmPmValues.PM */.toLowerCase() || value === "p" /* AmPmValues.P */.toLowerCase());
    }
    /** Builds a date-time editor's default input format based on provided locale settings and data type. */
    static getDefaultInputFormat(locale, dataType = DataType.Date) {
        locale = locale || DateTimeUtil.DEFAULT_LOCALE;
        if (!Intl || !Intl.DateTimeFormat || !Intl.DateTimeFormat.prototype.formatToParts) {
            // TODO: fallback with Intl.format for IE?
            return DateTimeUtil.DEFAULT_INPUT_FORMAT;
        }
        const parts = DateTimeUtil.getDefaultLocaleMask(locale, dataType);
        parts.forEach(p => {
            if (p.type !== DatePart.Year && p.type !== DateTimeUtil.SEPARATOR && p.type !== DatePart.AmPm) {
                p.formatType = "2-digit" /* FormatDesc.TwoDigits */;
            }
        });
        return DateTimeUtil.getMask(parts);
    }
    /** Tries to format a date using Angular's DatePipe. Fallbacks to `Intl` if no locale settings have been loaded. */
    static formatDate(value, format, locale, timezone) {
        let formattedDate;
        try {
            formattedDate = formatDate(value, format, locale, timezone);
        }
        catch {
            DateTimeUtil.logMissingLocaleSettings(locale);
            const formatter = new Intl.DateTimeFormat(locale);
            formattedDate = formatter.format(value);
        }
        return formattedDate;
    }
    /**
     * Returns the date format based on a provided locale.
     * Supports Angular's DatePipe format options such as `shortDate`, `longDate`.
     */
    static getLocaleDateFormat(locale, displayFormat) {
        const formatKeys = Object.keys(FormatWidth);
        const targetKey = formatKeys.find(k => k.toLowerCase() === displayFormat?.toLowerCase().replace('date', ''));
        if (!targetKey) {
            // if displayFormat is not shortDate, longDate, etc.
            // or if it is not set by the user
            return displayFormat;
        }
        let format;
        try {
            format = getLocaleDateFormat(locale, FormatWidth[targetKey]);
        }
        catch {
            DateTimeUtil.logMissingLocaleSettings(locale);
            format = DateTimeUtil.getDefaultInputFormat(locale);
        }
        return format;
    }
    /** Determines if a given character is `d/M/y` or `h/m/s`. */
    static isDateOrTimeChar(char) {
        return DATE_CHARS.indexOf(char) !== -1 || TIME_CHARS.indexOf(char) !== -1;
    }
    /** Spins the date portion in a date-time editor. */
    static spinDate(delta, newDate, spinLoop) {
        const maxDate = DateTimeUtil.daysInMonth(newDate.getFullYear(), newDate.getMonth());
        let date = newDate.getDate() + delta;
        if (date > maxDate) {
            date = spinLoop ? date % maxDate : maxDate;
        }
        else if (date < 1) {
            date = spinLoop ? maxDate + (date % maxDate) : 1;
        }
        newDate.setDate(date);
    }
    /** Spins the month portion in a date-time editor. */
    static spinMonth(delta, newDate, spinLoop) {
        const maxDate = DateTimeUtil.daysInMonth(newDate.getFullYear(), newDate.getMonth() + delta);
        if (newDate.getDate() > maxDate) {
            newDate.setDate(maxDate);
        }
        const maxMonth = 11;
        const minMonth = 0;
        let month = newDate.getMonth() + delta;
        if (month > maxMonth) {
            month = spinLoop ? (month % maxMonth) - 1 : maxMonth;
        }
        else if (month < minMonth) {
            month = spinLoop ? maxMonth + (month % maxMonth) + 1 : minMonth;
        }
        newDate.setMonth(month);
    }
    /** Spins the year portion in a date-time editor. */
    static spinYear(delta, newDate) {
        const maxDate = DateTimeUtil.daysInMonth(newDate.getFullYear() + delta, newDate.getMonth());
        if (newDate.getDate() > maxDate) {
            // clip to max to avoid leap year change shifting the entire value
            newDate.setDate(maxDate);
        }
        newDate.setFullYear(newDate.getFullYear() + delta);
    }
    /** Spins the hours portion in a date-time editor. */
    static spinHours(delta, newDate, spinLoop) {
        const maxHour = 23;
        const minHour = 0;
        let hours = newDate.getHours() + delta;
        if (hours > maxHour) {
            hours = spinLoop ? hours % maxHour - 1 : maxHour;
        }
        else if (hours < minHour) {
            hours = spinLoop ? maxHour + (hours % maxHour) + 1 : minHour;
        }
        newDate.setHours(hours);
    }
    /** Spins the minutes portion in a date-time editor. */
    static spinMinutes(delta, newDate, spinLoop) {
        const maxMinutes = 59;
        const minMinutes = 0;
        let minutes = newDate.getMinutes() + delta;
        if (minutes > maxMinutes) {
            minutes = spinLoop ? minutes % maxMinutes - 1 : maxMinutes;
        }
        else if (minutes < minMinutes) {
            minutes = spinLoop ? maxMinutes + (minutes % maxMinutes) + 1 : minMinutes;
        }
        newDate.setMinutes(minutes);
    }
    /** Spins the seconds portion in a date-time editor. */
    static spinSeconds(delta, newDate, spinLoop) {
        const maxSeconds = 59;
        const minSeconds = 0;
        let seconds = newDate.getSeconds() + delta;
        if (seconds > maxSeconds) {
            seconds = spinLoop ? seconds % maxSeconds - 1 : maxSeconds;
        }
        else if (seconds < minSeconds) {
            seconds = spinLoop ? maxSeconds + (seconds % maxSeconds) + 1 : minSeconds;
        }
        newDate.setSeconds(seconds);
    }
    /** Spins the fractional seconds (milliseconds) portion in a date-time editor. */
    static spinFractionalSeconds(delta, newDate, spinLoop) {
        const maxMs = 999;
        const minMs = 0;
        let ms = newDate.getMilliseconds() + delta;
        if (ms > maxMs) {
            ms = spinLoop ? ms % maxMs - 1 : maxMs;
        }
        else if (ms < minMs) {
            ms = spinLoop ? maxMs + (ms % maxMs) + 1 : minMs;
        }
        newDate.setMilliseconds(ms);
    }
    /** Spins the AM/PM portion in a date-time editor. */
    static spinAmPm(newDate, currentDate, amPmFromMask) {
        if (DateTimeUtil.isAm(amPmFromMask)) {
            newDate = new Date(newDate.setHours(newDate.getHours() + 12));
        }
        else if (DateTimeUtil.isPm(amPmFromMask)) {
            newDate = new Date(newDate.setHours(newDate.getHours() - 12));
        }
        if (newDate.getDate() !== currentDate.getDate()) {
            return currentDate;
        }
        return newDate;
    }
    /**
     * Determines whether the provided value is greater than the provided max value.
     *
     * @param includeTime set to false if you want to exclude time portion of the two dates
     * @param includeDate set to false if you want to exclude the date portion of the two dates
     * @returns true if provided value is greater than provided maxValue
     */
    static greaterThanMaxValue(value, maxValue, includeTime = true, includeDate = true) {
        if (includeTime && includeDate) {
            return value.getTime() > maxValue.getTime();
        }
        const _value = new Date(value.getTime());
        const _maxValue = new Date(maxValue.getTime());
        if (!includeTime) {
            _value.setHours(0, 0, 0, 0);
            _maxValue.setHours(0, 0, 0, 0);
        }
        if (!includeDate) {
            _value.setFullYear(0, 0, 0);
            _maxValue.setFullYear(0, 0, 0);
        }
        return _value.getTime() > _maxValue.getTime();
    }
    /**
     * Determines whether the provided value is less than the provided min value.
     *
     * @param includeTime set to false if you want to exclude time portion of the two dates
     * @param includeDate set to false if you want to exclude the date portion of the two dates
     * @returns true if provided value is less than provided minValue
     */
    static lessThanMinValue(value, minValue, includeTime = true, includeDate = true) {
        if (includeTime && includeDate) {
            return value.getTime() < minValue.getTime();
        }
        const _value = new Date(value.getTime());
        const _minValue = new Date(minValue.getTime());
        if (!includeTime) {
            _value.setHours(0, 0, 0, 0);
            _minValue.setHours(0, 0, 0, 0);
        }
        if (!includeDate) {
            _value.setFullYear(0, 0, 0);
            _minValue.setFullYear(0, 0, 0);
        }
        return _value.getTime() < _minValue.getTime();
    }
    /**
     * Validates a value within a given min and max value range.
     *
     * @param value The value to validate
     * @param minValue The lowest possible value that `value` can take
     * @param maxValue The largest possible value that `value` can take
     */
    static validateMinMax(value, minValue, maxValue, includeTime = true, includeDate = true) {
        if (!value) {
            return null;
        }
        const errors = {};
        const min = DateTimeUtil.isValidDate(minValue) ? minValue : DateTimeUtil.parseIsoDate(minValue);
        const max = DateTimeUtil.isValidDate(maxValue) ? maxValue : DateTimeUtil.parseIsoDate(maxValue);
        if (min && value && DateTimeUtil.lessThanMinValue(value, min, includeTime, includeDate)) {
            Object.assign(errors, { minValue: true });
        }
        if (max && value && DateTimeUtil.greaterThanMaxValue(value, max, includeTime, includeDate)) {
            Object.assign(errors, { maxValue: true });
        }
        return errors;
    }
    /** Parse an ISO string to a Date */
    static parseIsoDate(value) {
        let regex = /^\d{4}/g;
        const timeLiteral = 'T';
        if (regex.test(value)) {
            return new Date(value + `${value.indexOf(timeLiteral) === -1 ? 'T00:00:00' : ''}`);
        }
        regex = /^\d{2}/g;
        if (regex.test(value)) {
            const dateNow = new Date().toISOString();
            // eslint-disable-next-line prefer-const
            let [datePart, _timePart] = dateNow.split(timeLiteral);
            return new Date(`${datePart}T${value}`);
        }
        return null;
    }
    /**
     * Returns whether the input is valid date
     *
     * @param value input to check
     * @returns true if provided input is a valid date
     */
    static isValidDate(value) {
        if (isDate(value)) {
            return !isNaN(value.getTime());
        }
        return false;
    }
    static isFormatNumeric(locale, inputFormat) {
        const dateParts = DateTimeUtil.parseDateTimeFormat(inputFormat);
        if (predefinedNonNumericFormats.has(inputFormat) || dateParts.every(p => p.type === DatePart.Literal)) {
            return false;
        }
        for (let i = 0; i < dateParts.length; i++) {
            if (dateParts[i].type === DatePart.AmPm || dateParts[i].type === DatePart.Literal) {
                continue;
            }
            const transformedValue = formatDate(new Date(), dateParts[i].format, locale);
            // check if the transformed date/time part contains any kind of letter from any language
            if (/\p{L}+/gu.test(transformedValue)) {
                return false;
            }
        }
        return true;
    }
    /**
     * Returns an input format that can be used by the date-time editors, as
     * - if the format is already numeric, return it as is
     * - if it is among the predefined numeric ones, return it as the equivalent locale-based format
     *   for the corresponding numeric date parts
     * - otherwise, return an empty string
     */
    static getNumericInputFormat(locale, format) {
        let resultFormat = '';
        if (!format) {
            return resultFormat;
        }
        if (predefinedNumericFormats.has(format)) {
            resultFormat = DateTimeUtil.getLocaleInputFormatFromParts(locale, predefinedNumericFormats.get(format));
        }
        else if (DateTimeUtil.isFormatNumeric(locale, format)) {
            resultFormat = format;
        }
        return resultFormat;
    }
    /** Gets the locale-based format from an array of date parts */
    static getLocaleInputFormatFromParts(locale, dateParts) {
        const options = {};
        dateParts.forEach(p => {
            if (p === "year" /* DateParts.Year */) {
                options[p] = "numeric" /* FormatDesc.Numeric */;
            }
            else if (p !== "dayPeriod" /* DateParts.AmPm */) {
                options[p] = "2-digit" /* FormatDesc.TwoDigits */;
            }
        });
        const formatter = new Intl.DateTimeFormat(locale, options);
        const dateStruct = DateTimeUtil.getDateStructFromParts(formatter.formatToParts(new Date()), formatter);
        DateTimeUtil.fillDatePartsPositions(dateStruct);
        return DateTimeUtil.getMask(dateStruct);
    }
    static addCurrentPart(currentPart, dateTimeParts) {
        DateTimeUtil.ensureLeadingZero(currentPart);
        currentPart.end = currentPart.start + currentPart.format.length;
        dateTimeParts.push(currentPart);
    }
    static daysInMonth(fullYear, month) {
        return new Date(fullYear, month + 1, 0).getDate();
    }
    static trimEmptyPlaceholders(value, promptChar) {
        const result = value.replace(new RegExp(promptChar || '_', 'g'), '');
        return result;
    }
    static getMask(dateStruct) {
        const mask = [];
        for (const part of dateStruct) {
            if (part.formatType === "numeric" /* FormatDesc.Numeric */) {
                switch (part.type) {
                    case "day" /* DateParts.Day */:
                        mask.push('d');
                        break;
                    case "month" /* DateParts.Month */:
                        mask.push('M');
                        break;
                    case "year" /* DateParts.Year */:
                        mask.push('yyyy');
                        break;
                    case "hour" /* DateParts.Hour */:
                        mask.push(part.hour12 ? 'h' : 'H');
                        break;
                    case "minute" /* DateParts.Minute */:
                        mask.push('m');
                        break;
                    case "second" /* DateParts.Second */:
                        mask.push('s');
                        break;
                }
            }
            else if (part.formatType === "2-digit" /* FormatDesc.TwoDigits */) {
                switch (part.type) {
                    case "day" /* DateParts.Day */:
                        mask.push('dd');
                        break;
                    case "month" /* DateParts.Month */:
                        mask.push('MM');
                        break;
                    case "year" /* DateParts.Year */:
                        mask.push('yy');
                        break;
                    case "hour" /* DateParts.Hour */:
                        mask.push(part.hour12 ? 'hh' : 'HH');
                        break;
                    case "minute" /* DateParts.Minute */:
                        mask.push('mm');
                        break;
                    case "second" /* DateParts.Second */:
                        mask.push('ss');
                        break;
                }
            }
            if (part.type === "dayPeriod" /* DateParts.AmPm */) {
                mask.push('tt');
            }
            if (part.type === DateTimeUtil.SEPARATOR) {
                mask.push(part.value);
            }
        }
        return mask.join('');
    }
    static logMissingLocaleSettings(locale) {
        console.warn(`Missing locale data for the locale ${locale}. Please refer to https://angular.io/guide/i18n#i18n-pipes`);
        console.warn('Using default browser locale settings.');
    }
    static prependValue(value, partLength, prependChar) {
        return (prependChar + value.toString()).slice(-partLength);
    }
    static toTwelveHourFormat(value, promptChar = '_') {
        let hour = parseInt(value.replace(new RegExp(promptChar, 'g'), '0'), 10);
        if (hour > 12) {
            hour -= 12;
        }
        else if (hour === 0) {
            hour = 12;
        }
        return hour;
    }
    static ensureLeadingZero(part) {
        switch (part.type) {
            case DatePart.Date:
            case DatePart.Month:
            case DatePart.Hours:
            case DatePart.Minutes:
            case DatePart.Seconds:
                if (part.format.length === 1) {
                    part.format = part.format.repeat(2);
                }
                break;
            case DatePart.FractionalSeconds:
                part.format = part.format[0].repeat(3);
                break;
        }
    }
    static getCleanVal(inputData, datePart, promptChar) {
        return DateTimeUtil.trimEmptyPlaceholders(inputData.substring(datePart.start, datePart.end), promptChar);
    }
    static determineDatePart(char) {
        switch (char) {
            case 'd':
            case 'D':
                return DatePart.Date;
            case 'M':
                return DatePart.Month;
            case 'y':
            case 'Y':
                return DatePart.Year;
            case 'h':
            case 'H':
                return DatePart.Hours;
            case 'm':
                return DatePart.Minutes;
            case 's':
                return DatePart.Seconds;
            case 'S':
                return DatePart.FractionalSeconds;
            case 'a':
            case 't':
            case 'T':
                return DatePart.AmPm;
            default:
                return DatePart.Literal;
        }
    }
    static getFormatOptions(dataType) {
        const dateOptions = {
            day: "2-digit" /* FormatDesc.TwoDigits */,
            month: "2-digit" /* FormatDesc.TwoDigits */,
            year: "numeric" /* FormatDesc.Numeric */
        };
        const timeOptions = {
            hour: "2-digit" /* FormatDesc.TwoDigits */,
            minute: "2-digit" /* FormatDesc.TwoDigits */
        };
        switch (dataType) {
            case DataType.Date:
                return dateOptions;
            case DataType.Time:
                return timeOptions;
            case DataType.DateTime:
                return {
                    ...dateOptions,
                    ...timeOptions,
                    second: "2-digit" /* FormatDesc.TwoDigits */
                };
            default:
                return {};
        }
    }
    static getDefaultLocaleMask(locale, dataType = DataType.Date) {
        const options = DateTimeUtil.getFormatOptions(dataType);
        const formatter = new Intl.DateTimeFormat(locale, options);
        const formatToParts = formatter.formatToParts(new Date());
        const dateStruct = DateTimeUtil.getDateStructFromParts(formatToParts, formatter);
        DateTimeUtil.fillDatePartsPositions(dateStruct);
        return dateStruct;
    }
    static getDateStructFromParts(parts, formatter) {
        const dateStruct = [];
        for (const part of parts) {
            if (part.type === DateTimeUtil.SEPARATOR) {
                dateStruct.push({
                    type: DateTimeUtil.SEPARATOR,
                    value: part.value
                });
            }
            else {
                dateStruct.push({
                    type: part.type
                });
            }
        }
        const formatterOptions = formatter.resolvedOptions();
        for (const part of dateStruct) {
            switch (part.type) {
                case "day" /* DateParts.Day */: {
                    part.formatType = formatterOptions.day;
                    break;
                }
                case "month" /* DateParts.Month */: {
                    part.formatType = formatterOptions.month;
                    break;
                }
                case "year" /* DateParts.Year */: {
                    part.formatType = formatterOptions.year;
                    break;
                }
                case "hour" /* DateParts.Hour */: {
                    part.formatType = formatterOptions.hour;
                    if (formatterOptions.hour12) {
                        part.hour12 = true;
                    }
                    break;
                }
                case "minute" /* DateParts.Minute */: {
                    part.formatType = formatterOptions.minute;
                    break;
                }
                case "second" /* DateParts.Second */: {
                    part.formatType = formatterOptions.second;
                    break;
                }
                case "dayPeriod" /* DateParts.AmPm */: {
                    part.formatType = formatterOptions.dayPeriod;
                    break;
                }
            }
        }
        return dateStruct;
    }
    static fillDatePartsPositions(dateArray) {
        let currentPos = 0;
        for (const part of dateArray) {
            // Day|Month|Hour|Minute|Second|AmPm part positions
            if (part.type === "day" /* DateParts.Day */ || part.type === "month" /* DateParts.Month */ ||
                part.type === "hour" /* DateParts.Hour */ || part.type === "minute" /* DateParts.Minute */ || part.type === "second" /* DateParts.Second */ ||
                part.type === "dayPeriod" /* DateParts.AmPm */) {
                // Offset 2 positions for number
                part.position = [currentPos, currentPos + 2];
                currentPos += 2;
            }
            else if (part.type === "year" /* DateParts.Year */) {
                // Year part positions
                switch (part.formatType) {
                    case "numeric" /* FormatDesc.Numeric */: {
                        // Offset 4 positions for full year
                        part.position = [currentPos, currentPos + 4];
                        currentPos += 4;
                        break;
                    }
                    case "2-digit" /* FormatDesc.TwoDigits */: {
                        // Offset 2 positions for short year
                        part.position = [currentPos, currentPos + 2];
                        currentPos += 2;
                        break;
                    }
                }
            }
            else if (part.type === DateTimeUtil.SEPARATOR) {
                // Separator positions
                part.position = [currentPos, currentPos + 1];
                currentPos++;
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS10aW1lLnV0aWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZ25pdGV1aS1hbmd1bGFyL3NyYy9saWIvZGF0ZS1jb21tb24vdXRpbC9kYXRlLXRpbWUudXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFnQixNQUFNLDJEQUEyRCxDQUFDO0FBQ25HLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLG1CQUFtQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFL0UsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQVEzRCxNQUFNLFVBQVUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUM1RCxNQUFNLFVBQVUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztBQXFCN0M7Ozs7OztHQU1HO0FBQ0gsTUFBTSx3QkFBd0IsR0FBRyxJQUFJLEdBQUcsQ0FBc0I7SUFDMUQsQ0FBQyxPQUFPLEVBQUUscUpBQWtGLENBQUM7SUFDN0YsQ0FBQyxXQUFXLEVBQUUsdUZBQWdELENBQUM7SUFDL0QsQ0FBQyxXQUFXLEVBQUUsOERBQWtDLENBQUM7SUFDakQsQ0FBQyxZQUFZLEVBQUUsK0ZBQW9ELENBQUM7Q0FDdkUsQ0FBQyxDQUFDO0FBRUgsTUFBTSwyQkFBMkIsR0FBRyxJQUFJLEdBQUcsQ0FBUztJQUNoRCxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsVUFBVTtDQUN6RixDQUFDLENB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QUN0QixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsVUFBVSxFQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDN0MsVUFBVSxFQUFFLENBQUM7WUFDakIsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGF0ZVBhcnQsIERhdGVQYXJ0SW5mbyB9IGZyb20gJy4uLy4uL2RpcmVjdGl2ZXMvZGF0ZS10aW1lLWVkaXRvci9kYXRlLXRpbWUtZWRpdG9yLmNvbW1vbic7XG5pbXBvcnQgeyBmb3JtYXREYXRlLCBGb3JtYXRXaWR0aCwgZ2V0TG9jYWxlRGF0ZUZvcm1hdCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgaXNEYXRlIH0gZnJvbSAnLi4vLi4vY29yZS91dGlscyc7XG5pbXBvcnQgeyBEYXRhVHlwZSB9IGZyb20gJy4uLy4uL2RhdGEtb3BlcmF0aW9ucy9kYXRhLXV0aWwnO1xuXG4vKiogQGhpZGRlbiAqL1xuY29uc3QgZW51bSBGb3JtYXREZXNjIHtcbiAgICBOdW1lcmljID0gJ251bWVyaWMnLFxuICAgIFR3b0RpZ2l0cyA9ICcyLWRpZ2l0J1xufVxuXG5jb25zdCBUSU1FX0NIQVJTID0gWydoJywgJ0gnLCAnbScsICdzJywgJ1MnLCAndCcsICdUJywgJ2EnXTtcbmNvbnN0IERBVEVfQ0hBUlMgPSBbJ2QnLCAnRCcsICdNJywgJ3knLCAnWSddO1xuXG4vKiogQGhpZGRlbiAqL1xuY29uc3QgZW51bSBBbVBtVmFsdWVzIHtcbiAgICBBTSA9ICdBTScsXG4gICAgQSA9ICdhJyxcbiAgICBQTSA9ICdQTScsXG4gICAgUCA9ICdwJ1xufVxuXG4vKiogQGhpZGRlbiAqL1xuY29uc3QgZW51bSBEYXRlUGFydHMge1xuICAgIERheSA9ICdkYXknLFxuICAgIE1vbnRoID0gJ21vbnRoJyxcbiAgICBZZWFyID0gJ3llYXInLFxuICAgIEhvdXIgPSAnaG91cicsXG4gICAgTWludXRlID0gJ21pbnV0ZScsXG4gICAgU2Vjb25kID0gJ3NlY29uZCcsXG4gICAgQW1QbSA9ICdkYXlQZXJpb2QnXG59XG5cbi8qKiBNYXBzIG9mIHRoZSBwcmUtZGVmaW5lZCBkYXRlLXRpbWUgZm9ybWF0IG9wdGlvbnMgc3VwcG9ydGVkIGJ5IHRoZSBBbmd1bGFyIERhdGVQaXBlXG4gKiAtIHByZWRlZmluZWROdW1lcmljRm9ybWF0cyByZXNvbHZlIHRvIG51bWVyaWMgcGFydHMgb25seSAoYW5kIHBlcmlvZCkgZm9yIHRoZSBkZWZhdWx0ICdlbicgY3VsdHVyZVxuICogLSBwcmVkZWZpbmVkTm9uTnVtZXJpY0Zvcm1hdHMgdXN1YWxseSBjb250YWluIG5vbi1udW1lcmljIGRhdGUvdGltZSBwYXJ0cywgd2hpY2ggY2Fubm90IGJlXG4gKiAgIGhhbmRsZWQgZm9yIGVkaXRpbmcgYnkgdGhlIGRhdGUvdGltZSBlZGl0b3JzXG4gKiAgUmVmOiBodHRwczovL2FuZ3VsYXIuZGV2L2FwaS9jb21tb24vRGF0ZVBpcGU/dGFiPXVzYWdlLW5vdGVzXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IHByZWRlZmluZWROdW1lcmljRm9ybWF0cyA9IG5ldyBNYXA8c3RyaW5nLCBEYXRlUGFydHNbXT4oW1xuICAgIFsnc2hvcnQnLCBbRGF0ZVBhcnRzLk1vbnRoLCBEYXRlUGFydHMuRGF5LCBEYXRlUGFydHMuWWVhciwgRGF0ZVBhcnRzLkhvdXIsIERhdGVQYXJ0cy5NaW51dGVdXSxcbiAgICBbJ3Nob3J0RGF0ZScsIFtEYXRlUGFydHMuTW9udGgsIERhdGVQYXJ0cy5EYXksIERhdGVQYXJ0cy5ZZWFyXV0sXG4gICAgWydzaG9ydFRpbWUnLCBbRGF0ZVBhcnRzLkhvdXIsIERhdGVQYXJ0cy5NaW51dGVdXSxcbiAgICBbJ21lZGl1bVRpbWUnLCBbRGF0ZVBhcnRzLkhvdXIsIERhdGVQYXJ0cy5NaW51dGUsIERhdGVQYXJ0cy5TZWNvbmRdXSxcbl0pO1xuXG5jb25zdCBwcmVkZWZpbmVkTm9uTnVtZXJpY0Zvcm1hdHMgPSBuZXcgU2V0PHN0cmluZz4oW1xuICAgICdtZWRpdW0nLCAnbG9uZycsICdmdWxsJywgJ21lZGl1bURhdGUnLCAnbG9uZ0RhdGUnLCAnZnVsbERhdGUnLCAnbG9uZ1RpbWUnLCAnZnVsbFRpbWUnLFxuXSlcblxuLyoqIEBoaWRkZW4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBEYXRlVGltZVV0aWwge1xuICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9JTlBVVF9GT1JNQVQgPSAnTU0vZGQveXl5eSc7XG4gICAgcHVibGljIHN0YXRpYyByZWFkb25seSBERUZBVUxUX1RJTUVfSU5QVVRfRk9STUFUID0gJ2hoOm1tIHR0JztcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBTRVBBUkFUT1IgPSAnbGl0ZXJhbCc7XG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgREVGQVVMVF9MT0NBTEUgPSAnZW4nO1xuXG4gICAgLyoqXG4gICAgICogUGFyc2UgYSBEYXRlIHZhbHVlIGZyb20gbWFza2VkIHN0cmluZyBpbnB1dCBiYXNlZCBvbiBkZXRlcm1pbmVkIGRhdGUgcGFydHNcbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dERhdGEgbWFza2VkIHZhbHVlIHRvIHBhcnNlXG4gICAgICogQHBhcmFtIGRhdGVUaW1lUGFydHMgRGF0ZSBwYXJ0cyBhcnJheSBmb3IgdGhlIG1hc2tcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHBhcnNlVmFsdWVGcm9tTWFzayhpbnB1dERhdGE6IHN0cmluZywgZGF0ZVRpbWVQYXJ0czogRGF0ZVBhcnRJbmZvW10sIHByb21wdENoYXI/OiBzdHJpbmcpOiBEYXRlIHwgbnVsbCB7XG4gICAgICAgIGNvbnN0IHBhcnRzOiB7IFtrZXkgaW4gRGF0ZVBhcnRdOiBudW1iZXIgfSA9IHt9IGFzIGFueTtcbiAgICAgICAgZGF0ZVRpbWVQYXJ0cy5mb3JFYWNoKGRwID0+IHtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHBhcnNlSW50KERhdGVUaW1lVXRpbC5nZXRDbGVhblZhbChpbnB1dERhdGEsIGRwLCBwcm9tcHRDaGFyKSwgMTApO1xuICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gZHAudHlwZSA9PT0gRGF0ZVBhcnQuRGF0ZSB8fCBkcC50eXBlID09PSBEYXRlUGFydC5Nb250aCA/IDEgOiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFydHNbZHAudHlwZV0gPSB2YWx1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHBhcnRzW0RhdGVQYXJ0Lk1vbnRoXSAtPSAxO1xuXG4gICAgICAgIGlmIChwYXJ0c1tEYXRlUGFydC5Nb250aF0gPCAwIHx8IDExIDwgcGFydHNbRGF0ZVBhcnQuTW9udGhdKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRPRE86IENlbnR1cnkgdGhyZXNob2xkXG4gICAgICAgIGlmIChwYXJ0c1tEYXRlUGFydC5ZZWFyXSA8IDUwKSB7XG4gICAgICAgICAgICBwYXJ0c1tEYXRlUGFydC5ZZWFyXSArPSAyMDAwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcnRzW0RhdGVQYXJ0LkRhdGVdID4gRGF0ZVRpbWVVdGlsLmRheXNJbk1vbnRoKHBhcnRzW0RhdGVQYXJ0LlllYXJdLCBwYXJ0c1tEYXRlUGFydC5Nb250aF0pKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJ0c1tEYXRlUGFydC5Ib3Vyc10gPiAyMyB8fCBwYXJ0c1tEYXRlUGFydC5NaW51dGVzXSA+IDU5XG4gICAgICAgICAgICB8fCBwYXJ0c1tEYXRlUGFydC5TZWNvbmRzXSA+IDU5IHx8IHBhcnRzW0RhdGVQYXJ0LkZyYWN0aW9uYWxTZWNvbmRzXSA+IDk5OSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhbVBtID0gZGF0ZVRpbWVQYXJ0cy5maW5kKHAgPT4gcC50eXBlID09PSBEYXRlUGFydC5BbVBtKTtcbiAgICAgICAgaWYgKGFtUG0pIHtcbiAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0LkhvdXJzXSAlPSAxMjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhbVBtKSB7XG4gICAgICAgICAgICBjb25zdCBjbGVhblZhbCA9IERhdGVUaW1lVXRpbC5nZXRDbGVhblZhbChpbnB1dERhdGEsIGFtUG0sIHByb21wdENoYXIpO1xuICAgICAgICAgICAgaWYgKERhdGVUaW1lVXRpbC5pc1BtKGNsZWFuVmFsKSkge1xuICAgICAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0LkhvdXJzXSArPSAxMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShcbiAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0LlllYXJdIHx8IDIwMDAsXG4gICAgICAgICAgICBwYXJ0c1tEYXRlUGFydC5Nb250aF0gfHwgMCxcbiAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0LkRhdGVdIHx8IDEsXG4gICAgICAgICAgICBwYXJ0c1tEYXRlUGFydC5Ib3Vyc10gfHwgMCxcbiAgICAgICAgICAgIHBhcnRzW0RhdGVQYXJ0Lk1pbnV0ZXNdIHx8IDAsXG4gICAgICAgICAgICBwYXJ0c1tEYXRlUGFydC5TZWNvbmRzXSB8fCAwLFxuICAgICAgICAgICAgcGFydHNbRGF0ZVBhcnQuRnJhY3Rpb25hbFNlY29uZHNdIHx8IDBcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKiogUGFyc2UgdGhlIG1hc2sgaW50byBkYXRlL3RpbWUgYW5kIGxpdGVyYWwgcGFydHMgKi9cbiAgICBwdWJsaWMgc3RhdGljIHBhcnNlRGF0ZVRpbWVGb3JtYXQobWFzazogc3RyaW5nLCBsb2NhbGU/OiBzdHJpbmcpOiBEYXRlUGFydEluZm9bXSB7XG4gICAgICAgIGNvbnN0IGZvcm1hdCA9IG1hc2sgfHwgRGF0ZVRpbWVVdGlsLmdldERlZmF1bHRJbnB1dEZvcm1hdChsb2NhbGUpO1xuICAgICAgICBjb25zdCBkYXRlVGltZVBhcnRzOiBEYXRlUGFydEluZm9bXSA9IFtdO1xuICAgICAgICBjb25zdCBmb3JtYXRBcnJheSA9IEFycmF5LmZyb20oZm9ybWF0KTtcbiAgICAgICAgbGV0IGN1cnJlbnRQYXJ0OiBEYXRlUGFydEluZm8gPSBudWxsO1xuICAgICAgICBsZXQgcG9zaXRpb24gPSAwO1xuICAgICAgICBsZXQgbGFzdFBhcnRBZGRlZCA9IGZhbHNlO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZvcm1hdEFycmF5Lmxlbmd0aDsgaSsrLCBwb3NpdGlvbisrKSB7XG4gICAgICAgICAgICBjb25zdCB0eXBlID0gRGF0ZVRpbWVVdGlsLmRldGVybWluZURhdGVQYXJ0KGZvcm1hdEFycmF5W2ldKTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50UGFydCkge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UGFydC50eXBlID09PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYXJ0LmZvcm1hdCArPSBmb3JtYXRBcnJheVtpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCBmb3JtYXRBcnJheS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UGFydC50eXBlID09PSBEYXRlUGFydC5BbVBtICYmIGN1cnJlbnRQYXJ0LmZvcm1hdC5pbmRleE9mKCdhJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYXJ0ID0gRGF0ZVRpbWVVdGlsLnNpbXBsaWZ5QW1QbUZvcm1hdChjdXJyZW50UGFydCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIERhdGVUaW1lVXRpbC5hZGRDdXJyZW50UGFydChjdXJyZW50UGFydCwgZGF0ZVRpbWVQYXJ0cyk7XG4gICAgICAgICAgICAgICAgbGFzdFBhcnRBZGRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSBjdXJyZW50UGFydC5lbmQ7XG4gICAgICAgICAgICAgICAgaWYoaSA9PT0gZm9ybWF0QXJyYXkubGVuZ3RoIC0gMSAmJiBjdXJyZW50UGFydC50eXBlICE9PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RQYXJ0QWRkZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN1cnJlbnRQYXJ0ID0ge1xuICAgICAgICAgICAgICAgIHN0YXJ0OiBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICBlbmQ6IHBvc2l0aW9uICsgZm9ybWF0QXJyYXlbaV0ubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICAgICAgZm9ybWF0OiBmb3JtYXRBcnJheVtpXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgbGFzdCBtZW1iZXIgb2YgYSBmb3JtYXQgbGlrZSBIOm06cyBpcyBub3Qgb21pdHRlZFxuICAgICAgICBpZiAoIWxhc3RQYXJ0QWRkZWQpIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50UGFydC50eXBlID09PSBEYXRlUGFydC5BbVBtKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFBhcnQgPSBEYXRlVGltZVV0aWwuc2ltcGxpZnlBbVBtRm9ybWF0KGN1cnJlbnRQYXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIERhdGVUaW1lVXRpbC5hZGRDdXJyZW50UGFydChjdXJyZW50UGFydCwgZGF0ZVRpbWVQYXJ0cyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZm9ybWF0cyBsaWtlIFwieVwiIG9yIFwieXl5XCIgYXJlIHRyZWF0ZWQgbGlrZSBcInl5eXlcIiB3aGlsZSBlZGl0aW5nXG4gICAgICAgIGNvbnN0IHllYXJQYXJ0ID0gZGF0ZVRpbWVQYXJ0cy5maWx0ZXIocCA9PiBwLnR5cGUgPT09IERhdGVQYXJ0LlllYXIpWzBdO1xuICAgICAgICBpZiAoeWVhclBhcnQgJiYgeWVhclBhcnQuZm9ybWF0ICE9PSAneXknKSB7XG4gICAgICAgICAgICB5ZWFyUGFydC5lbmQgKz0gNCAtIHllYXJQYXJ0LmZvcm1hdC5sZW5ndGg7XG4gICAgICAgICAgICB5ZWFyUGFydC5mb3JtYXQgPSAneXl5eSc7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0ZVRpbWVQYXJ0cztcbiAgICB9XG5cbiAgICAvKiogU2ltcGxpZmllcyB0aGUgQW1QbSBwYXJ0IHRvIGFzIG1hbnkgY2hhcnMgYXMgd2lsbCBiZSBkaXNwbGF5ZWQgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBzaW1wbGlmeUFtUG1Gb3JtYXQoY3VycmVudFBhcnQ6IERhdGVQYXJ0SW5mbyl7XG4gICAgICAgICAgICBjdXJyZW50UGFydC5mb3JtYXQgPSBjdXJyZW50UGFydC5mb3JtYXQubGVuZ3RoID09PSA1ID8gJ2EnIDogJ2FhJztcbiAgICAgICAgICAgIGN1cnJlbnRQYXJ0LmVuZCA9IGN1cnJlbnRQYXJ0LnN0YXJ0ICsgIGN1cnJlbnRQYXJ0LmZvcm1hdC5sZW5ndGg7XG4gICAgICAgICAgICByZXR1cm4geyAuLi5jdXJyZW50UGFydCB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0UGFydFZhbHVlKHZhbHVlOiBEYXRlLCBkYXRlUGFydEluZm86IERhdGVQYXJ0SW5mbywgcGFydExlbmd0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG1hc2tlZFZhbHVlO1xuICAgICAgICBjb25zdCBkYXRlUGFydCA9IGRhdGVQYXJ0SW5mby50eXBlO1xuICAgICAgICBzd2l0Y2ggKGRhdGVQYXJ0KSB7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LkRhdGU6XG4gICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSB2YWx1ZS5nZXREYXRlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0Lk1vbnRoOlxuICAgICAgICAgICAgICAgIC8vIG1vbnRocyBhcmUgemVybyBiYXNlZFxuICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlID0gdmFsdWUuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LlllYXI6XG4gICAgICAgICAgICAgICAgaWYgKHBhcnRMZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSB0aGlzLnByZXBlbmRWYWx1ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KHZhbHVlLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKS5zbGljZSgtMiksIDEwKSwgcGFydExlbmd0aCwgJzAnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtYXNrZWRWYWx1ZSA9IHZhbHVlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRlUGFydC5Ib3VyczpcbiAgICAgICAgICAgICAgICBpZiAoZGF0ZVBhcnRJbmZvLmZvcm1hdC5pbmRleE9mKCdoJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlID0gdGhpcy5wcmVwZW5kVmFsdWUoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvVHdlbHZlSG91ckZvcm1hdCh2YWx1ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkpLCBwYXJ0TGVuZ3RoLCAnMCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlID0gdmFsdWUuZ2V0SG91cnMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0Lk1pbnV0ZXM6XG4gICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSB2YWx1ZS5nZXRNaW51dGVzKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LlNlY29uZHM6XG4gICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSB2YWx1ZS5nZXRTZWNvbmRzKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LkZyYWN0aW9uYWxTZWNvbmRzOlxuICAgICAgICAgICAgICAgIG1hc2tlZFZhbHVlID0gdmFsdWUuZ2V0TWlsbGlzZWNvbmRzKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LkFtUG06XG4gICAgICAgICAgICAgICAgbWFza2VkVmFsdWUgPSBEYXRlVGltZVV0aWwuZ2V0QW1QbVZhbHVlKHBhcnRMZW5ndGgsIHZhbHVlLmdldEhvdXJzKCkgPCAxMik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0ZVBhcnRJbmZvLnR5cGUgIT09IERhdGVQYXJ0LkFtUG0gJiYgZGF0ZVBhcnRJbmZvLnR5cGUgIT09IERhdGVQYXJ0LkxpdGVyYWwpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByZXBlbmRWYWx1ZShtYXNrZWRWYWx1ZSwgcGFydExlbmd0aCwgJzAnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtYXNrZWRWYWx1ZTtcbiAgICB9XG5cbiAgICAvKiogUmV0dXJucyB0aGUgQW1QbSBwYXJ0IHZhbHVlIGRlcGVuZGluZyBvbiB0aGUgcGFydCBsZW5ndGggYW5kIGFcbiAgICAgKiBjb25kaXRpb25hbCBleHByZXNzaW9uIGluZGljYXRpbmcgd2hldGhlciB0aGUgdmFsdWUgaXMgQU0gb3IgUE0uXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBnZXRBbVBtVmFsdWUocGFydExlbmd0aDogbnVtYmVyLCBpc0FtOiBib29sZWFuKSB7XG4gICAgICAgIGlmIChpc0FtKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFydExlbmd0aCA9PT0gMSA/IEFtUG1WYWx1ZXMuQSA6IEFtUG1WYWx1ZXMuQU07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcGFydExlbmd0aCA9PT0gMSA/IEFtUG1WYWx1ZXMuUCA6IEFtUG1WYWx1ZXMuUE07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIGEgc3RyaW5nIHZhbHVlIGluZGljYXRlcyBhbiBBTSBwZXJpb2QgKi9cbiAgICBwdWJsaWMgc3RhdGljIGlzQW0odmFsdWU6IHN0cmluZykge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiAodmFsdWUgPT09IEFtUG1WYWx1ZXMuQU0udG9Mb3dlckNhc2UoKSB8fCB2YWx1ZSA9PT0gQW1QbVZhbHVlcy5BLnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cblxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgYSBzdHJpbmcgdmFsdWUgaW5kaWNhdGVzIGEgUE0gcGVyaW9kICovXG4gICAgcHVibGljIHN0YXRpYyBpc1BtKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICByZXR1cm4gKHZhbHVlID09PSBBbVBtVmFsdWVzLlBNLnRvTG93ZXJDYXNlKCkgfHwgdmFsdWUgPT09IEFtUG1WYWx1ZXMuUC50b0xvd2VyQ2FzZSgpKTtcbiAgICB9XG5cbiAgICAvKiogQnVpbGRzIGEgZGF0ZS10aW1lIGVkaXRvcidzIGRlZmF1bHQgaW5wdXQgZm9ybWF0IGJhc2VkIG9uIHByb3ZpZGVkIGxvY2FsZSBzZXR0aW5ncyBhbmQgZGF0YSB0eXBlLiAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZ2V0RGVmYXVsdElucHV0Rm9ybWF0KGxvY2FsZTogc3RyaW5nLCBkYXRhVHlwZTogRGF0YVR5cGUgPSBEYXRhVHlwZS5EYXRlKTogc3RyaW5nIHtcbiAgICAgICAgbG9jYWxlID0gbG9jYWxlIHx8IERhdGVUaW1lVXRpbC5ERUZBVUxUX0xPQ0FMRTtcbiAgICAgICAgaWYgKCFJbnRsIHx8ICFJbnRsLkRhdGVUaW1lRm9ybWF0IHx8ICFJbnRsLkRhdGVUaW1lRm9ybWF0LnByb3RvdHlwZS5mb3JtYXRUb1BhcnRzKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBmYWxsYmFjayB3aXRoIEludGwuZm9ybWF0IGZvciBJRT9cbiAgICAgICAgICAgIHJldHVybiBEYXRlVGltZVV0aWwuREVGQVVMVF9JTlBVVF9GT1JNQVQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFydHMgPSBEYXRlVGltZVV0aWwuZ2V0RGVmYXVsdExvY2FsZU1hc2sobG9jYWxlLCBkYXRhVHlwZSk7XG4gICAgICAgIHBhcnRzLmZvckVhY2gocCA9PiB7XG4gICAgICAgICAgICBpZiAocC50eXBlICE9PSBEYXRlUGFydC5ZZWFyICYmIHAudHlwZSAhPT0gRGF0ZVRpbWVVdGlsLlNFUEFSQVRPUiAmJiBwLnR5cGUgIT09IERhdGVQYXJ0LkFtUG0pIHtcbiAgICAgICAgICAgICAgICBwLmZvcm1hdFR5cGUgPSBGb3JtYXREZXNjLlR3b0RpZ2l0cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIERhdGVUaW1lVXRpbC5nZXRNYXNrKHBhcnRzKTtcbiAgICB9XG5cbiAgICAvKiogVHJpZXMgdG8gZm9ybWF0IGEgZGF0ZSB1c2luZyBBbmd1bGFyJ3MgRGF0ZVBpcGUuIEZhbGxiYWNrcyB0byBgSW50bGAgaWYgbm8gbG9jYWxlIHNldHRpbmdzIGhhdmUgYmVlbiBsb2FkZWQuICovXG4gICAgcHVibGljIHN0YXRpYyBmb3JtYXREYXRlKHZhbHVlOiBudW1iZXIgfCBEYXRlLCBmb3JtYXQ6IHN0cmluZywgbG9jYWxlOiBzdHJpbmcsIHRpbWV6b25lPzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGZvcm1hdHRlZERhdGU6IHN0cmluZztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZvcm1hdHRlZERhdGUgPSBmb3JtYXREYXRlKHZhbHVlLCBmb3JtYXQsIGxvY2FsZSwgdGltZXpvbmUpO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIERhdGVUaW1lVXRpbC5sb2dNaXNzaW5nTG9jYWxlU2V0dGluZ3MobG9jYWxlKTtcbiAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlciA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSk7XG4gICAgICAgICAgICBmb3JtYXR0ZWREYXRlID0gZm9ybWF0dGVyLmZvcm1hdCh2YWx1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZm9ybWF0dGVkRGF0ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBkYXRlIGZvcm1hdCBiYXNlZCBvbiBhIHByb3ZpZGVkIGxvY2FsZS5cbiAgICAgKiBTdXBwb3J0cyBBbmd1bGFyJ3MgRGF0ZVBpcGUgZm9ybWF0IG9wdGlvbnMgc3VjaCBhcyBgc2hvcnREYXRlYCwgYGxvbmdEYXRlYC5cbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGdldExvY2FsZURhdGVGb3JtYXQobG9jYWxlOiBzdHJpbmcsIGRpc3BsYXlGb3JtYXQ/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBmb3JtYXRLZXlzID0gT2JqZWN0LmtleXMoRm9ybWF0V2lkdGgpIGFzIChrZXlvZiBGb3JtYXRXaWR0aClbXTtcbiAgICAgICAgY29uc3QgdGFyZ2V0S2V5ID0gZm9ybWF0S2V5cy5maW5kKGsgPT4gay50b0xvd2VyQ2FzZSgpID09PSBkaXNwbGF5Rm9ybWF0Py50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJ2RhdGUnLCAnJykpO1xuICAgICAgICBpZiAoIXRhcmdldEtleSkge1xuICAgICAgICAgICAgLy8gaWYgZGlzcGxheUZvcm1hdCBpcyBub3Qgc2hvcnREYXRlLCBsb25nRGF0ZSwgZXRjLlxuICAgICAgICAgICAgLy8gb3IgaWYgaXQgaXMgbm90IHNldCBieSB0aGUgdXNlclxuICAgICAgICAgICAgcmV0dXJuIGRpc3BsYXlGb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGZvcm1hdDogc3RyaW5nO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm9ybWF0ID0gZ2V0TG9jYWxlRGF0ZUZvcm1hdChsb2NhbGUsIEZvcm1hdFdpZHRoW3RhcmdldEtleV0pO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIERhdGVUaW1lVXRpbC5sb2dNaXNzaW5nTG9jYWxlU2V0dGluZ3MobG9jYWxlKTtcbiAgICAgICAgICAgIGZvcm1hdCA9IERhdGVUaW1lVXRpbC5nZXREZWZhdWx0SW5wdXRGb3JtYXQobG9jYWxlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmb3JtYXQ7XG4gICAgfVxuXG4gICAgLyoqIERldGVybWluZXMgaWYgYSBnaXZlbiBjaGFyYWN0ZXIgaXMgYGQvTS95YCBvciBgaC9tL3NgLiAqL1xuICAgIHB1YmxpYyBzdGF0aWMgaXNEYXRlT3JUaW1lQ2hhcihjaGFyOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIERBVEVfQ0hBUlMuaW5kZXhPZihjaGFyKSAhPT0gLTEgfHwgVElNRV9DSEFSUy5pbmRleE9mKGNoYXIpICE9PSAtMTtcbiAgICB9XG5cbiAgICAvKiogU3BpbnMgdGhlIGRhdGUgcG9ydGlvbiBpbiBhIGRhdGUtdGltZSBlZGl0b3IuICovXG4gICAgcHVibGljIHN0YXRpYyBzcGluRGF0ZShkZWx0YTogbnVtYmVyLCBuZXdEYXRlOiBEYXRlLCBzcGluTG9vcDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBjb25zdCBtYXhEYXRlID0gRGF0ZVRpbWVVdGlsLmRheXNJbk1vbnRoKG5ld0RhdGUuZ2V0RnVsbFllYXIoKSwgbmV3RGF0ZS5nZXRNb250aCgpKTtcbiAgICAgICAgbGV0IGRhdGUgPSBuZXdEYXRlLmdldERhdGUoKSArIGRlbHRhO1xuICAgICAgICBpZiAoZGF0ZSA+IG1heERhdGUpIHtcbiAgICAgICAgICAgIGRhdGUgPSBzcGluTG9vcCA/IGRhdGUgJSBtYXhEYXRlIDogbWF4RGF0ZTtcbiAgICAgICAgfSBlbHNlIGlmIChkYXRlIDwgMSkge1xuICAgICAgICAgICAgZGF0ZSA9IHNwaW5Mb29wID8gbWF4RGF0ZSArIChkYXRlICUgbWF4RGF0ZSkgOiAxO1xuICAgICAgICB9XG5cbiAgICAgICAgbmV3RGF0ZS5zZXREYXRlKGRhdGUpO1xuICAgIH1cblxuICAgIC8qKiBTcGlucyB0aGUgbW9udGggcG9ydGlvbiBpbiBhIGRhdGUtdGltZSBlZGl0b3IuICovXG4gICAgcHVibGljIHN0YXRpYyBzcGluTW9udGgoZGVsdGE6IG51bWJlciwgbmV3RGF0ZTogRGF0ZSwgc3Bpbkxvb3A6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgY29uc3QgbWF4RGF0ZSA9IERhdGVUaW1lVXRpbC5kYXlzSW5Nb250aChuZXdEYXRlLmdldEZ1bGxZZWFyKCksIG5ld0RhdGUuZ2V0TW9udGgoKSArIGRlbHRhKTtcbiAgICAgICAgaWYgKG5ld0RhdGUuZ2V0RGF0ZSgpID4gbWF4RGF0ZSkge1xuICAgICAgICAgICAgbmV3RGF0ZS5zZXREYXRlKG1heERhdGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbWF4TW9udGggPSAxMTtcbiAgICAgICAgY29uc3QgbWluTW9udGggPSAwO1xuICAgICAgICBsZXQgbW9udGggPSBuZXdEYXRlLmdldE1vbnRoKCkgKyBkZWx0YTtcbiAgICAgICAgaWYgKG1vbnRoID4gbWF4TW9udGgpIHtcbiAgICAgICAgICAgIG1vbnRoID0gc3Bpbkxvb3AgPyAobW9udGggJSBtYXhNb250aCkgLSAxIDogbWF4TW9udGg7XG4gICAgICAgIH0gZWxzZSBpZiAobW9udGggPCBtaW5Nb250aCkge1xuICAgICAgICAgICAgbW9udGggPSBzcGluTG9vcCA/IG1heE1vbnRoICsgKG1vbnRoICUgbWF4TW9udGgpICsgMSA6IG1pbk1vbnRoO1xuICAgICAgICB9XG5cbiAgICAgICAgbmV3RGF0ZS5zZXRNb250aChtb250aCk7XG4gICAgfVxuXG4gICAgLyoqIFNwaW5zIHRoZSB5ZWFyIHBvcnRpb24gaW4gYSBkYXRlLXRpbWUgZWRpdG9yLiAqL1xuICAgIHB1YmxpYyBzdGF0aWMgc3BpblllYXIoZGVsdGE6IG51bWJlciwgbmV3RGF0ZTogRGF0ZSk6IHZvaWQge1xuICAgICAgICBjb25zdCBtYXhEYXRlID0gRGF0ZVRpbWVVdGlsLmRheXNJbk1vbnRoKG5ld0RhdGUuZ2V0RnVsbFllYXIoKSArIGRlbHRhLCBuZXdEYXRlLmdldE1vbnRoKCkpO1xuICAgICAgICBpZiAobmV3RGF0ZS5nZXREYXRlKCkgPiBtYXhEYXRlKSB7XG4gICAgICAgICAgICAvLyBjbGlwIHRvIG1heCB0byBhdm9pZCBsZWFwIHllYXIgY2hhbmdlIHNoaWZ0aW5nIHRoZSBlbnRpcmUgdmFsdWVcbiAgICAgICAgICAgIG5ld0RhdGUuc2V0RGF0ZShtYXhEYXRlKTtcbiAgICAgICAgfVxuICAgICAgICBuZXdEYXRlLnNldEZ1bGxZZWFyKG5ld0RhdGUuZ2V0RnVsbFllYXIoKSArIGRlbHRhKTtcbiAgICB9XG5cbiAgICAvKiogU3BpbnMgdGhlIGhvdXJzIHBvcnRpb24gaW4gYSBkYXRlLXRpbWUgZWRpdG9yLiAqL1xuICAgIHB1YmxpYyBzdGF0aWMgc3BpbkhvdXJzKGRlbHRhOiBudW1iZXIsIG5ld0RhdGU6IERhdGUsIHNwaW5Mb29wOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1heEhvdXIgPSAyMztcbiAgICAgICAgY29uc3QgbWluSG91ciA9IDA7XG4gICAgICAgIGxldCBob3VycyA9IG5ld0RhdGUuZ2V0SG91cnMoKSArIGRlbHRhO1xuICAgICAgICBpZiAoaG91cnMgPiBtYXhIb3VyKSB7XG4gICAgICAgICAgICBob3VycyA9IHNwaW5Mb29wID8gaG91cnMgJSBtYXhIb3VyIC0gMSA6IG1heEhvdXI7XG4gICAgICAgIH0gZWxzZSBpZiAoaG91cnMgPCBtaW5Ib3VyKSB7XG4gICAgICAgICAgICBob3VycyA9IHNwaW5Mb29wID8gbWF4SG91ciArIChob3VycyAlIG1heEhvdXIpICsgMSA6IG1pbkhvdXI7XG4gICAgICAgIH1cblxuICAgICAgICBuZXdEYXRlLnNldEhvdXJzKGhvdXJzKTtcbiAgICB9XG5cbiAgICAvKiogU3BpbnMgdGhlIG1pbnV0ZXMgcG9ydGlvbiBpbiBhIGRhdGUtdGltZSBlZGl0b3IuICovXG4gICAgcHVibGljIHN0YXRpYyBzcGluTWludXRlcyhkZWx0YTogbnVtYmVyLCBuZXdEYXRlOiBEYXRlLCBzcGluTG9vcDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBjb25zdCBtYXhNaW51dGVzID0gNTk7XG4gICAgICAgIGNvbnN0IG1pbk1pbnV0ZXMgPSAwO1xuICAgICAgICBsZXQgbWludXRlcyA9IG5ld0RhdGUuZ2V0TWludXRlcygpICsgZGVsdGE7XG4gICAgICAgIGlmIChtaW51dGVzID4gbWF4TWludXRlcykge1xuICAgICAgICAgICAgbWludXRlcyA9IHNwaW5Mb29wID8gbWludXRlcyAlIG1heE1pbnV0ZXMgLSAxIDogbWF4TWludXRlcztcbiAgICAgICAgfSBlbHNlIGlmIChtaW51dGVzIDwgbWluTWludXRlcykge1xuICAgICAgICAgICAgbWludXRlcyA9IHNwaW5Mb29wID8gbWF4TWludXRlcyArIChtaW51dGVzICUgbWF4TWludXRlcykgKyAxIDogbWluTWludXRlcztcbiAgICAgICAgfVxuXG4gICAgICAgIG5ld0RhdGUuc2V0TWludXRlcyhtaW51dGVzKTtcbiAgICB9XG5cbiAgICAvKiogU3BpbnMgdGhlIHNlY29uZHMgcG9ydGlvbiBpbiBhIGRhdGUtdGltZSBlZGl0b3IuICovXG4gICAgcHVibGljIHN0YXRpYyBzcGluU2Vjb25kcyhkZWx0YTogbnVtYmVyLCBuZXdEYXRlOiBEYXRlLCBzcGluTG9vcDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBjb25zdCBtYXhTZWNvbmRzID0gNTk7XG4gICAgICAgIGNvbnN0IG1pblNlY29uZHMgPSAwO1xuICAgICAgICBsZXQgc2Vjb25kcyA9IG5ld0RhdGUuZ2V0U2Vjb25kcygpICsgZGVsdGE7XG4gICAgICAgIGlmIChzZWNvbmRzID4gbWF4U2Vjb25kcykge1xuICAgICAgICAgICAgc2Vjb25kcyA9IHNwaW5Mb29wID8gc2Vjb25kcyAlIG1heFNlY29uZHMgLSAxIDogbWF4U2Vjb25kcztcbiAgICAgICAgfSBlbHNlIGlmIChzZWNvbmRzIDwgbWluU2Vjb25kcykge1xuICAgICAgICAgICAgc2Vjb25kcyA9IHNwaW5Mb29wID8gbWF4U2Vjb25kcyArIChzZWNvbmRzICUgbWF4U2Vjb25kcykgKyAxIDogbWluU2Vjb25kcztcbiAgICAgICAgfVxuXG4gICAgICAgIG5ld0RhdGUuc2V0U2Vjb25kcyhzZWNvbmRzKTtcbiAgICB9XG5cbiAgICAgLyoqIFNwaW5zIHRoZSBmcmFjdGlvbmFsIHNlY29uZHMgKG1pbGxpc2Vjb25kcykgcG9ydGlvbiBpbiBhIGRhdGUtdGltZSBlZGl0b3IuICovXG4gICAgcHVibGljIHN0YXRpYyBzcGluRnJhY3Rpb25hbFNlY29uZHMoZGVsdGE6IG51bWJlciwgbmV3RGF0ZTogRGF0ZSwgc3Bpbkxvb3A6IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgbWF4TXMgPSA5OTk7XG4gICAgICAgIGNvbnN0IG1pbk1zID0gMDtcbiAgICAgICAgbGV0IG1zID0gbmV3RGF0ZS5nZXRNaWxsaXNlY29uZHMoKSArIGRlbHRhO1xuICAgICAgICBpZiAobXMgPiBtYXhNcykge1xuICAgICAgICAgICAgbXMgPSBzcGluTG9vcCA/IG1zICUgbWF4TXMgLSAxIDogbWF4TXM7XG4gICAgICAgIH0gZWxzZSBpZiAobXMgPCBtaW5Ncykge1xuICAgICAgICAgICAgbXMgPSBzcGluTG9vcCA/IG1heE1zICsgKG1zICUgbWF4TXMpICsgMSA6IG1pbk1zO1xuICAgICAgICB9XG5cbiAgICAgICAgbmV3RGF0ZS5zZXRNaWxsaXNlY29uZHMobXMpO1xuICAgIH1cblxuICAgIC8qKiBTcGlucyB0aGUgQU0vUE0gcG9ydGlvbiBpbiBhIGRhdGUtdGltZSBlZGl0b3IuICovXG4gICAgcHVibGljIHN0YXRpYyBzcGluQW1QbShuZXdEYXRlOiBEYXRlLCBjdXJyZW50RGF0ZTogRGF0ZSwgYW1QbUZyb21NYXNrOiBzdHJpbmcpOiBEYXRlIHtcbiAgICAgICAgaWYoRGF0ZVRpbWVVdGlsLmlzQW0oYW1QbUZyb21NYXNrKSkge1xuICAgICAgICAgICAgbmV3RGF0ZSA9IG5ldyBEYXRlKG5ld0RhdGUuc2V0SG91cnMobmV3RGF0ZS5nZXRIb3VycygpICsgMTIpKTtcbiAgICAgICAgfSBlbHNlIGlmKERhdGVUaW1lVXRpbC5pc1BtKGFtUG1Gcm9tTWFzaykpIHtcbiAgICAgICAgICAgIG5ld0RhdGUgPSBuZXcgRGF0ZShuZXdEYXRlLnNldEhvdXJzKG5ld0RhdGUuZ2V0SG91cnMoKSAtIDEyKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV3RGF0ZS5nZXREYXRlKCkgIT09IGN1cnJlbnREYXRlLmdldERhdGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnREYXRlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ld0RhdGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwcm92aWRlZCB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIHByb3ZpZGVkIG1heCB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbmNsdWRlVGltZSBzZXQgdG8gZmFsc2UgaWYgeW91IHdhbnQgdG8gZXhjbHVkZSB0aW1lIHBvcnRpb24gb2YgdGhlIHR3byBkYXRlc1xuICAgICAqIEBwYXJhbSBpbmNsdWRlRGF0ZSBzZXQgdG8gZmFsc2UgaWYgeW91IHdhbnQgdG8gZXhjbHVkZSB0aGUgZGF0ZSBwb3J0aW9uIG9mIHRoZSB0d28gZGF0ZXNcbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHByb3ZpZGVkIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBwcm92aWRlZCBtYXhWYWx1ZVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZ3JlYXRlclRoYW5NYXhWYWx1ZSh2YWx1ZTogRGF0ZSwgbWF4VmFsdWU6IERhdGUsIGluY2x1ZGVUaW1lID0gdHJ1ZSwgaW5jbHVkZURhdGUgPSB0cnVlKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChpbmNsdWRlVGltZSAmJiBpbmNsdWRlRGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLmdldFRpbWUoKSA+IG1heFZhbHVlLmdldFRpbWUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IF92YWx1ZSA9IG5ldyBEYXRlKHZhbHVlLmdldFRpbWUoKSk7XG4gICAgICAgIGNvbnN0IF9tYXhWYWx1ZSA9IG5ldyBEYXRlKG1heFZhbHVlLmdldFRpbWUoKSk7XG4gICAgICAgIGlmICghaW5jbHVkZVRpbWUpIHtcbiAgICAgICAgICAgIF92YWx1ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcbiAgICAgICAgICAgIF9tYXhWYWx1ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWluY2x1ZGVEYXRlKSB7XG4gICAgICAgICAgICBfdmFsdWUuc2V0RnVsbFllYXIoMCwgMCwgMCk7XG4gICAgICAgICAgICBfbWF4VmFsdWUuc2V0RnVsbFllYXIoMCwgMCwgMCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gX3ZhbHVlLmdldFRpbWUoKSA+IF9tYXhWYWx1ZS5nZXRUaW1lKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwcm92aWRlZCB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIHByb3ZpZGVkIG1pbiB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbmNsdWRlVGltZSBzZXQgdG8gZmFsc2UgaWYgeW91IHdhbnQgdG8gZXhjbHVkZSB0aW1lIHBvcnRpb24gb2YgdGhlIHR3byBkYXRlc1xuICAgICAqIEBwYXJhbSBpbmNsdWRlRGF0ZSBzZXQgdG8gZmFsc2UgaWYgeW91IHdhbnQgdG8gZXhjbHVkZSB0aGUgZGF0ZSBwb3J0aW9uIG9mIHRoZSB0d28gZGF0ZXNcbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHByb3ZpZGVkIHZhbHVlIGlzIGxlc3MgdGhhbiBwcm92aWRlZCBtaW5WYWx1ZVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgbGVzc1RoYW5NaW5WYWx1ZSh2YWx1ZTogRGF0ZSwgbWluVmFsdWU6IERhdGUsIGluY2x1ZGVUaW1lID0gdHJ1ZSwgaW5jbHVkZURhdGUgPSB0cnVlKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChpbmNsdWRlVGltZSAmJiBpbmNsdWRlRGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLmdldFRpbWUoKSA8IG1pblZhbHVlLmdldFRpbWUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IF92YWx1ZSA9IG5ldyBEYXRlKHZhbHVlLmdldFRpbWUoKSk7XG4gICAgICAgIGNvbnN0IF9taW5WYWx1ZSA9IG5ldyBEYXRlKG1pblZhbHVlLmdldFRpbWUoKSk7XG4gICAgICAgIGlmICghaW5jbHVkZVRpbWUpIHtcbiAgICAgICAgICAgIF92YWx1ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcbiAgICAgICAgICAgIF9taW5WYWx1ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWluY2x1ZGVEYXRlKSB7XG4gICAgICAgICAgICBfdmFsdWUuc2V0RnVsbFllYXIoMCwgMCwgMCk7XG4gICAgICAgICAgICBfbWluVmFsdWUuc2V0RnVsbFllYXIoMCwgMCwgMCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gX3ZhbHVlLmdldFRpbWUoKSA8IF9taW5WYWx1ZS5nZXRUaW1lKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGVzIGEgdmFsdWUgd2l0aGluIGEgZ2l2ZW4gbWluIGFuZCBtYXggdmFsdWUgcmFuZ2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgVGhlIHZhbHVlIHRvIHZhbGlkYXRlXG4gICAgICogQHBhcmFtIG1pblZhbHVlIFRoZSBsb3dlc3QgcG9zc2libGUgdmFsdWUgdGhhdCBgdmFsdWVgIGNhbiB0YWtlXG4gICAgICogQHBhcmFtIG1heFZhbHVlIFRoZSBsYXJnZXN0IHBvc3NpYmxlIHZhbHVlIHRoYXQgYHZhbHVlYCBjYW4gdGFrZVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgdmFsaWRhdGVNaW5NYXgodmFsdWU6IERhdGUsIG1pblZhbHVlOiBEYXRlIHwgc3RyaW5nLCBtYXhWYWx1ZTogRGF0ZSB8IHN0cmluZyxcbiAgICAgICAgaW5jbHVkZVRpbWUgPSB0cnVlLCBpbmNsdWRlRGF0ZSA9IHRydWUpOiBWYWxpZGF0aW9uRXJyb3JzIHtcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZXJyb3JzID0ge307XG4gICAgICAgIGNvbnN0IG1pbiA9IERhdGVUaW1lVXRpbC5pc1ZhbGlkRGF0ZShtaW5WYWx1ZSkgPyBtaW5WYWx1ZSA6IERhdGVUaW1lVXRpbC5wYXJzZUlzb0RhdGUobWluVmFsdWUpO1xuICAgICAgICBjb25zdCBtYXggPSBEYXRlVGltZVV0aWwuaXNWYWxpZERhdGUobWF4VmFsdWUpID8gbWF4VmFsdWUgOiBEYXRlVGltZVV0aWwucGFyc2VJc29EYXRlKG1heFZhbHVlKTtcbiAgICAgICAgaWYgKG1pbiAmJiB2YWx1ZSAmJiBEYXRlVGltZVV0aWwubGVzc1RoYW5NaW5WYWx1ZSh2YWx1ZSwgbWluLCBpbmNsdWRlVGltZSwgaW5jbHVkZURhdGUpKSB7XG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGVycm9ycywgeyBtaW5WYWx1ZTogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWF4ICYmIHZhbHVlICYmIERhdGVUaW1lVXRpbC5ncmVhdGVyVGhhbk1heFZhbHVlKHZhbHVlLCBtYXgsIGluY2x1ZGVUaW1lLCBpbmNsdWRlRGF0ZSkpIHtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXJyb3JzLCB7IG1heFZhbHVlOiB0cnVlIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVycm9ycztcbiAgICB9XG5cbiAgICAvKiogUGFyc2UgYW4gSVNPIHN0cmluZyB0byBhIERhdGUgKi9cbiAgICBwdWJsaWMgc3RhdGljIHBhcnNlSXNvRGF0ZSh2YWx1ZTogc3RyaW5nKTogRGF0ZSB8IG51bGwge1xuICAgICAgICBsZXQgcmVnZXggPSAvXlxcZHs0fS9nO1xuICAgICAgICBjb25zdCB0aW1lTGl0ZXJhbCA9ICdUJztcbiAgICAgICAgaWYgKHJlZ2V4LnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUodmFsdWUgKyBgJHt2YWx1ZS5pbmRleE9mKHRpbWVMaXRlcmFsKSA9PT0gLTEgPyAnVDAwOjAwOjAwJyA6ICcnfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVnZXggPSAvXlxcZHsyfS9nO1xuICAgICAgICBpZiAocmVnZXgudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGVOb3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XG4gICAgICAgICAgICBsZXQgW2RhdGVQYXJ0LCBfdGltZVBhcnRdID0gZGF0ZU5vdy5zcGxpdCh0aW1lTGl0ZXJhbCk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoYCR7ZGF0ZVBhcnR9VCR7dmFsdWV9YCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGlucHV0IGlzIHZhbGlkIGRhdGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSBpbnB1dCB0byBjaGVja1xuICAgICAqIEByZXR1cm5zIHRydWUgaWYgcHJvdmlkZWQgaW5wdXQgaXMgYSB2YWxpZCBkYXRlXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBpc1ZhbGlkRGF0ZSh2YWx1ZTogYW55KTogdmFsdWUgaXMgRGF0ZSB7XG4gICAgICAgIGlmIChpc0RhdGUodmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gIWlzTmFOKHZhbHVlLmdldFRpbWUoKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBpc0Zvcm1hdE51bWVyaWMobG9jYWxlOiBzdHJpbmcsIGlucHV0Rm9ybWF0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgZGF0ZVBhcnRzID0gRGF0ZVRpbWVVdGlsLnBhcnNlRGF0ZVRpbWVGb3JtYXQoaW5wdXRGb3JtYXQpO1xuICAgICAgICBpZiAocHJlZGVmaW5lZE5vbk51bWVyaWNGb3JtYXRzLmhhcyhpbnB1dEZvcm1hdCkgfHwgZGF0ZVBhcnRzLmV2ZXJ5KHAgPT4gcC50eXBlID09PSBEYXRlUGFydC5MaXRlcmFsKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0ZVBhcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoZGF0ZVBhcnRzW2ldLnR5cGUgPT09IERhdGVQYXJ0LkFtUG0gfHwgZGF0ZVBhcnRzW2ldLnR5cGUgPT09IERhdGVQYXJ0LkxpdGVyYWwpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkVmFsdWUgPSBmb3JtYXREYXRlKG5ldyBEYXRlKCksIGRhdGVQYXJ0c1tpXS5mb3JtYXQsIGxvY2FsZSk7XG4gICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgdHJhbnNmb3JtZWQgZGF0ZS90aW1lIHBhcnQgY29udGFpbnMgYW55IGtpbmQgb2YgbGV0dGVyIGZyb20gYW55IGxhbmd1YWdlXG4gICAgICAgICAgICBpZiAoL1xccHtMfSsvZ3UudGVzdCh0cmFuc2Zvcm1lZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGlucHV0IGZvcm1hdCB0aGF0IGNhbiBiZSB1c2VkIGJ5IHRoZSBkYXRlLXRpbWUgZWRpdG9ycywgYXNcbiAgICAgKiAtIGlmIHRoZSBmb3JtYXQgaXMgYWxyZWFkeSBudW1lcmljLCByZXR1cm4gaXQgYXMgaXNcbiAgICAgKiAtIGlmIGl0IGlzIGFtb25nIHRoZSBwcmVkZWZpbmVkIG51bWVyaWMgb25lcywgcmV0dXJuIGl0IGFzIHRoZSBlcXVpdmFsZW50IGxvY2FsZS1iYXNlZCBmb3JtYXRcbiAgICAgKiAgIGZvciB0aGUgY29ycmVzcG9uZGluZyBudW1lcmljIGRhdGUgcGFydHNcbiAgICAgKiAtIG90aGVyd2lzZSwgcmV0dXJuIGFuIGVtcHR5IHN0cmluZ1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZ2V0TnVtZXJpY0lucHV0Rm9ybWF0KGxvY2FsZTogc3RyaW5nLCBmb3JtYXQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGxldCByZXN1bHRGb3JtYXQgPSAnJztcbiAgICAgICAgaWYgKCFmb3JtYXQpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRGb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByZWRlZmluZWROdW1lcmljRm9ybWF0cy5oYXMoZm9ybWF0KSkge1xuICAgICAgICAgICAgcmVzdWx0Rm9ybWF0ID0gRGF0ZVRpbWVVdGlsLmdldExvY2FsZUlucHV0Rm9ybWF0RnJvbVBhcnRzKGxvY2FsZSwgcHJlZGVmaW5lZE51bWVyaWNGb3JtYXRzLmdldChmb3JtYXQpKTtcblxuICAgICAgICB9IGVsc2UgaWYgKERhdGVUaW1lVXRpbC5pc0Zvcm1hdE51bWVyaWMobG9jYWxlLCBmb3JtYXQpKSB7XG4gICAgICAgICAgICByZXN1bHRGb3JtYXQgPSBmb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdEZvcm1hdDtcbiAgICB9XG5cbiAgICAvKiogR2V0cyB0aGUgbG9jYWxlLWJhc2VkIGZvcm1hdCBmcm9tIGFuIGFycmF5IG9mIGRhdGUgcGFydHMgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBnZXRMb2NhbGVJbnB1dEZvcm1hdEZyb21QYXJ0cyhsb2NhbGU6IHN0cmluZywgZGF0ZVBhcnRzOiBEYXRlUGFydHNbXSk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7fTtcbiAgICAgICAgZGF0ZVBhcnRzLmZvckVhY2gocCA9PiB7XG4gICAgICAgICAgICBpZiAocCA9PT0gRGF0ZVBhcnRzLlllYXIpIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zW3BdID0gRm9ybWF0RGVzYy5OdW1lcmljO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwICE9PSBEYXRlUGFydHMuQW1QbSkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnNbcF0gPSBGb3JtYXREZXNjLlR3b0RpZ2l0cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlciA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgb3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IGRhdGVTdHJ1Y3QgPSBEYXRlVGltZVV0aWwuZ2V0RGF0ZVN0cnVjdEZyb21QYXJ0cyhmb3JtYXR0ZXIuZm9ybWF0VG9QYXJ0cyhuZXcgRGF0ZSgpKSwgZm9ybWF0dGVyKTtcbiAgICAgICAgRGF0ZVRpbWVVdGlsLmZpbGxEYXRlUGFydHNQb3NpdGlvbnMoZGF0ZVN0cnVjdCk7XG4gICAgICAgIHJldHVybiBEYXRlVGltZVV0aWwuZ2V0TWFzayhkYXRlU3RydWN0KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBhZGRDdXJyZW50UGFydChjdXJyZW50UGFydDogRGF0ZVBhcnRJbmZvLCBkYXRlVGltZVBhcnRzOiBEYXRlUGFydEluZm9bXSk6IHZvaWQge1xuICAgICAgICBEYXRlVGltZVV0aWwuZW5zdXJlTGVhZGluZ1plcm8oY3VycmVudFBhcnQpO1xuICAgICAgICBjdXJyZW50UGFydC5lbmQgPSBjdXJyZW50UGFydC5zdGFydCArIGN1cnJlbnRQYXJ0LmZvcm1hdC5sZW5ndGg7XG4gICAgICAgIGRhdGVUaW1lUGFydHMucHVzaChjdXJyZW50UGFydCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZGF5c0luTW9udGgoZnVsbFllYXI6IG51bWJlciwgbW9udGg6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShmdWxsWWVhciwgbW9udGggKyAxLCAwKS5nZXREYXRlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgdHJpbUVtcHR5UGxhY2Vob2xkZXJzKHZhbHVlOiBzdHJpbmcsIHByb21wdENoYXI/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCByZXN1bHQgPSB2YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAocHJvbXB0Q2hhciB8fCAnXycsICdnJyksICcnKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBnZXRNYXNrKGRhdGVTdHJ1Y3Q6IGFueVtdKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgbWFzayA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgZGF0ZVN0cnVjdCkge1xuICAgICAgICAgICAgaWYgKHBhcnQuZm9ybWF0VHlwZSA9PT0gRm9ybWF0RGVzYy5OdW1lcmljKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChwYXJ0LnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuRGF5OlxuICAgICAgICAgICAgICAgICAgICAgICAgbWFzay5wdXNoKCdkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuTW9udGg6XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXNrLnB1c2goJ00nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIERhdGVQYXJ0cy5ZZWFyOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWFzay5wdXNoKCd5eXl5Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuSG91cjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hc2sucHVzaChwYXJ0LmhvdXIxMiA/ICdoJyA6ICdIJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuTWludXRlOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWFzay5wdXNoKCdtJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuU2Vjb25kOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWFzay5wdXNoKCdzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnQuZm9ybWF0VHlwZSA9PT0gRm9ybWF0RGVzYy5Ud29EaWdpdHMpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcnQudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIERhdGVQYXJ0cy5EYXk6XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXNrLnB1c2goJ2RkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuTW9udGg6XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXNrLnB1c2goJ01NJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuWWVhcjpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hc2sucHVzaCgneXknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIERhdGVQYXJ0cy5Ib3VyOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWFzay5wdXNoKHBhcnQuaG91cjEyID8gJ2hoJyA6ICdISCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRGF0ZVBhcnRzLk1pbnV0ZTpcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hc2sucHVzaCgnbW0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIERhdGVQYXJ0cy5TZWNvbmQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXNrLnB1c2goJ3NzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwYXJ0LnR5cGUgPT09IERhdGVQYXJ0cy5BbVBtKSB7XG4gICAgICAgICAgICAgICAgbWFzay5wdXNoKCd0dCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocGFydC50eXBlID09PSBEYXRlVGltZVV0aWwuU0VQQVJBVE9SKSB7XG4gICAgICAgICAgICAgICAgbWFzay5wdXNoKHBhcnQudmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG1hc2suam9pbignJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgbG9nTWlzc2luZ0xvY2FsZVNldHRpbmdzKGxvY2FsZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIGNvbnNvbGUud2FybihgTWlzc2luZyBsb2NhbGUgZGF0YSBmb3IgdGhlIGxvY2FsZSAke2xvY2FsZX0uIFBsZWFzZSByZWZlciB0byBodHRwczovL2FuZ3VsYXIuaW8vZ3VpZGUvaTE4biNpMThuLXBpcGVzYCk7XG4gICAgICAgIGNvbnNvbGUud2FybignVXNpbmcgZGVmYXVsdCBicm93c2VyIGxvY2FsZSBzZXR0aW5ncy4nKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBwcmVwZW5kVmFsdWUodmFsdWU6IG51bWJlciwgcGFydExlbmd0aDogbnVtYmVyLCBwcmVwZW5kQ2hhcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIChwcmVwZW5kQ2hhciArIHZhbHVlLnRvU3RyaW5nKCkpLnNsaWNlKC1wYXJ0TGVuZ3RoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyB0b1R3ZWx2ZUhvdXJGb3JtYXQodmFsdWU6IHN0cmluZywgcHJvbXB0Q2hhciA9ICdfJyk6IG51bWJlciB7XG4gICAgICAgIGxldCBob3VyID0gcGFyc2VJbnQodmFsdWUucmVwbGFjZShuZXcgUmVnRXhwKHByb21wdENoYXIsICdnJyksICcwJyksIDEwKTtcbiAgICAgICAgaWYgKGhvdXIgPiAxMikge1xuICAgICAgICAgICAgaG91ciAtPSAxMjtcbiAgICAgICAgfSBlbHNlIGlmIChob3VyID09PSAwKSB7XG4gICAgICAgICAgICBob3VyID0gMTI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaG91cjtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBlbnN1cmVMZWFkaW5nWmVybyhwYXJ0OiBEYXRlUGFydEluZm8pIHtcbiAgICAgICAgc3dpdGNoIChwYXJ0LnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgRGF0ZVBhcnQuRGF0ZTpcbiAgICAgICAgICAgIGNhc2UgRGF0ZVBhcnQuTW9udGg6XG4gICAgICAgICAgICBjYXNlIERhdGVQYXJ0LkhvdXJzOlxuICAgICAgICAgICAgY2FzZSBEYXRlUGFydC5NaW51dGVzOlxuICAgICAgICAgICAgY2FzZSBEYXRlUGFydC5TZWNvbmRzOlxuICAgICAgICAgICAgICAgIGlmIChwYXJ0LmZvcm1hdC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFydC5mb3JtYXQgPSBwYXJ0LmZvcm1hdC5yZXBlYXQoMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBEYXRlUGFydC5GcmFjdGlvbmFsU2Vjb25kczpcbiAgICAgICAgICAgICAgICBwYXJ0LmZvcm1hdCA9IHBhcnQuZm9ybWF0WzBdLnJlcGVhdCgzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGdldENsZWFuVmFsKGlucHV0RGF0YTogc3RyaW5nLCBkYXRlUGFydDogRGF0ZVBhcnRJbmZvLCBwcm9tcHRDaGFyPzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIERhdGVUaW1lVXRpbC50cmltRW1wdHlQbGFjZWhvbGRlcnMoaW5wdXREYXRhLnN1YnN0cmluZyhkYXRlUGFydC5zdGFydCwgZGF0ZVBhcnQuZW5kKSwgcHJvbXB0Q2hhcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZGV0ZXJtaW5lRGF0ZVBhcnQoY2hhcjogc3RyaW5nKTogRGF0ZVBhcnQge1xuICAgICAgICBzd2l0Y2ggKGNoYXIpIHtcbiAgICAgICAgICAgIGNhc2UgJ2QnOlxuICAgICAgICAgICAgY2FzZSAnRCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGVQYXJ0LkRhdGU7XG4gICAgICAgICAgICBjYXNlICdNJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0ZVBhcnQuTW9udGg7XG4gICAgICAgICAgICBjYXNlICd5JzpcbiAgICAgICAgICAgIGNhc2UgJ1knOlxuICAgICAgICAgICAgICAgIHJldHVybiBEYXRlUGFydC5ZZWFyO1xuICAgICAgICAgICAgY2FzZSAnaCc6XG4gICAgICAgICAgICBjYXNlICdIJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0ZVBhcnQuSG91cnM7XG4gICAgICAgICAgICBjYXNlICdtJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0ZVBhcnQuTWludXRlcztcbiAgICAgICAgICAgIGNhc2UgJ3MnOlxuICAgICAgICAgICAgICAgIHJldHVybiBEYXRlUGFydC5TZWNvbmRzO1xuICAgICAgICAgICAgY2FzZSAnUyc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGVQYXJ0LkZyYWN0aW9uYWxTZWNvbmRzO1xuICAgICAgICAgICAgY2FzZSAnYSc6XG4gICAgICAgICAgICBjYXNlICd0JzpcbiAgICAgICAgICAgIGNhc2UgJ1QnOlxuICAgICAgICAgICAgICAgIHJldHVybiBEYXRlUGFydC5BbVBtO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0ZVBhcnQuTGl0ZXJhbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGdldEZvcm1hdE9wdGlvbnMoZGF0YVR5cGU6IERhdGFUeXBlKSB7XG4gICAgICAgIGNvbnN0IGRhdGVPcHRpb25zID0ge1xuICAgICAgICAgICAgZGF5OiBGb3JtYXREZXNjLlR3b0RpZ2l0cyxcbiAgICAgICAgICAgIG1vbnRoOiBGb3JtYXREZXNjLlR3b0RpZ2l0cyxcbiAgICAgICAgICAgIHllYXI6IEZvcm1hdERlc2MuTnVtZXJpY1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCB0aW1lT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGhvdXI6IEZvcm1hdERlc2MuVHdvRGlnaXRzLFxuICAgICAgICAgICAgbWludXRlOiBGb3JtYXREZXNjLlR3b0RpZ2l0c1xuICAgICAgICB9O1xuICAgICAgICBzd2l0Y2ggKGRhdGFUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlLkRhdGU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGVPcHRpb25zO1xuICAgICAgICAgICAgY2FzZSBEYXRhVHlwZS5UaW1lOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aW1lT3B0aW9ucztcbiAgICAgICAgICAgIGNhc2UgRGF0YVR5cGUuRGF0ZVRpbWU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgLi4uZGF0ZU9wdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgIC4uLnRpbWVPcHRpb25zLFxuICAgICAgICAgICAgICAgICAgICBzZWNvbmQ6IEZvcm1hdERlc2MuVHdvRGlnaXRzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGdldERlZmF1bHRMb2NhbGVNYXNrKGxvY2FsZTogc3RyaW5nLCBkYXRhVHlwZTogRGF0YVR5cGUgPSBEYXRhVHlwZS5EYXRlKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBEYXRlVGltZVV0aWwuZ2V0Rm9ybWF0T3B0aW9ucyhkYXRhVHlwZSk7XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlciA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgb3B0aW9ucyk7XG4gICAgICAgIGNvbnN0IGZvcm1hdFRvUGFydHMgPSBmb3JtYXR0ZXIuZm9ybWF0VG9QYXJ0cyhuZXcgRGF0ZSgpKTtcbiAgICAgICAgY29uc3QgZGF0ZVN0cnVjdCA9IERhdGVUaW1lVXRpbC5nZXREYXRlU3RydWN0RnJvbVBhcnRzKGZvcm1hdFRvUGFydHMsIGZvcm1hdHRlcik7XG4gICAgICAgIERhdGVUaW1lVXRpbC5maWxsRGF0ZVBhcnRzUG9zaXRpb25zKGRhdGVTdHJ1Y3QpO1xuICAgICAgICByZXR1cm4gZGF0ZVN0cnVjdDtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBnZXREYXRlU3RydWN0RnJvbVBhcnRzKHBhcnRzOiBJbnRsLkRhdGVUaW1lRm9ybWF0UGFydFtdLCBmb3JtYXR0ZXI6IEludGwuRGF0ZVRpbWVGb3JtYXQpOiBhbnlbXSB7XG4gICAgICAgIGNvbnN0IGRhdGVTdHJ1Y3QgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIHBhcnRzKSB7XG4gICAgICAgICAgICBpZiAocGFydC50eXBlID09PSBEYXRlVGltZVV0aWwuU0VQQVJBVE9SKSB7XG4gICAgICAgICAgICAgICAgZGF0ZVN0cnVjdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogRGF0ZVRpbWVVdGlsLlNFUEFSQVRPUixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBhcnQudmFsdWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGF0ZVN0cnVjdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogcGFydC50eXBlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZm9ybWF0dGVyT3B0aW9ucyA9IGZvcm1hdHRlci5yZXNvbHZlZE9wdGlvbnMoKTtcbiAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIGRhdGVTdHJ1Y3QpIHtcbiAgICAgICAgICAgIHN3aXRjaCAocGFydC50eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuRGF5OiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnQuZm9ybWF0VHlwZSA9IGZvcm1hdHRlck9wdGlvbnMuZGF5O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuTW9udGg6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydC5mb3JtYXRUeXBlID0gZm9ybWF0dGVyT3B0aW9ucy5tb250aDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgRGF0ZVBhcnRzLlllYXI6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydC5mb3JtYXRUeXBlID0gZm9ybWF0dGVyT3B0aW9ucy55ZWFyO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FzZSBEYXRlUGFydHMuSG91cjoge1xuICAgICAgICAgICAgICAgICAgICBwYXJ0LmZvcm1hdFR5cGUgPSBmb3JtYXR0ZXJPcHRpb25zLmhvdXI7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JtYXR0ZXJPcHRpb25zLmhvdXIxMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFydC5ob3VyMTIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIERhdGVQYXJ0cy5NaW51dGU6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydC5mb3JtYXRUeXBlID0gZm9ybWF0dGVyT3B0aW9ucy5taW51dGU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIERhdGVQYXJ0cy5TZWNvbmQ6IHtcbiAgICAgICAgICAgICAgICAgICAgcGFydC5mb3JtYXRUeXBlID0gZm9ybWF0dGVyT3B0aW9ucy5zZWNvbmQ7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlIERhdGVQYXJ0cy5BbVBtOiB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnQuZm9ybWF0VHlwZSA9IGZvcm1hdHRlck9wdGlvbnMuZGF5UGVyaW9kO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGVTdHJ1Y3Q7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGF0aWMgZmlsbERhdGVQYXJ0c1Bvc2l0aW9ucyhkYXRlQXJyYXk6IGFueVtdKTogdm9pZCB7XG4gICAgICAgIGxldCBjdXJyZW50UG9zID0gMDtcblxuICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgZGF0ZUFycmF5KSB7XG4gICAgICAgICAgICAvLyBEYXl8TW9udGh8SG91cnxNaW51dGV8U2Vjb25kfEFtUG0gcGFydCBwb3NpdGlvbnNcbiAgICAgICAgICAgIGlmIChwYXJ0LnR5cGUgPT09IERhdGVQYXJ0cy5EYXkgfHwgcGFydC50eXBlID09PSBEYXRlUGFydHMuTW9udGggfHxcbiAgICAgICAgICAgICAgICBwYXJ0LnR5cGUgPT09IERhdGVQYXJ0cy5Ib3VyIHx8IHBhcnQudHlwZSA9PT0gRGF0ZVBhcnRzLk1pbnV0ZSB8fCBwYXJ0LnR5cGUgPT09IERhdGVQYXJ0cy5TZWNvbmQgfHxcbiAgICAgICAgICAgICAgICBwYXJ0LnR5cGUgPT09IERhdGVQYXJ0cy5BbVBtXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAvLyBPZmZzZXQgMiBwb3NpdGlvbnMgZm9yIG51bWJlclxuICAgICAgICAgICAgICAgIHBhcnQucG9zaXRpb24gPSBbY3VycmVudFBvcywgY3VycmVudFBvcyArIDJdO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRQb3MgKz0gMjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlID09PSBEYXRlUGFydHMuWWVhcikge1xuICAgICAgICAgICAgICAgIC8vIFllYXIgcGFydCBwb3NpdGlvbnNcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcnQuZm9ybWF0VHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEZvcm1hdERlc2MuTnVtZXJpYzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gT2Zmc2V0IDQgcG9zaXRpb25zIGZvciBmdWxsIHllYXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQucG9zaXRpb24gPSBbY3VycmVudFBvcywgY3VycmVudFBvcyArIDRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBvcyArPSA0O1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBGb3JtYXREZXNjLlR3b0RpZ2l0czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gT2Zmc2V0IDIgcG9zaXRpb25zIGZvciBzaG9ydCB5ZWFyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0LnBvc2l0aW9uID0gW2N1cnJlbnRQb3MsIGN1cnJlbnRQb3MgKyAyXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3MgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LnR5cGUgPT09IERhdGVUaW1lVXRpbC5TRVBBUkFUT1IpIHtcbiAgICAgICAgICAgICAgICAvLyBTZXBhcmF0b3IgcG9zaXRpb25zXG4gICAgICAgICAgICAgICAgcGFydC5wb3NpdGlvbiA9IFtjdXJyZW50UG9zLCBjdXJyZW50UG9zICsgMV07XG4gICAgICAgICAgICAgICAgY3VycmVudFBvcysrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19