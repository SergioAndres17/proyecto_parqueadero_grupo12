import { IgxGridNavigationService } from '../grid-navigation.service';
import { Injectable } from '@angular/core';
import { HEADER_KEYS, ROW_COLLAPSE_KEYS, ROW_EXPAND_KEYS } from '../../core/utils';
import { PivotUtil } from './pivot-util';
import { SortingDirection } from '../../data-operations/sorting-strategy';
import { take, timeout } from 'rxjs/operators';
import { PivotSummaryPosition } from './pivot-grid.interface';
import * as i0 from "@angular/core";
export class IgxPivotGridNavigationService extends IgxGridNavigationService {
    constructor() {
        super(...arguments);
        this.isRowHeaderActive = false;
        this.isRowDimensionHeaderActive = false;
    }
    get lastRowDimensionsIndex() {
        return this.grid.visibleRowDimensions.length - 1;
    }
    get lastRowDimensionMRLRowIndex() {
        return this.grid.verticalRowDimScrollContainers.first.igxGridForOf.length - 1;
    }
    focusOutRowHeader() {
        this.isRowHeaderActive = false;
        this.isRowDimensionHeaderActive = false;
    }
    async handleNavigation(event) {
        if (this.isRowHeaderActive) {
            const key = event.key.toLowerCase();
            const ctrl = event.ctrlKey;
            if (!HEADER_KEYS.has(key)) {
                return;
            }
            event.preventDefault();
            const newActiveNode = {
                row: this.activeNode.row,
                column: this.activeNode.column,
                level: null,
                mchCache: null,
                layout: this.activeNode.layout
            };
            if (event.altKey) {
                this.handleAlt(key, event);
                return;
            }
            let verticalContainer;
            if (this.grid.hasHorizontalLayout) {
                let newPosition = {
                    row: this.activeNode.row,
                    column: this.activeNode.column,
                    layout: this.activeNode.layout
                };
                verticalContainer = this.grid.verticalRowDimScrollContainers.first;
                if (key.includes('left')) {
                    newPosition = await this.getNextHorizontalPosition(true, ctrl);
                }
                if (key.includes('right')) {
                    newPosition = await this.getNextHorizontalPosition(false, ctrl);
                }
                if (key.includes('up') || key === 'home') {
                    newPosition = await this.getNextVerticalPosition(true, ctrl || key === 'home', key === 'home');
                }
                if (key.includes('down') || key === 'end') {
                    newPosition = await this.getNextVerticalPosition(false, ctrl || key === 'end', key === 'end');
                }
                newActiveNode.row = newPosition.row;
                newActiveNode.column = newPosition.column;
                newActiveNode.layout = newPosition.layout;
            }
            else {
                if ((key.includes('left') || key === 'home') && this.activeNode.column > 0) {
                    newActiveNode.column = ctrl || key === 'home' ? 0 : this.activeNode.column - 1;
                }
                if ((key.includes('right') || key === 'end') && this.activeNode.column < this.lastRowDimensionsIndex) {
                    newActiveNode.column = ctrl || key === 'end' ? this.lastRowDimensionsIndex : this.activeNode.column + 1;
                }
                verticalContainer = this.grid.verticalRowDimScrollContainers.toArray()[newActiveNode.column];
                if (key.includes('up')) {
                    if (ctrl) {
                        newActiveNode.row = 0;
                    }
                    else if (this.activeNode.row > 0) {
                        newActiveNode.row = this.activeNode.row - 1;
                    }
                    else {
                        newActiveNode.row = -1;
                        newActiveNode.column = newActiveNode.layout ? newActiveNode.layout.colStart - 1 : 0;
                        newActiveNode.layout = null;
                        this.isRowDimensionHeaderActive = true;
                        this.isRowHeaderActive = false;
                        this.grid.theadRow.nativeElement.focus();
                    }
                }
                if (key.includes('down') && this.activeNode.row < this.findLastDataRowIndex()) {
                    newActiveNode.row = ctrl ? verticalContainer.igxForOf.length - 1 : Math.min(this.activeNode.row + 1, verticalContainer.igxForOf.length - 1);
                }
                if (key.includes('left') || key.includes('right')) {
                    const prevRIndex = this.activeNode.row;
                    const prevScrContainer = this.grid.verticalRowDimScrollContainers.toArray()[this.activeNode.column];
                    const src = prevScrContainer.getScrollForIndex(prevRIndex);
                    newActiveNode.row = this.activeNode.mchCache && this.activeNode.mchCache.level === newActiveNode.column ?
                        this.activeNode.mchCache.visibleIndex :
                        verticalContainer.getIndexAtScroll(src);
                    newActiveNode.mchCache = {
                        visibleIndex: this.activeNode.row,
                        level: this.activeNode.column
                    };
                }
            }
            this.setActiveNode(newActiveNode);
            if (!this.grid.hasHorizontalLayout && verticalContainer.isIndexOutsideView(newActiveNode.row)) {
                verticalContainer.scrollTo(newActiveNode.row);
            }
        }
        else {
            super.handleNavigation(event);
        }
    }
    handleAlt(key, event) {
        event.preventDefault();
        let rowData, dimIndex;
        if (!this.grid.hasHorizontalLayout) {
            dimIndex = this.activeNode.column;
            const scrContainer = this.grid.verticalRowDimScrollContainers.toArray()[dimIndex];
            rowData = scrContainer.igxGridForOf[this.activeNode.row];
        }
        else {
            const mrlRow = this.grid.rowDimensionMrlRowsCollection.find(mrl => mrl.rowIndex === this.activeNode.row);
            rowData = mrlRow.rowGroup[this.activeNode.layout.rowStart - 1];
            dimIndex = this.activeNode.layout.colStart - 1;
        }
        const dimension = this.grid.visibleRowDimensions[dimIndex];
        const expansionRowKey = PivotUtil.getRecordKey(rowData, dimension);
        const isExpanded = this.grid.expansionStates.get(expansionRowKey) ?? true;
        let prevCellLayout;
        if (this.grid.hasHorizontalLayout) {
            const parentRow = this.grid.rowDimensionMrlRowsCollection.find(row => row.rowIndex === this.activeNode.row);
            prevCellLayout = this.getNextVerticalColumnIndex(parentRow, Math.min(parentRow.rowGroup.length, this.activeNode.layout.rowStart), this.activeNode.layout.colStart);
        }
        if (ROW_EXPAND_KEYS.has(key) && !isExpanded) {
            this.grid.gridAPI.set_row_expansion_state(expansionRowKey, true, event);
        }
        else if (ROW_COLLAPSE_KEYS.has(key) && isExpanded) {
            this.grid.gridAPI.set_row_expansion_state(expansionRowKey, false, event);
        }
        if ((ROW_EXPAND_KEYS.has(key) && !isExpanded) || (ROW_COLLAPSE_KEYS.has(key) && isExpanded)) {
            this.onRowToggle(!isExpanded, dimension, rowData, prevCellLayout);
        }
        this.updateActiveNodeLayout();
        this.grid.notifyChanges();
    }
    updateActiveNodeLayout() {
        if (this.grid.hasHorizontalLayout) {
            const mrlRow = this.grid.rowDimensionMrlRowsCollection.find(row => row.rowIndex === this.activeNode.row);
            const activeCell = mrlRow.contentCells.toArray()[this.activeNode.column];
            this.activeNode.layout = activeCell.layout;
        }
    }
    /** Update active cell when toggling row expand when horizontal summaries have position set to top */
    onRowToggle(newExpandState, dimension, rowData, prevCellLayout) {
        if (this.grid.hasHorizontalLayout &&
            rowData.totalRecordDimensionName !== dimension.memberName &&
            dimension.horizontalSummary && this.grid.pivotUI.horizontalSummariesPosition === PivotSummaryPosition.Top) {
            const maxActiveRow = Math.min(this.lastRowDimensionMRLRowIndex, this.activeNode.row);
            const parentRowUpdated = this.grid.rowDimensionMrlRowsCollection.find(row => row.rowIndex === maxActiveRow);
            const maxRowEnd = parentRowUpdated.rowGroup.length + 1;
            const nextRowStart = Math.max(1, this.activeNode.layout.rowStart + (!newExpandState ? -1 : 1));
            const curValidRowStart = Math.min(parentRowUpdated.rowGroup.length, nextRowStart);
            // Get current cell layout, because the actineNode the rowStart might be different, based on where we come from(might be smaller cell).
            const curCellLayout = this.getNextVerticalColumnIndex(parentRowUpdated, curValidRowStart, this.activeNode.layout.colStart);
            const nextBlock = (!newExpandState && prevCellLayout.rowStart === 1) || (newExpandState && prevCellLayout.rowEnd >= maxRowEnd);
            this.activeNode.row += nextBlock ? (!newExpandState ? -1 : 1) : 0;
            this.activeNode.column = curCellLayout.columnVisibleIndex;
            this.activeNode.layout = curCellLayout;
        }
    }
    async headerNavigation(event) {
        const key = event.key.toLowerCase();
        const ctrl = event.ctrlKey;
        if (!HEADER_KEYS.has(key)) {
            return;
        }
        if (this.isRowDimensionHeaderActive) {
            event.preventDefault();
            const newActiveNode = {
                row: this.activeNode.row,
                column: this.activeNode.column,
                level: null,
                mchCache: this.activeNode.mchCache,
                layout: null
            };
            if (ctrl) {
                const dimIndex = this.activeNode.column;
                const dim = this.grid.visibleRowDimensions[dimIndex];
                if (this.activeNode.row === -1) {
                    if (key.includes('down') || key.includes('up')) {
                        let newSortDirection = SortingDirection.None;
                        if (key.includes('down')) {
                            newSortDirection = (dim.sortDirection === SortingDirection.Desc) ? SortingDirection.None : SortingDirection.Desc;
                        }
                        else if (key.includes('up')) {
                            newSortDirection = (dim.sortDirection === SortingDirection.Asc) ? SortingDirection.None : SortingDirection.Asc;
                        }
                        this.grid.sortDimension(dim, newSortDirection);
                        return;
                    }
                }
            }
            if ((key.includes('left') || key === 'home') && this.activeNode.column > 0) {
                newActiveNode.column = ctrl || key === 'home' ? 0 : this.activeNode.column - 1;
            }
            if ((key.includes('right') || key === 'end') && this.activeNode.column < this.lastRowDimensionsIndex) {
                newActiveNode.column = ctrl || key === 'end' ? this.lastRowDimensionsIndex : this.activeNode.column + 1;
            }
            else if (key.includes('right')) {
                this.isRowDimensionHeaderActive = false;
                newActiveNode.column = 0;
                newActiveNode.level = this.activeNode.mchCache?.level || 0;
                newActiveNode.mchCache = this.activeNode.mchCache || {
                    level: 0,
                    visibleIndex: 0
                };
            }
            if (key.includes('down')) {
                if (this.grid.hasHorizontalLayout) {
                    this.activeNode.row = 0;
                    this.activeNode.layout = {
                        rowStart: 1,
                        rowEnd: 2,
                        colStart: newActiveNode.column + 1,
                        colEnd: newActiveNode.column + 2,
                        columnVisibleIndex: newActiveNode.column
                    };
                    const newPosition = await this.getNextVerticalPosition(true, ctrl || key === 'home', key === 'home');
                    newActiveNode.row = 0;
                    newActiveNode.column = newPosition.column;
                    newActiveNode.layout = newPosition.layout;
                }
                else {
                    const verticalContainer = this.grid.verticalRowDimScrollContainers.toArray()[newActiveNode.column];
                    newActiveNode.row = ctrl ? verticalContainer.igxForOf.length - 1 : 0;
                }
                this.isRowDimensionHeaderActive = false;
                this.isRowHeaderActive = true;
                this.grid.rowDimensionContainer.toArray()[this.grid.hasHorizontalLayout ? 0 : newActiveNode.column].nativeElement.focus();
            }
            this.setActiveNode(newActiveNode);
        }
        else if (key.includes('left') && this.activeNode.column === 0 && this.grid.pivotUI.showRowHeaders) {
            this.isRowDimensionHeaderActive = true;
            const newActiveNode = {
                row: this.activeNode.row,
                column: this.lastRowDimensionsIndex,
                level: null,
                mchCache: this.activeNode.mchCache,
                layout: null
            };
            this.setActiveNode(newActiveNode);
        }
        else {
            super.headerNavigation(event);
        }
    }
    focusTbody(event) {
        if (!this.activeNode || this.activeNode.row === null || this.activeNode.row === undefined) {
            this.activeNode = this.lastActiveNode;
        }
        else {
            super.focusTbody(event);
        }
    }
    async getNextVerticalPosition(previous, ctrl, homeEnd) {
        const parentRow = this.grid.rowDimensionMrlRowsCollection.find(row => row.rowIndex === this.activeNode.row);
        const maxRowEnd = parentRow.rowGroup.length + 1;
        const curValidRowStart = Math.min(parentRow.rowGroup.length, this.activeNode.layout.rowStart);
        // Get current cell layout, because the actineNode the rowStart might be different, based on where we come from(might be smaller cell).
        const curCellLayout = this.getNextVerticalColumnIndex(parentRow, curValidRowStart, this.activeNode.layout.colStart);
        const nextBlock = (previous && curCellLayout.rowStart === 1) || (!previous && curCellLayout.rowEnd === maxRowEnd);
        if (nextBlock &&
            ((previous && this.activeNode.row === 0) ||
                (!previous && this.activeNode.row === this.lastRowDimensionMRLRowIndex))) {
            if (previous && this.grid.pivotUI.showRowHeaders) {
                this.isRowDimensionHeaderActive = true;
                this.isRowHeaderActive = false;
                this.grid.theadRow.nativeElement.focus();
                return { row: -1, column: this.activeNode.layout.colStart - 1, layout: this.activeNode.layout };
            }
            return { row: this.activeNode.row, column: this.activeNode.column, layout: this.activeNode.layout };
        }
        const nextMRLRowIndex = previous ?
            (ctrl ? 0 : this.activeNode.row - 1) :
            (ctrl ? this.lastRowDimensionMRLRowIndex : this.activeNode.row + 1);
        let nextRow = nextBlock || ctrl ? this.grid.rowDimensionMrlRowsCollection.find(row => row.rowIndex === nextMRLRowIndex) : parentRow;
        if (!nextRow) {
            const nextDataViewIndex = previous ?
                (ctrl ? 0 : parentRow.rowGroup[curCellLayout.rowStart - 1].dataIndex - 1) :
                (ctrl ? this.grid.dataView.length - 1 : parentRow.rowGroup[curCellLayout.rowEnd - 2].dataIndex + 1);
            await this.scrollToNextHorizontalDimRow(nextDataViewIndex);
            nextRow = nextBlock || ctrl ? this.grid.rowDimensionMrlRowsCollection.find(row => row.rowIndex === nextMRLRowIndex) : parentRow;
        }
        const nextRowStart = nextBlock ?
            (previous ? nextRow.rowGroup.length : 1) :
            (previous ? curCellLayout.rowStart - 1 : curCellLayout.rowEnd);
        const maxColEnd = Math.max(...nextRow.contentCells.map(cell => cell.layout.colEnd));
        const nextColumnLayout = this.getNextVerticalColumnIndex(nextRow, ctrl ? (previous ? 1 : nextRow.rowGroup.length) : nextRowStart, homeEnd ? (previous ? 1 : maxColEnd - 1) : this.activeNode.layout.colStart);
        const nextDataViewIndex = previous ?
            nextRow.rowGroup[nextColumnLayout.rowStart - 1].dataIndex :
            nextRow.rowGroup[nextColumnLayout.rowEnd - 2].dataIndex;
        await this.scrollToNextHorizontalDimRow(nextDataViewIndex);
        return {
            row: nextBlock || ctrl ? nextMRLRowIndex : this.activeNode.row,
            column: nextColumnLayout.columnVisibleIndex,
            layout: {
                rowStart: nextColumnLayout.rowStart,
                rowEnd: nextColumnLayout.rowEnd,
                colStart: homeEnd ? nextColumnLayout.colStart : this.activeNode.layout.colStart,
                colEnd: nextColumnLayout.colEnd,
                columnVisibleIndex: nextColumnLayout.columnVisibleIndex
            }
        };
    }
    async getNextHorizontalPosition(previous, ctrl) {
        const parentRow = this.grid.rowDimensionMrlRowsCollection.find(row => row.rowIndex === this.activeNode.row);
        const maxColEnd = Math.max(...parentRow.contentCells.map(cell => cell.layout.colEnd));
        // Get current cell layout, because the actineNode the rowStart might be different, based on where we come from(might be smaller cell).
        const curCellLayout = this.getNextVerticalColumnIndex(parentRow, this.activeNode.layout.rowStart, this.activeNode.layout.colStart);
        if ((previous && curCellLayout.colStart === 1) || (!previous && curCellLayout.colEnd === maxColEnd)) {
            return { row: this.activeNode.row, column: this.activeNode.column, layout: this.activeNode.layout };
        }
        const nextColStartNormal = curCellLayout.colStart + (previous ? -1 : curCellLayout.colEnd - curCellLayout.colStart);
        const nextColumnLayout = this.getNextVerticalColumnIndex(parentRow, this.activeNode.layout.rowStart, ctrl ? (previous ? 1 : maxColEnd - 1) : nextColStartNormal);
        const nextDataViewIndex = parentRow.rowGroup[nextColumnLayout.rowStart - 1].dataIndex;
        await this.scrollToNextHorizontalDimRow(nextDataViewIndex);
        return {
            row: this.activeNode.row,
            column: nextColumnLayout.columnVisibleIndex,
            layout: {
                rowStart: this.activeNode.layout.rowStart,
                rowEnd: nextColumnLayout.rowEnd,
                colStart: nextColumnLayout.colStart,
                colEnd: nextColumnLayout.colEnd,
                columnVisibleIndex: nextColumnLayout.columnVisibleIndex
            }
        };
    }
    async scrollToNextHorizontalDimRow(nextDataViewIndex) {
        const verticalContainer = this.grid.verticalScrollContainer;
        if (verticalContainer.isIndexOutsideView(nextDataViewIndex)) {
            verticalContainer.scrollTo(nextDataViewIndex);
            await new Promise((resolve) => {
                this.grid.gridScroll.pipe(take(1), timeout({ first: 10000 })).subscribe({
                    next: (value) => resolve(value),
                    error: (err) => resolve(err)
                });
            });
        }
    }
    getNextVerticalColumnIndex(nextRow, newRowStart, newColStart) {
        const nextCell = nextRow.contentCells.find(cell => {
            return cell.layout.rowStart <= newRowStart && newRowStart < cell.layout.rowEnd &&
                cell.layout.colStart <= newColStart && newColStart < cell.layout.colEnd;
        });
        return nextCell.layout;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.4", ngImport: i0, type: IgxPivotGridNavigationService, deps: null, target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.2.4", ngImport: i0, type: IgxPivotGridNavigationService }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.4", ngImport: i0, type: IgxPivotGridNavigationService, decorators: [{
            type: Injectable
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGl2b3QtZ3JpZC1uYXZpZ2F0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZ25pdGV1aS1hbmd1bGFyL3NyYy9saWIvZ3JpZHMvcGl2b3QtZ3JpZC9waXZvdC1ncmlkLW5hdmlnYXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWUsd0JBQXdCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUNuRixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsaUJBQWlCLEVBQUUsZUFBZSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbkYsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUd6QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUMxRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQy9DLE9BQU8sRUFBcUMsb0JBQW9CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7QUFHakcsTUFBTSxPQUFPLDZCQUE4QixTQUFRLHdCQUF3QjtJQUQzRTs7UUFHVyxzQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFDMUIsK0JBQTBCLEdBQUcsS0FBSyxDQUFDO0tBd1k3QztJQXRZRyxJQUFXLHNCQUFzQjtRQUM3QixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsSUFBVywyQkFBMkI7UUFDbEMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLDhCQUE4QixDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBRU0saUJBQWlCO1FBQ3BCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxLQUFLLENB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QztRQUNoRixDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQztJQUMzQixDQUFDOzhHQTFZUSw2QkFBNkI7a0hBQTdCLDZCQUE2Qjs7MkZBQTdCLDZCQUE2QjtrQkFEekMsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElBY3RpdmVOb2RlLCBJZ3hHcmlkTmF2aWdhdGlvblNlcnZpY2UgfSBmcm9tICcuLi9ncmlkLW5hdmlnYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJZ3hQaXZvdEdyaWRDb21wb25lbnQgfSBmcm9tICcuL3Bpdm90LWdyaWQuY29tcG9uZW50JztcbmltcG9ydCB7IEhFQURFUl9LRVlTLCBST1dfQ09MTEFQU0VfS0VZUywgUk9XX0VYUEFORF9LRVlTIH0gZnJvbSAnLi4vLi4vY29yZS91dGlscyc7XG5pbXBvcnQgeyBQaXZvdFV0aWwgfSBmcm9tICcuL3Bpdm90LXV0aWwnO1xuaW1wb3J0IHsgSWd4UGl2b3RSb3dEaW1lbnNpb25NcmxSb3dDb21wb25lbnQgfSBmcm9tICcuL3Bpdm90LXJvdy1kaW1lbnNpb24tbXJsLXJvdy5jb21wb25lbnQnO1xuaW1wb3J0IHsgSU11bHRpUm93TGF5b3V0Tm9kZSB9IGZyb20gJy4uL3B1YmxpY19hcGknO1xuaW1wb3J0IHsgU29ydGluZ0RpcmVjdGlvbiB9IGZyb20gJy4uLy4uL2RhdGEtb3BlcmF0aW9ucy9zb3J0aW5nLXN0cmF0ZWd5JztcbmltcG9ydCB7IHRha2UsIHRpbWVvdXQgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBJUGl2b3REaW1lbnNpb24sIElQaXZvdEdyaWRSZWNvcmQsIFBpdm90U3VtbWFyeVBvc2l0aW9uIH0gZnJvbSAnLi9waXZvdC1ncmlkLmludGVyZmFjZSc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBJZ3hQaXZvdEdyaWROYXZpZ2F0aW9uU2VydmljZSBleHRlbmRzIElneEdyaWROYXZpZ2F0aW9uU2VydmljZSB7XG4gICAgcHVibGljIG92ZXJyaWRlIGdyaWQ6IElneFBpdm90R3JpZENvbXBvbmVudDtcbiAgICBwdWJsaWMgaXNSb3dIZWFkZXJBY3RpdmUgPSBmYWxzZTtcbiAgICBwdWJsaWMgaXNSb3dEaW1lbnNpb25IZWFkZXJBY3RpdmUgPSBmYWxzZTtcblxuICAgIHB1YmxpYyBnZXQgbGFzdFJvd0RpbWVuc2lvbnNJbmRleCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZC52aXNpYmxlUm93RGltZW5zaW9ucy5sZW5ndGggLSAxO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgbGFzdFJvd0RpbWVuc2lvbk1STFJvd0luZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkLnZlcnRpY2FsUm93RGltU2Nyb2xsQ29udGFpbmVycy5maXJzdC5pZ3hHcmlkRm9yT2YubGVuZ3RoIC0gMTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZm9jdXNPdXRSb3dIZWFkZXIoKSB7XG4gICAgICAgIHRoaXMuaXNSb3dIZWFkZXJBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc1Jvd0RpbWVuc2lvbkhlYWRlckFjdGl2ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBvdmVycmlkZSBhc3luYyBoYW5kbGVOYXZpZ2F0aW9uKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmlzUm93SGVhZGVyQWN0aXZlKSB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBldmVudC5rZXkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGN0cmwgPSBldmVudC5jdHJsS2V5O1xuICAgICAgICAgICAgaWYgKCFIRUFERVJfS0VZUy5oYXMoa2V5KSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGNvbnN0IG5ld0FjdGl2ZU5vZGU6IElBY3RpdmVOb2RlID0ge1xuICAgICAgICAgICAgICAgIHJvdzogdGhpcy5hY3RpdmVOb2RlLnJvdyxcbiAgICAgICAgICAgICAgICBjb2x1bW46IHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4sXG4gICAgICAgICAgICAgICAgbGV2ZWw6IG51bGwsXG4gICAgICAgICAgICAgICAgbWNoQ2FjaGU6IG51bGwsXG4gICAgICAgICAgICAgICAgbGF5b3V0OiB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChldmVudC5hbHRLZXkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUFsdChrZXksIGV2ZW50KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCB2ZXJ0aWNhbENvbnRhaW5lcjtcbiAgICAgICAgICAgIGlmICh0aGlzLmdyaWQuaGFzSG9yaXpvbnRhbExheW91dCkge1xuICAgICAgICAgICAgICAgIGxldCBuZXdQb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgcm93OiB0aGlzLmFjdGl2ZU5vZGUucm93LFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW46IHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4sXG4gICAgICAgICAgICAgICAgICAgIGxheW91dDogdGhpcy5hY3RpdmVOb2RlLmxheW91dFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmVydGljYWxDb250YWluZXIgPSB0aGlzLmdyaWQudmVydGljYWxSb3dEaW1TY3JvbGxDb250YWluZXJzLmZpcnN0O1xuICAgICAgICAgICAgICAgIGlmIChrZXkuaW5jbHVkZXMoJ2xlZnQnKSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdQb3NpdGlvbiA9IGF3YWl0IHRoaXMuZ2V0TmV4dEhvcml6b250YWxQb3NpdGlvbih0cnVlLCBjdHJsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGtleS5pbmNsdWRlcygncmlnaHQnKSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdQb3NpdGlvbiA9IGF3YWl0IHRoaXMuZ2V0TmV4dEhvcml6b250YWxQb3NpdGlvbihmYWxzZSwgY3RybCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChrZXkuaW5jbHVkZXMoJ3VwJykgfHwga2V5ID09PSAnaG9tZScpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3UG9zaXRpb24gPSBhd2FpdCB0aGlzLmdldE5leHRWZXJ0aWNhbFBvc2l0aW9uKHRydWUsIGN0cmwgfHwga2V5ID09PSAnaG9tZScsIGtleSA9PT0gJ2hvbWUnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoa2V5LmluY2x1ZGVzKCdkb3duJykgfHwga2V5ID09PSAnZW5kJykge1xuICAgICAgICAgICAgICAgICAgICBuZXdQb3NpdGlvbiA9IGF3YWl0IHRoaXMuZ2V0TmV4dFZlcnRpY2FsUG9zaXRpb24oZmFsc2UsIGN0cmwgfHwga2V5ID09PSAnZW5kJywga2V5ID09PSAnZW5kJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbmV3QWN0aXZlTm9kZS5yb3cgPSBuZXdQb3NpdGlvbi5yb3c7XG4gICAgICAgICAgICAgICAgbmV3QWN0aXZlTm9kZS5jb2x1bW4gPSBuZXdQb3NpdGlvbi5jb2x1bW47XG4gICAgICAgICAgICAgICAgbmV3QWN0aXZlTm9kZS5sYXlvdXQgPSBuZXdQb3NpdGlvbi5sYXlvdXQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICgoa2V5LmluY2x1ZGVzKCdsZWZ0JykgfHwga2V5ID09PSAnaG9tZScpICYmIHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2ZU5vZGUuY29sdW1uID0gY3RybCB8fCBrZXkgPT09ICdob21lJyA/IDAgOiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uIC0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChrZXkuaW5jbHVkZXMoJ3JpZ2h0JykgfHwga2V5ID09PSAnZW5kJykgJiYgdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiA8IHRoaXMubGFzdFJvd0RpbWVuc2lvbnNJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICBuZXdBY3RpdmVOb2RlLmNvbHVtbiA9IGN0cmwgfHwga2V5ID09PSAnZW5kJyA/IHRoaXMubGFzdFJvd0RpbWVuc2lvbnNJbmRleCA6IHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4gKyAxO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZlcnRpY2FsQ29udGFpbmVyID0gdGhpcy5ncmlkLnZlcnRpY2FsUm93RGltU2Nyb2xsQ29udGFpbmVycy50b0FycmF5KClbbmV3QWN0aXZlTm9kZS5jb2x1bW5dO1xuICAgICAgICAgICAgICAgIGlmIChrZXkuaW5jbHVkZXMoJ3VwJykpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN0cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2ZU5vZGUucm93ID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFjdGl2ZU5vZGUucm93ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZlTm9kZS5yb3cgPSB0aGlzLmFjdGl2ZU5vZGUucm93IC0gMTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2ZU5vZGUucm93ID0gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdBY3RpdmVOb2RlLmNvbHVtbiA9IG5ld0FjdGl2ZU5vZGUubGF5b3V0ID8gbmV3QWN0aXZlTm9kZS5sYXlvdXQuY29sU3RhcnQgLSAxIDogMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2ZU5vZGUubGF5b3V0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNSb3dEaW1lbnNpb25IZWFkZXJBY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc1Jvd0hlYWRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkLnRoZWFkUm93Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChrZXkuaW5jbHVkZXMoJ2Rvd24nKSAmJiB0aGlzLmFjdGl2ZU5vZGUucm93IDwgdGhpcy5maW5kTGFzdERhdGFSb3dJbmRleCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2ZU5vZGUucm93ID0gY3RybCA/IHZlcnRpY2FsQ29udGFpbmVyLmlneEZvck9mLmxlbmd0aCAtIDEgOiBNYXRoLm1pbih0aGlzLmFjdGl2ZU5vZGUucm93ICsgMSwgdmVydGljYWxDb250YWluZXIuaWd4Rm9yT2YubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGtleS5pbmNsdWRlcygnbGVmdCcpIHx8IGtleS5pbmNsdWRlcygncmlnaHQnKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmV2UkluZGV4ID0gdGhpcy5hY3RpdmVOb2RlLnJvdztcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldlNjckNvbnRhaW5lciA9IHRoaXMuZ3JpZC52ZXJ0aWNhbFJvd0RpbVNjcm9sbENvbnRhaW5lcnMudG9BcnJheSgpW3RoaXMuYWN0aXZlTm9kZS5jb2x1bW5dO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzcmMgPSBwcmV2U2NyQ29udGFpbmVyLmdldFNjcm9sbEZvckluZGV4KHByZXZSSW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICBuZXdBY3RpdmVOb2RlLnJvdyA9IHRoaXMuYWN0aXZlTm9kZS5tY2hDYWNoZSAmJiB0aGlzLmFjdGl2ZU5vZGUubWNoQ2FjaGUubGV2ZWwgPT09IG5ld0FjdGl2ZU5vZGUuY29sdW1uID9cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlTm9kZS5tY2hDYWNoZS52aXNpYmxlSW5kZXggOlxuICAgICAgICAgICAgICAgICAgICAgICAgdmVydGljYWxDb250YWluZXIuZ2V0SW5kZXhBdFNjcm9sbChzcmMpO1xuICAgICAgICAgICAgICAgICAgICBuZXdBY3RpdmVOb2RlLm1jaENhY2hlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZUluZGV4OiB0aGlzLmFjdGl2ZU5vZGUucm93LFxuICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IHRoaXMuYWN0aXZlTm9kZS5jb2x1bW5cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlTm9kZShuZXdBY3RpdmVOb2RlKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5ncmlkLmhhc0hvcml6b250YWxMYXlvdXQgJiYgdmVydGljYWxDb250YWluZXIuaXNJbmRleE91dHNpZGVWaWV3KG5ld0FjdGl2ZU5vZGUucm93KSkge1xuICAgICAgICAgICAgICAgIHZlcnRpY2FsQ29udGFpbmVyLnNjcm9sbFRvKG5ld0FjdGl2ZU5vZGUucm93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN1cGVyLmhhbmRsZU5hdmlnYXRpb24oZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG92ZXJyaWRlIGhhbmRsZUFsdChrZXk6IHN0cmluZywgZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBsZXQgcm93RGF0YSwgZGltSW5kZXg7XG4gICAgICAgIGlmICghdGhpcy5ncmlkLmhhc0hvcml6b250YWxMYXlvdXQpIHtcbiAgICAgICAgICAgIGRpbUluZGV4ID0gdGhpcy5hY3RpdmVOb2RlLmNvbHVtbjtcbiAgICAgICAgICAgIGNvbnN0IHNjckNvbnRhaW5lciA9IHRoaXMuZ3JpZC52ZXJ0aWNhbFJvd0RpbVNjcm9sbENvbnRhaW5lcnMudG9BcnJheSgpW2RpbUluZGV4XTtcbiAgICAgICAgICAgIHJvd0RhdGEgPSBzY3JDb250YWluZXIuaWd4R3JpZEZvck9mW3RoaXMuYWN0aXZlTm9kZS5yb3ddO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbXJsUm93ID0gdGhpcy5ncmlkLnJvd0RpbWVuc2lvbk1ybFJvd3NDb2xsZWN0aW9uLmZpbmQobXJsID0+IG1ybC5yb3dJbmRleCA9PT0gdGhpcy5hY3RpdmVOb2RlLnJvdyk7XG4gICAgICAgICAgICByb3dEYXRhID0gbXJsUm93LnJvd0dyb3VwW3RoaXMuYWN0aXZlTm9kZS5sYXlvdXQucm93U3RhcnQgLSAxXTtcbiAgICAgICAgICAgIGRpbUluZGV4ID0gdGhpcy5hY3RpdmVOb2RlLmxheW91dC5jb2xTdGFydCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGltZW5zaW9uID0gdGhpcy5ncmlkLnZpc2libGVSb3dEaW1lbnNpb25zW2RpbUluZGV4XTtcbiAgICAgICAgY29uc3QgZXhwYW5zaW9uUm93S2V5ID0gUGl2b3RVdGlsLmdldFJlY29yZEtleShyb3dEYXRhLCBkaW1lbnNpb24pO1xuICAgICAgICBjb25zdCBpc0V4cGFuZGVkID0gdGhpcy5ncmlkLmV4cGFuc2lvblN0YXRlcy5nZXQoZXhwYW5zaW9uUm93S2V5KSA/PyB0cnVlO1xuXG4gICAgICAgIGxldCBwcmV2Q2VsbExheW91dDtcbiAgICAgICAgaWYgKHRoaXMuZ3JpZC5oYXNIb3Jpem9udGFsTGF5b3V0KSB7XG4gICAgICAgICAgICBjb25zdCBwYXJlbnRSb3cgPSB0aGlzLmdyaWQucm93RGltZW5zaW9uTXJsUm93c0NvbGxlY3Rpb24uZmluZChyb3cgPT4gcm93LnJvd0luZGV4ID09PSB0aGlzLmFjdGl2ZU5vZGUucm93KTtcbiAgICAgICAgICAgIHByZXZDZWxsTGF5b3V0ID0gdGhpcy5nZXROZXh0VmVydGljYWxDb2x1bW5JbmRleChcbiAgICAgICAgICAgICAgICBwYXJlbnRSb3csXG4gICAgICAgICAgICAgICAgTWF0aC5taW4ocGFyZW50Um93LnJvd0dyb3VwLmxlbmd0aCwgdGhpcy5hY3RpdmVOb2RlLmxheW91dC5yb3dTdGFydCksXG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVOb2RlLmxheW91dC5jb2xTdGFydCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoUk9XX0VYUEFORF9LRVlTLmhhcyhrZXkpICYmICFpc0V4cGFuZGVkKSB7XG4gICAgICAgICAgICB0aGlzLmdyaWQuZ3JpZEFQSS5zZXRfcm93X2V4cGFuc2lvbl9zdGF0ZShleHBhbnNpb25Sb3dLZXksIHRydWUsIGV2ZW50KVxuICAgICAgICB9IGVsc2UgaWYgKFJPV19DT0xMQVBTRV9LRVlTLmhhcyhrZXkpICYmIGlzRXhwYW5kZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JpZC5ncmlkQVBJLnNldF9yb3dfZXhwYW5zaW9uX3N0YXRlKGV4cGFuc2lvblJvd0tleSwgZmFsc2UsIGV2ZW50KVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKChST1dfRVhQQU5EX0tFWVMuaGFzKGtleSkgJiYgIWlzRXhwYW5kZWQpIHx8IChST1dfQ09MTEFQU0VfS0VZUy5oYXMoa2V5KSAmJiBpc0V4cGFuZGVkKSkge1xuICAgICAgICAgICAgdGhpcy5vblJvd1RvZ2dsZSghaXNFeHBhbmRlZCwgZGltZW5zaW9uLCByb3dEYXRhLCBwcmV2Q2VsbExheW91dCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVBY3RpdmVOb2RlTGF5b3V0KCk7XG4gICAgICAgIHRoaXMuZ3JpZC5ub3RpZnlDaGFuZ2VzKCk7XG4gICAgfVxuXG4gICAgcHVibGljIHVwZGF0ZUFjdGl2ZU5vZGVMYXlvdXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmdyaWQuaGFzSG9yaXpvbnRhbExheW91dCkge1xuICAgICAgICAgICAgY29uc3QgbXJsUm93ID0gdGhpcy5ncmlkLnJvd0RpbWVuc2lvbk1ybFJvd3NDb2xsZWN0aW9uLmZpbmQocm93ID0+IHJvdy5yb3dJbmRleCA9PT0gdGhpcy5hY3RpdmVOb2RlLnJvdyk7XG4gICAgICAgICAgICBjb25zdCBhY3RpdmVDZWxsID0gbXJsUm93LmNvbnRlbnRDZWxscy50b0FycmF5KClbdGhpcy5hY3RpdmVOb2RlLmNvbHVtbl07XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0ID0gYWN0aXZlQ2VsbC5sYXlvdXQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogVXBkYXRlIGFjdGl2ZSBjZWxsIHdoZW4gdG9nZ2xpbmcgcm93IGV4cGFuZCB3aGVuIGhvcml6b250YWwgc3VtbWFyaWVzIGhhdmUgcG9zaXRpb24gc2V0IHRvIHRvcCAqL1xuICAgIHB1YmxpYyBvblJvd1RvZ2dsZShuZXdFeHBhbmRTdGF0ZTogYm9vbGVhbiwgZGltZW5zaW9uOiBJUGl2b3REaW1lbnNpb24sIHJvd0RhdGE6IElQaXZvdEdyaWRSZWNvcmQsIHByZXZDZWxsTGF5b3V0OiBJTXVsdGlSb3dMYXlvdXROb2RlKXtcbiAgICAgICAgaWYgKHRoaXMuZ3JpZC5oYXNIb3Jpem9udGFsTGF5b3V0ICYmXG4gICAgICAgICAgICByb3dEYXRhLnRvdGFsUmVjb3JkRGltZW5zaW9uTmFtZSAhPT0gZGltZW5zaW9uLm1lbWJlck5hbWUgJiZcbiAgICAgICAgICAgIGRpbWVuc2lvbi5ob3Jpem9udGFsU3VtbWFyeSAmJiB0aGlzLmdyaWQucGl2b3RVSS5ob3Jpem9udGFsU3VtbWFyaWVzUG9zaXRpb24gPT09IFBpdm90U3VtbWFyeVBvc2l0aW9uLlRvcCkge1xuICAgICAgICAgICAgY29uc3QgbWF4QWN0aXZlUm93ID0gTWF0aC5taW4odGhpcy5sYXN0Um93RGltZW5zaW9uTVJMUm93SW5kZXgsIHRoaXMuYWN0aXZlTm9kZS5yb3cpO1xuICAgICAgICAgICAgY29uc3QgcGFyZW50Um93VXBkYXRlZCA9IHRoaXMuZ3JpZC5yb3dEaW1lbnNpb25NcmxSb3dzQ29sbGVjdGlvbi5maW5kKHJvdyA9PiByb3cucm93SW5kZXggPT09IG1heEFjdGl2ZVJvdyk7XG4gICAgICAgICAgICBjb25zdCBtYXhSb3dFbmQgPSBwYXJlbnRSb3dVcGRhdGVkLnJvd0dyb3VwLmxlbmd0aCArIDE7XG4gICAgICAgICAgICBjb25zdCBuZXh0Um93U3RhcnQgPSBNYXRoLm1heCgxLCB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LnJvd1N0YXJ0ICsgKCFuZXdFeHBhbmRTdGF0ZSA/IC0xIDogMSkpO1xuICAgICAgICAgICAgY29uc3QgY3VyVmFsaWRSb3dTdGFydCA9IE1hdGgubWluKHBhcmVudFJvd1VwZGF0ZWQucm93R3JvdXAubGVuZ3RoLCBuZXh0Um93U3RhcnQpO1xuICAgICAgICAgICAgLy8gR2V0IGN1cnJlbnQgY2VsbCBsYXlvdXQsIGJlY2F1c2UgdGhlIGFjdGluZU5vZGUgdGhlIHJvd1N0YXJ0IG1pZ2h0IGJlIGRpZmZlcmVudCwgYmFzZWQgb24gd2hlcmUgd2UgY29tZSBmcm9tKG1pZ2h0IGJlIHNtYWxsZXIgY2VsbCkuXG5cbiAgICAgICAgICAgIGNvbnN0IGN1ckNlbGxMYXlvdXQgPSB0aGlzLmdldE5leHRWZXJ0aWNhbENvbHVtbkluZGV4KHBhcmVudFJvd1VwZGF0ZWQsIGN1clZhbGlkUm93U3RhcnQsIHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQuY29sU3RhcnQpO1xuICAgICAgICAgICAgY29uc3QgbmV4dEJsb2NrID0gKCFuZXdFeHBhbmRTdGF0ZSAmJiBwcmV2Q2VsbExheW91dC5yb3dTdGFydCA9PT0gMSkgfHwgKG5ld0V4cGFuZFN0YXRlICYmICBwcmV2Q2VsbExheW91dC5yb3dFbmQgPj0gbWF4Um93RW5kKTtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlTm9kZS5yb3cgKz0gbmV4dEJsb2NrID8gKCFuZXdFeHBhbmRTdGF0ZSA/IC0xIDogMSkgOiAwO1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiA9IGN1ckNlbGxMYXlvdXQuY29sdW1uVmlzaWJsZUluZGV4O1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVOb2RlLmxheW91dCA9IGN1ckNlbGxMYXlvdXQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgb3ZlcnJpZGUgYXN5bmMgaGVhZGVyTmF2aWdhdGlvbihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgICAgICBjb25zdCBrZXkgPSBldmVudC5rZXkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgY3RybCA9IGV2ZW50LmN0cmxLZXk7XG4gICAgICAgIGlmICghSEVBREVSX0tFWVMuaGFzKGtleSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzUm93RGltZW5zaW9uSGVhZGVyQWN0aXZlKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBjb25zdCBuZXdBY3RpdmVOb2RlOiBJQWN0aXZlTm9kZSA9IHtcbiAgICAgICAgICAgICAgICByb3c6IHRoaXMuYWN0aXZlTm9kZS5yb3csXG4gICAgICAgICAgICAgICAgY29sdW1uOiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uLFxuICAgICAgICAgICAgICAgIGxldmVsOiBudWxsLFxuICAgICAgICAgICAgICAgIG1jaENhY2hlOiB0aGlzLmFjdGl2ZU5vZGUubWNoQ2FjaGUsXG4gICAgICAgICAgICAgICAgbGF5b3V0OiBudWxsXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChjdHJsKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGltSW5kZXggPSB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRpbSA9IHRoaXMuZ3JpZC52aXNpYmxlUm93RGltZW5zaW9uc1tkaW1JbmRleF07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlTm9kZS5yb3cgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkuaW5jbHVkZXMoJ2Rvd24nKSB8fCBrZXkuaW5jbHVkZXMoJ3VwJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuZXdTb3J0RGlyZWN0aW9uID0gU29ydGluZ0RpcmVjdGlvbi5Ob25lO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleS5pbmNsdWRlcygnZG93bicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U29ydERpcmVjdGlvbiA9IChkaW0uc29ydERpcmVjdGlvbiA9PT0gU29ydGluZ0RpcmVjdGlvbi5EZXNjKSA/IFNvcnRpbmdEaXJlY3Rpb24uTm9uZSA6IFNvcnRpbmdEaXJlY3Rpb24uRGVzYztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5LmluY2x1ZGVzKCd1cCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U29ydERpcmVjdGlvbiA9IChkaW0uc29ydERpcmVjdGlvbiA9PT0gU29ydGluZ0RpcmVjdGlvbi5Bc2MpID8gU29ydGluZ0RpcmVjdGlvbi5Ob25lIDogU29ydGluZ0RpcmVjdGlvbi5Bc2M7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWQuc29ydERpbWVuc2lvbihkaW0sIG5ld1NvcnREaXJlY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKChrZXkuaW5jbHVkZXMoJ2xlZnQnKSB8fCBrZXkgPT09ICdob21lJykgJiYgdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiA+IDApIHtcbiAgICAgICAgICAgICAgICBuZXdBY3RpdmVOb2RlLmNvbHVtbiA9IGN0cmwgfHwga2V5ID09PSAnaG9tZScgPyAwIDogdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiAtIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKGtleS5pbmNsdWRlcygncmlnaHQnKSB8fCBrZXkgPT09ICdlbmQnKSAmJiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uIDwgdGhpcy5sYXN0Um93RGltZW5zaW9uc0luZGV4KSB7XG4gICAgICAgICAgICAgICAgbmV3QWN0aXZlTm9kZS5jb2x1bW4gPSBjdHJsIHx8IGtleSA9PT0gJ2VuZCcgPyB0aGlzLmxhc3RSb3dEaW1lbnNpb25zSW5kZXggOiB0aGlzLmFjdGl2ZU5vZGUuY29sdW1uICsgMTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5LmluY2x1ZGVzKCdyaWdodCcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1Jvd0RpbWVuc2lvbkhlYWRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIG5ld0FjdGl2ZU5vZGUuY29sdW1uID0gMDtcbiAgICAgICAgICAgICAgICBuZXdBY3RpdmVOb2RlLmxldmVsID0gdGhpcy5hY3RpdmVOb2RlLm1jaENhY2hlPy5sZXZlbCB8fCAwO1xuICAgICAgICAgICAgICAgIG5ld0FjdGl2ZU5vZGUubWNoQ2FjaGUgPSB0aGlzLmFjdGl2ZU5vZGUubWNoQ2FjaGUgfHwge1xuICAgICAgICAgICAgICAgICAgICBsZXZlbDogMCxcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZUluZGV4OiAwXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGtleS5pbmNsdWRlcygnZG93bicpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZC5oYXNIb3Jpem9udGFsTGF5b3V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlTm9kZS5yb3cgPSAwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcm93U3RhcnQ6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICByb3dFbmQ6IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xTdGFydDogbmV3QWN0aXZlTm9kZS5jb2x1bW4gKyAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sRW5kOiBuZXdBY3RpdmVOb2RlLmNvbHVtbiArIDIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5WaXNpYmxlSW5kZXg6IG5ld0FjdGl2ZU5vZGUuY29sdW1uXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3UG9zaXRpb24gPSBhd2FpdCB0aGlzLmdldE5leHRWZXJ0aWNhbFBvc2l0aW9uKHRydWUsIGN0cmwgfHwga2V5ID09PSAnaG9tZScsIGtleSA9PT0gJ2hvbWUnKTtcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZlTm9kZS5yb3cgPSAwO1xuICAgICAgICAgICAgICAgICAgICBuZXdBY3RpdmVOb2RlLmNvbHVtbiA9IG5ld1Bvc2l0aW9uLmNvbHVtbjtcbiAgICAgICAgICAgICAgICAgICAgbmV3QWN0aXZlTm9kZS5sYXlvdXQgPSBuZXdQb3NpdGlvbi5sYXlvdXQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmVydGljYWxDb250YWluZXIgPSB0aGlzLmdyaWQudmVydGljYWxSb3dEaW1TY3JvbGxDb250YWluZXJzLnRvQXJyYXkoKVtuZXdBY3RpdmVOb2RlLmNvbHVtbl07XG4gICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2ZU5vZGUucm93ID0gY3RybCA/IHZlcnRpY2FsQ29udGFpbmVyLmlneEZvck9mLmxlbmd0aCAtIDEgOiAwO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuaXNSb3dEaW1lbnNpb25IZWFkZXJBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzUm93SGVhZGVyQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyaWQucm93RGltZW5zaW9uQ29udGFpbmVyLnRvQXJyYXkoKVt0aGlzLmdyaWQuaGFzSG9yaXpvbnRhbExheW91dCA/IDAgOiBuZXdBY3RpdmVOb2RlLmNvbHVtbl0ubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZU5vZGUobmV3QWN0aXZlTm9kZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoa2V5LmluY2x1ZGVzKCdsZWZ0JykgJiYgdGhpcy5hY3RpdmVOb2RlLmNvbHVtbiA9PT0gMCAmJiB0aGlzLmdyaWQucGl2b3RVSS5zaG93Um93SGVhZGVycykge1xuICAgICAgICAgICAgdGhpcy5pc1Jvd0RpbWVuc2lvbkhlYWRlckFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICBjb25zdCBuZXdBY3RpdmVOb2RlOiBJQWN0aXZlTm9kZSA9IHtcbiAgICAgICAgICAgICAgICByb3c6IHRoaXMuYWN0aXZlTm9kZS5yb3csXG4gICAgICAgICAgICAgICAgY29sdW1uOiB0aGlzLmxhc3RSb3dEaW1lbnNpb25zSW5kZXgsXG4gICAgICAgICAgICAgICAgbGV2ZWw6IG51bGwsXG4gICAgICAgICAgICAgICAgbWNoQ2FjaGU6IHRoaXMuYWN0aXZlTm9kZS5tY2hDYWNoZSxcbiAgICAgICAgICAgICAgICBsYXlvdXQ6IG51bGxcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVOb2RlKG5ld0FjdGl2ZU5vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3VwZXIuaGVhZGVyTmF2aWdhdGlvbihldmVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgb3ZlcnJpZGUgZm9jdXNUYm9keShldmVudCkge1xuICAgICAgICBpZiAoIXRoaXMuYWN0aXZlTm9kZSB8fCB0aGlzLmFjdGl2ZU5vZGUucm93ID09PSBudWxsIHx8IHRoaXMuYWN0aXZlTm9kZS5yb3cgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5hY3RpdmVOb2RlID0gdGhpcy5sYXN0QWN0aXZlTm9kZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN1cGVyLmZvY3VzVGJvZHkoZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldE5leHRWZXJ0aWNhbFBvc2l0aW9uKHByZXZpb3VzLCBjdHJsLCBob21lRW5kKSB7XG4gICAgICAgIGNvbnN0IHBhcmVudFJvdyA9IHRoaXMuZ3JpZC5yb3dEaW1lbnNpb25NcmxSb3dzQ29sbGVjdGlvbi5maW5kKHJvdyA9PiByb3cucm93SW5kZXggPT09IHRoaXMuYWN0aXZlTm9kZS5yb3cpO1xuICAgICAgICBjb25zdCBtYXhSb3dFbmQgPSBwYXJlbnRSb3cucm93R3JvdXAubGVuZ3RoICsgMTtcbiAgICAgICAgY29uc3QgY3VyVmFsaWRSb3dTdGFydCA9IE1hdGgubWluKHBhcmVudFJvdy5yb3dHcm91cC5sZW5ndGgsIHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQucm93U3RhcnQpO1xuICAgICAgICAvLyBHZXQgY3VycmVudCBjZWxsIGxheW91dCwgYmVjYXVzZSB0aGUgYWN0aW5lTm9kZSB0aGUgcm93U3RhcnQgbWlnaHQgYmUgZGlmZmVyZW50LCBiYXNlZCBvbiB3aGVyZSB3ZSBjb21lIGZyb20obWlnaHQgYmUgc21hbGxlciBjZWxsKS5cbiAgICAgICAgY29uc3QgY3VyQ2VsbExheW91dCA9IHRoaXMuZ2V0TmV4dFZlcnRpY2FsQ29sdW1uSW5kZXgocGFyZW50Um93LCBjdXJWYWxpZFJvd1N0YXJ0LCB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LmNvbFN0YXJ0KTtcbiAgICAgICAgY29uc3QgbmV4dEJsb2NrID0gKHByZXZpb3VzICYmIGN1ckNlbGxMYXlvdXQucm93U3RhcnQgPT09IDEpIHx8ICghcHJldmlvdXMgJiYgY3VyQ2VsbExheW91dC5yb3dFbmQgPT09IG1heFJvd0VuZCk7XG4gICAgICAgIGlmIChuZXh0QmxvY2sgJiZcbiAgICAgICAgICAgICgocHJldmlvdXMgJiYgdGhpcy5hY3RpdmVOb2RlLnJvdyA9PT0gMCkgfHxcbiAgICAgICAgICAgICghcHJldmlvdXMgJiYgdGhpcy5hY3RpdmVOb2RlLnJvdyA9PT0gdGhpcy5sYXN0Um93RGltZW5zaW9uTVJMUm93SW5kZXgpKSkge1xuICAgICAgICAgICAgaWYgKHByZXZpb3VzICYmIHRoaXMuZ3JpZC5waXZvdFVJLnNob3dSb3dIZWFkZXJzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1Jvd0RpbWVuc2lvbkhlYWRlckFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5pc1Jvd0hlYWRlckFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC50aGVhZFJvdy5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuICB7IHJvdzogLTEsIGNvbHVtbjogdGhpcy5hY3RpdmVOb2RlLmxheW91dC5jb2xTdGFydCAtIDEsIGxheW91dDogdGhpcy5hY3RpdmVOb2RlLmxheW91dCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHsgcm93OiB0aGlzLmFjdGl2ZU5vZGUucm93LCBjb2x1bW46IHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4sIGxheW91dDogdGhpcy5hY3RpdmVOb2RlLmxheW91dCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmV4dE1STFJvd0luZGV4ID0gcHJldmlvdXMgP1xuICAgICAgICAgICAgKGN0cmwgPyAwIDogdGhpcy5hY3RpdmVOb2RlLnJvdyAtIDEpIDpcbiAgICAgICAgICAgIChjdHJsID8gdGhpcy5sYXN0Um93RGltZW5zaW9uTVJMUm93SW5kZXggOiB0aGlzLmFjdGl2ZU5vZGUucm93ICsgMSkgO1xuICAgICAgICBsZXQgbmV4dFJvdyA9IG5leHRCbG9jayB8fCBjdHJsID8gdGhpcy5ncmlkLnJvd0RpbWVuc2lvbk1ybFJvd3NDb2xsZWN0aW9uLmZpbmQocm93ID0+IHJvdy5yb3dJbmRleCA9PT0gbmV4dE1STFJvd0luZGV4KSA6IHBhcmVudFJvdztcbiAgICAgICAgaWYgKCFuZXh0Um93KSB7XG4gICAgICAgICAgICBjb25zdCBuZXh0RGF0YVZpZXdJbmRleCA9IHByZXZpb3VzID9cbiAgICAgICAgICAgICAgICAoY3RybCA/IDAgOiBwYXJlbnRSb3cucm93R3JvdXBbY3VyQ2VsbExheW91dC5yb3dTdGFydCAtIDFdLmRhdGFJbmRleCAtIDEpIDpcbiAgICAgICAgICAgICAgICAoY3RybCA/IHRoaXMuZ3JpZC5kYXRhVmlldy5sZW5ndGggLSAxIDogcGFyZW50Um93LnJvd0dyb3VwW2N1ckNlbGxMYXlvdXQucm93RW5kIC0gMl0uZGF0YUluZGV4ICsgMSk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNjcm9sbFRvTmV4dEhvcml6b250YWxEaW1Sb3cobmV4dERhdGFWaWV3SW5kZXgpO1xuICAgICAgICAgICAgbmV4dFJvdyA9IG5leHRCbG9jayB8fCBjdHJsID8gdGhpcy5ncmlkLnJvd0RpbWVuc2lvbk1ybFJvd3NDb2xsZWN0aW9uLmZpbmQocm93ID0+IHJvdy5yb3dJbmRleCA9PT0gbmV4dE1STFJvd0luZGV4KSA6IHBhcmVudFJvdztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5leHRSb3dTdGFydCA9IG5leHRCbG9jayA/XG4gICAgICAgICAgICAocHJldmlvdXMgPyBuZXh0Um93LnJvd0dyb3VwLmxlbmd0aCA6IDEpIDpcbiAgICAgICAgICAgIChwcmV2aW91cyA/IGN1ckNlbGxMYXlvdXQucm93U3RhcnQgLSAxIDogY3VyQ2VsbExheW91dC5yb3dFbmQpO1xuICAgICAgICBjb25zdCBtYXhDb2xFbmQgPSBNYXRoLm1heCguLi5uZXh0Um93LmNvbnRlbnRDZWxscy5tYXAoY2VsbCA9PiBjZWxsLmxheW91dC5jb2xFbmQpKTtcbiAgICAgICAgY29uc3QgbmV4dENvbHVtbkxheW91dCA9IHRoaXMuZ2V0TmV4dFZlcnRpY2FsQ29sdW1uSW5kZXgoXG4gICAgICAgICAgICBuZXh0Um93LFxuICAgICAgICAgICAgY3RybCA/IChwcmV2aW91cyA/IDEgOiBuZXh0Um93LnJvd0dyb3VwLmxlbmd0aCkgOiBuZXh0Um93U3RhcnQsXG4gICAgICAgICAgICBob21lRW5kID8gKHByZXZpb3VzID8gMSA6IG1heENvbEVuZCAtIDEpIDogdGhpcy5hY3RpdmVOb2RlLmxheW91dC5jb2xTdGFydFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG5leHREYXRhVmlld0luZGV4ID0gcHJldmlvdXMgP1xuICAgICAgICAgICAgbmV4dFJvdy5yb3dHcm91cFtuZXh0Q29sdW1uTGF5b3V0LnJvd1N0YXJ0IC0gMV0uZGF0YUluZGV4OlxuICAgICAgICAgICAgbmV4dFJvdy5yb3dHcm91cFtuZXh0Q29sdW1uTGF5b3V0LnJvd0VuZCAtIDJdLmRhdGFJbmRleDtcbiAgICAgICAgYXdhaXQgdGhpcy5zY3JvbGxUb05leHRIb3Jpem9udGFsRGltUm93KG5leHREYXRhVmlld0luZGV4KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcm93OiBuZXh0QmxvY2sgfHwgY3RybCA/IG5leHRNUkxSb3dJbmRleCA6IHRoaXMuYWN0aXZlTm9kZS5yb3csXG4gICAgICAgICAgICBjb2x1bW46IG5leHRDb2x1bW5MYXlvdXQuY29sdW1uVmlzaWJsZUluZGV4LFxuICAgICAgICAgICAgbGF5b3V0OiB7XG4gICAgICAgICAgICAgICAgcm93U3RhcnQ6IG5leHRDb2x1bW5MYXlvdXQucm93U3RhcnQsXG4gICAgICAgICAgICAgICAgcm93RW5kOiBuZXh0Q29sdW1uTGF5b3V0LnJvd0VuZCxcbiAgICAgICAgICAgICAgICBjb2xTdGFydDogaG9tZUVuZCA/IG5leHRDb2x1bW5MYXlvdXQuY29sU3RhcnQgOiB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LmNvbFN0YXJ0LFxuICAgICAgICAgICAgICAgIGNvbEVuZDogbmV4dENvbHVtbkxheW91dC5jb2xFbmQsXG4gICAgICAgICAgICAgICAgY29sdW1uVmlzaWJsZUluZGV4OiBuZXh0Q29sdW1uTGF5b3V0LmNvbHVtblZpc2libGVJbmRleFxuICAgICAgICAgICAgfSBhcyBJTXVsdGlSb3dMYXlvdXROb2RlXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGdldE5leHRIb3Jpem9udGFsUG9zaXRpb24ocHJldmlvdXMsIGN0cmwpIHtcbiAgICAgICAgY29uc3QgcGFyZW50Um93ID0gdGhpcy5ncmlkLnJvd0RpbWVuc2lvbk1ybFJvd3NDb2xsZWN0aW9uLmZpbmQocm93ID0+IHJvdy5yb3dJbmRleCA9PT0gdGhpcy5hY3RpdmVOb2RlLnJvdyk7XG4gICAgICAgIGNvbnN0IG1heENvbEVuZCA9IE1hdGgubWF4KC4uLnBhcmVudFJvdy5jb250ZW50Q2VsbHMubWFwKGNlbGwgPT4gY2VsbC5sYXlvdXQuY29sRW5kKSk7XG4gICAgICAgIC8vIEdldCBjdXJyZW50IGNlbGwgbGF5b3V0LCBiZWNhdXNlIHRoZSBhY3RpbmVOb2RlIHRoZSByb3dTdGFydCBtaWdodCBiZSBkaWZmZXJlbnQsIGJhc2VkIG9uIHdoZXJlIHdlIGNvbWUgZnJvbShtaWdodCBiZSBzbWFsbGVyIGNlbGwpLlxuICAgICAgICBjb25zdCBjdXJDZWxsTGF5b3V0ID0gdGhpcy5nZXROZXh0VmVydGljYWxDb2x1bW5JbmRleChwYXJlbnRSb3csIHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQucm93U3RhcnQsIHRoaXMuYWN0aXZlTm9kZS5sYXlvdXQuY29sU3RhcnQpO1xuXG4gICAgICAgIGlmICgocHJldmlvdXMgJiYgY3VyQ2VsbExheW91dC5jb2xTdGFydCA9PT0gMSkgfHwgKCFwcmV2aW91cyAmJiBjdXJDZWxsTGF5b3V0LmNvbEVuZCA9PT0gbWF4Q29sRW5kKSkge1xuICAgICAgICAgICAgcmV0dXJuIHsgcm93OiB0aGlzLmFjdGl2ZU5vZGUucm93LCBjb2x1bW46IHRoaXMuYWN0aXZlTm9kZS5jb2x1bW4sIGxheW91dDogdGhpcy5hY3RpdmVOb2RlLmxheW91dCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmV4dENvbFN0YXJ0Tm9ybWFsID0gY3VyQ2VsbExheW91dC5jb2xTdGFydCArIChwcmV2aW91cyA/IC0xIDogY3VyQ2VsbExheW91dC5jb2xFbmQgLSBjdXJDZWxsTGF5b3V0LmNvbFN0YXJ0KTtcbiAgICAgICAgY29uc3QgbmV4dENvbHVtbkxheW91dCA9IHRoaXMuZ2V0TmV4dFZlcnRpY2FsQ29sdW1uSW5kZXgoXG4gICAgICAgICAgICBwYXJlbnRSb3csXG4gICAgICAgICAgICB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LnJvd1N0YXJ0LFxuICAgICAgICAgICAgY3RybCA/IChwcmV2aW91cyA/IDEgOiBtYXhDb2xFbmQgLSAxKSA6IG5leHRDb2xTdGFydE5vcm1hbFxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG5leHREYXRhVmlld0luZGV4ID0gcGFyZW50Um93LnJvd0dyb3VwW25leHRDb2x1bW5MYXlvdXQucm93U3RhcnQgLSAxXS5kYXRhSW5kZXhcbiAgICAgICAgYXdhaXQgdGhpcy5zY3JvbGxUb05leHRIb3Jpem9udGFsRGltUm93KG5leHREYXRhVmlld0luZGV4KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcm93OiB0aGlzLmFjdGl2ZU5vZGUucm93LFxuICAgICAgICAgICAgY29sdW1uOiBuZXh0Q29sdW1uTGF5b3V0LmNvbHVtblZpc2libGVJbmRleCxcbiAgICAgICAgICAgIGxheW91dDoge1xuICAgICAgICAgICAgICAgIHJvd1N0YXJ0OiB0aGlzLmFjdGl2ZU5vZGUubGF5b3V0LnJvd1N0YXJ0LFxuICAgICAgICAgICAgICAgIHJvd0VuZDogbmV4dENvbHVtbkxheW91dC5yb3dFbmQsXG4gICAgICAgICAgICAgICAgY29sU3RhcnQ6IG5leHRDb2x1bW5MYXlvdXQuY29sU3RhcnQsXG4gICAgICAgICAgICAgICAgY29sRW5kOiBuZXh0Q29sdW1uTGF5b3V0LmNvbEVuZCxcbiAgICAgICAgICAgICAgICBjb2x1bW5WaXNpYmxlSW5kZXg6IG5leHRDb2x1bW5MYXlvdXQuY29sdW1uVmlzaWJsZUluZGV4XG4gICAgICAgICAgICB9IGFzIElNdWx0aVJvd0xheW91dE5vZGVcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIHNjcm9sbFRvTmV4dEhvcml6b250YWxEaW1Sb3cobmV4dERhdGFWaWV3SW5kZXg6IG51bWJlcikge1xuICAgICAgICBjb25zdCB2ZXJ0aWNhbENvbnRhaW5lciA9IHRoaXMuZ3JpZC52ZXJ0aWNhbFNjcm9sbENvbnRhaW5lcjtcbiAgICAgICAgaWYgKHZlcnRpY2FsQ29udGFpbmVyLmlzSW5kZXhPdXRzaWRlVmlldyhuZXh0RGF0YVZpZXdJbmRleCkpIHtcbiAgICAgICAgICAgIHZlcnRpY2FsQ29udGFpbmVyLnNjcm9sbFRvKG5leHREYXRhVmlld0luZGV4KTtcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkLmdyaWRTY3JvbGwucGlwZSh0YWtlKDEpLCB0aW1lb3V0KHsgZmlyc3Q6IDEwMDAwIH0pKS5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgICAgICBuZXh0OiAodmFsdWUpID0+IHJlc29sdmUodmFsdWUpLFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogKGVycikgPT4gcmVzb2x2ZShlcnIpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBnZXROZXh0VmVydGljYWxDb2x1bW5JbmRleChuZXh0Um93OiBJZ3hQaXZvdFJvd0RpbWVuc2lvbk1ybFJvd0NvbXBvbmVudCwgbmV3Um93U3RhcnQsIG5ld0NvbFN0YXJ0KSB7XG4gICAgICAgIGNvbnN0IG5leHRDZWxsID0gbmV4dFJvdy5jb250ZW50Q2VsbHMuZmluZChjZWxsID0+IHtcbiAgICAgICAgICAgIHJldHVybiBjZWxsLmxheW91dC5yb3dTdGFydCA8PSBuZXdSb3dTdGFydCAmJiBuZXdSb3dTdGFydCA8IGNlbGwubGF5b3V0LnJvd0VuZCAmJlxuICAgICAgICAgICAgICAgIGNlbGwubGF5b3V0LmNvbFN0YXJ0IDw9IG5ld0NvbFN0YXJ0ICYmIG5ld0NvbFN0YXJ0IDwgY2VsbC5sYXlvdXQuY29sRW5kO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5leHRDZWxsLmxheW91dDtcbiAgICB9XG59XG4iXX0=