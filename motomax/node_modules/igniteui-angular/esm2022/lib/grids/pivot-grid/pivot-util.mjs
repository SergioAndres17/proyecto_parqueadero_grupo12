import { DataUtil, GridColumnDataType } from '../../data-operations/data-util';
import { FilteringLogic } from '../../data-operations/filtering-expression.interface';
import { FilteringExpressionsTree } from '../../data-operations/filtering-expressions-tree';
import { IgxSorting } from '../common/strategy';
import { IgxPivotAggregate, IgxPivotDateAggregate, IgxPivotNumericAggregate, IgxPivotTimeAggregate } from './pivot-grid-aggregate';
import { PivotDimensionType, PivotSummaryPosition } from './pivot-grid.interface';
export class PivotUtil {
    // go through all children and apply new dimension groups as child
    static processGroups(recs, dimension, pivotKeys, cloneStrategy) {
        for (const rec of recs) {
            // process existing children
            if (rec.children && rec.children.size > 0) {
                // process hierarchy in dept
                rec.children.forEach((values) => {
                    this.processGroups(values, dimension, pivotKeys, cloneStrategy);
                });
            }
            // add children for current dimension
            const hierarchyFields = PivotUtil
                .getFieldsHierarchy(rec.records, [dimension], PivotDimensionType.Row, pivotKeys, cloneStrategy);
            const siblingData = PivotUtil
                .processHierarchy(hierarchyFields, pivotKeys, 0);
            rec.children.set(dimension.memberName, siblingData);
        }
    }
    static flattenGroups(data, dimension, expansionStates, defaultExpand, parent, parentRec) {
        for (let i = 0; i < data.length; i++) {
            const rec = data[i];
            const field = dimension.memberName;
            if (!field) {
                continue;
            }
            let recordsData = rec.children.get(field);
            if (!recordsData && parent) {
                // check parent
                recordsData = rec.children.get(parent.memberName);
                if (recordsData) {
                    dimension = parent;
                }
            }
            if (parentRec) {
                parentRec.dimensionValues.forEach((value, key) => {
                    if (parent.memberName !== key) {
                        rec.dimensionValues.set(key, value);
                        const dim = parentRec.dimensions.find(x => x.memberName === key);
                        rec.dimensions.unshift(dim);
                    }
                });
            }
            const expansionRowKey = PivotUtil.getRecordKey(rec, dimension);
            const isExpanded = expansionStates.get(expansionRowKey) === undefined ?
                defaultExpand :
                expansionStates.get(expansionRowKey);
            const shouldExpand = isExpanded || !dimension.childLevel || !rec.dimensionValues.get(dimension.memberName);
            if (shouldExpand && recordsData) {
                if (dimension.childLevel) {
                    this.flattenGroups(recordsData, dimension.childLevel, expansionStates, defaultExpand, dimension, rec);
                }
                else {
                    // copy parent values and dims in child
                    recordsData.forEach(x => {
                        rec.dimensionValues.forEach((value, key) => {
                            if (dimension.memberName !== key) {
                                x.dimensionValues.set(key, value);
                                const dim = rec.dimensions.find(y => y.memberName === key);
                                x.dimensions.unshift(dim);
                            }
                        });
                    });
                }
                data.splice(i + 1, 0, ...recordsData);
                i += recordsData.length;
            }
        }
    }
    static flattenGroupsHorizontally(data, dimension, expansionStates, defaultExpand, visibleDimensions, summariesPosition, parent, parentRec) {
        for (let i = 0; i < data.length; i++) {
            const rec = data[i];
            const field = dimension.memberName;
            if (!field) {
                continue;
            }
            if (!visibleDimensions.find(recDim => recDim.memberName === rec.dimensions[0].memberName)) {
                visibleDimensions.push(rec.dimensions[0]);
            }
            let recordsData = rec.children.get(field);
            if (!recordsData && parent) {
                // check parent
                recordsData = rec.children.get(parent.memberName);
                if (recordsData) {
                    dimension = parent;
                }
            }
            if (parentRec) {
                parentRec.dimensionValues.forEach((value, key) => {
                    rec.dimensionValues.set(key, value);
                    const dim = parentRec.dimensions.find(x => x.memberName === key);
                    rec.dimensions.unshift(dim);
                });
            }
            const expansionRowKey = PivotUtil.getRecordKey(rec, dimension);
            const isExpanded = expansionStates.get(expansionRowKey) === undefined ?
                defaultExpand :
                expansionStates.get(expansionRowKey);
            const shouldExpand = isExpanded || !dimension.childLevel || !rec.dimensionValues.get(dimension.memberName);
            if (shouldExpand && recordsData && !rec.totalRecordDimensionName) {
                if (dimension.childLevel) {
                    this.flattenGroupsHorizontally(recordsData, dimension.childLevel, expansionStates, defaultExpand, visibleDimensions, summariesPosition, dimension, rec);
                }
                else {
                    // copy parent values and dims in child
                    recordsData.forEach(x => {
                        rec.dimensionValues.forEach((value, key) => {
                            if (dimension.memberName !== key) {
                                x.dimensionValues.set(key, value);
                                const dim = rec.dimensions.find(y => y.memberName === key);
                                x.dimensions.unshift(dim);
                            }
                        });
                    });
                }
                recordsData.forEach((childRec) => {
                    if (childRec.dimensions.length === 1) {
                        rec.dimensionValues.forEach((value, key) => {
                            childRec.dimensionValues.set(key, value);
                        });
                    }
                    childRec.dimensions.forEach((dim) => {
                        if (!visibleDimensions.find(recDim => recDim.memberName === dim.memberName)) {
                            visibleDimensions.push(dim);
                        }
                    });
                });
                const curDimValue = rec.dimensionValues.get(dimension.memberName);
                if (dimension.horizontalSummary && curDimValue) {
                    rec.totalRecordDimensionName = dimension.memberName;
                    rec.dimensionValues.set(dimension.memberName, `${curDimValue} Total`);
                    if (summariesPosition === PivotSummaryPosition.Top) {
                        recordsData.unshift(rec);
                    }
                    else {
                        recordsData.push(rec);
                    }
                }
                data.splice(i, 1, ...recordsData);
                i += recordsData.length - 1;
            }
        }
    }
    static assignLevels(dims) {
        for (const dim of dims) {
            let currDim = dim;
            let lvl = 0;
            while (currDim.childLevel) {
                currDim.level = lvl;
                currDim = currDim.childLevel;
                lvl++;
            }
            currDim.level = lvl;
        }
    }
    static getFieldsHierarchy(data, dimensions, dimensionType, pivotKeys, cloneStrategy) {
        const hierarchy = new Map();
        for (const rec of data) {
            const vals = dimensionType === PivotDimensionType.Column ?
                this.extractValuesForColumn(dimensions, rec, pivotKeys) :
                this.extractValuesForRow(dimensions, rec, pivotKeys, cloneStrategy);
            for (const [_key, val] of vals) { // this should go in depth also vals.children
                if (hierarchy.get(val.value) != null) {
                    this.applyHierarchyChildren(hierarchy, val, rec, pivotKeys);
                }
                else {
                    hierarchy.set(val.value, cloneStrategy.clone(val));
                    this.applyHierarchyChildren(hierarchy, val, rec, pivotKeys);
                }
            }
        }
        return hierarchy;
    }
    static sort(data, expressions, sorting = new IgxSorting()) {
        data.forEach(rec => {
            const children = rec.children;
            if (children) {
                children.forEach(x => {
                    this.sort(x, expressions, sorting);
                });
            }
        });
        return DataUtil.sort(data, expressions, sorting);
    }
    static extractValueFromDimension(dim, recData) {
        return dim.memberFunction ? dim.memberFunction.call(null, recData) : recData[dim.memberName];
    }
    static getDimensionDepth(dim) {
        let lvl = 0;
        while (dim.childLevel) {
            lvl++;
            dim = dim.childLevel;
        }
        return lvl;
    }
    static extractValuesForRow(dims, recData, pivotKeys, cloneStrategy) {
        const values = new Map();
        for (const col of dims) {
            if (recData[pivotKeys.level] && recData[pivotKeys.level] > 0) {
                const childData = recData[pivotKeys.records];
                return this.getFieldsHierarchy(childData, [col], PivotDimensionType.Row, pivotKeys, cloneStrategy);
            }
            const value = this.extractValueFromDimension(col, recData);
            const objValue = {};
            objValue['value'] = value;
            objValue['dimension'] = col;
            if (col.childLevel) {
                const childValues = this.extractValuesForRow([col.childLevel], recData, pivotKeys, cloneStrategy);
                objValue[pivotKeys.children] = childValues;
            }
            values.set(value, objValue);
        }
        return values;
    }
    static extractValuesForColumn(dims, recData, pivotKeys, path = []) {
        const vals = new Map();
        let lvlCollection = vals;
        const flattenedDims = this.flatten(dims);
        for (const col of flattenedDims) {
            const value = this.extractValueFromDimension(col, recData);
            path.push(value);
            const newValue = path.join(pivotKeys.columnDimensionSeparator);
            const newObj = { value: newValue, expandable: col.expandable, children: null, dimension: col };
            if (!newObj.children) {
                newObj.children = new Map();
            }
            lvlCollection.set(newValue, newObj);
            lvlCollection = newObj.children;
        }
        return vals;
    }
    static flatten(arr, lvl = 0) {
        const newArr = arr.reduce((acc, item) => {
            if (item) {
                item.level = lvl;
                acc.push(item);
                if (item.childLevel) {
                    item.expandable = true;
                    acc = acc.concat(this.flatten([item.childLevel], lvl + 1));
                }
            }
            return acc;
        }, []);
        return newArr;
    }
    static applyAggregations(rec, hierarchies, values, pivotKeys) {
        if (hierarchies.size === 0) {
            // no column groups
            const aggregationResult = this.aggregate(rec.records, values);
            this.applyAggregationRecordData(aggregationResult, undefined, rec, pivotKeys);
            return;
        }
        hierarchies.forEach((hierarchy) => {
            const children = hierarchy[pivotKeys.children];
            if (children && children.size > 0) {
                this.applyAggregations(rec, children, values, pivotKeys);
                const childRecords = this.collectRecords(children, pivotKeys);
                hierarchy[pivotKeys.aggregations] = this.aggregate(childRecords, values);
                this.applyAggregationRecordData(hierarchy[pivotKeys.aggregations], hierarchy.value, rec, pivotKeys);
            }
            else if (hierarchy[pivotKeys.records]) {
                hierarchy[pivotKeys.aggregations] = this.aggregate(hierarchy[pivotKeys.records], values);
                this.applyAggregationRecordData(hierarchy[pivotKeys.aggregations], hierarchy.value, rec, pivotKeys);
            }
        });
    }
    static applyAggregationRecordData(aggregationData, groupName, rec, pivotKeys) {
        const aggregationKeys = Object.keys(aggregationData);
        if (aggregationKeys.length > 1) {
            aggregationKeys.forEach((key) => {
                const aggregationKey = groupName ? groupName + pivotKeys.columnDimensionSeparator + key : key;
                rec.aggregationValues.set(aggregationKey, aggregationData[key]);
            });
        }
        else if (aggregationKeys.length === 1) {
            const aggregationKey = aggregationKeys[0];
            rec.aggregationValues.set(groupName || aggregationKey, aggregationData[aggregationKey]);
        }
    }
    static aggregate(records, values) {
        const result = {};
        for (const pivotValue of values) {
            const aggregator = PivotUtil.getAggregatorForType(pivotValue.aggregate, pivotValue.dataType);
            if (!aggregator) {
                throw `No valid aggregator found for ${pivotValue.member}. Please set either a valid aggregatorName or aggregator`;
            }
            result[pivotValue.member] = aggregator(records.map(r => r[pivotValue.member]), records);
        }
        return result;
    }
    static getAggregatorForType(aggregate, dataType) {
        let aggregator = aggregate.aggregator;
        if (aggregate.aggregatorName) {
            let aggregators = IgxPivotNumericAggregate.aggregators();
            if (!dataType || dataType === 'date' || dataType === 'dateTime') {
                aggregators = aggregators.concat(IgxPivotDateAggregate.aggregators());
            }
            else if (dataType === 'time') {
                aggregators = aggregators.concat(IgxPivotTimeAggregate.aggregators());
            }
            aggregator = aggregators.find(x => x.key.toLocaleLowerCase() === aggregate.aggregatorName.toLocaleLowerCase())?.aggregator;
        }
        return aggregator;
    }
    static processHierarchy(hierarchies, pivotKeys, level = 0, rootData = false) {
        const flatData = [];
        hierarchies.forEach((h, key) => {
            const field = h.dimension.memberName;
            const rec = {
                dimensionValues: new Map(),
                aggregationValues: new Map(),
                children: new Map(),
                dimensions: [h.dimension]
            };
            rec.dimensionValues.set(field, key);
            if (h[pivotKeys.records]) {
                rec.records = this.getDirectLeafs(h[pivotKeys.records]);
            }
            rec.level = level;
            flatData.push(rec);
            if (h[pivotKeys.children] && h[pivotKeys.children].size > 0) {
                const nestedData = this.processHierarchy(h[pivotKeys.children], pivotKeys, level + 1, rootData);
                rec.records = this.getDirectLeafs(nestedData);
                rec.children.set(field, nestedData);
            }
        });
        return flatData;
    }
    static getDirectLeafs(records) {
        let leafs = [];
        for (const rec of records) {
            if (rec.records) {
                const data = rec.records.filter(x => !x.records && leafs.indexOf(x) === -1);
                leafs = leafs.concat(data);
            }
            else {
                leafs.push(rec);
            }
        }
        return leafs;
    }
    static getRecordKey(rec, currentDim) {
        const parentFields = [];
        const currentDimIndex = rec.dimensions.findIndex(x => x.memberName === currentDim.memberName) + 1;
        const prevDims = rec.dimensions.slice(0, currentDimIndex);
        for (const prev of prevDims) {
            const prevValue = rec.dimensionValues.get(prev.memberName);
            parentFields.push(prevValue);
        }
        return parentFields.join('-');
    }
    static buildExpressionTree(config) {
        const allDimensions = (config?.rows || []).concat((config?.columns || [])).concat(config?.filters || []).filter(x => x !== null && x !== undefined);
        const enabledDimensions = allDimensions.filter(x => x && x.enabled);
        const expressionsTree = new FilteringExpressionsTree(FilteringLogic.And);
        // add expression trees from all filters
        PivotUtil.flatten(enabledDimensions).forEach((x) => {
            if (x.filter && x.filter.filteringOperands) {
                expressionsTree.filteringOperands.push(...x.filter.filteringOperands);
            }
        });
        return expressionsTree;
    }
    static collectRecords(children, pivotKeys) {
        let result = [];
        children.forEach(value => result = result.concat(value[pivotKeys.records]));
        return result;
    }
    static applyHierarchyChildren(hierarchy, val, rec, pivotKeys) {
        const recordsKey = pivotKeys.records;
        const childKey = pivotKeys.children;
        const childCollection = val[childKey];
        const hierarchyValue = hierarchy.get(val.value);
        if (Array.isArray(hierarchyValue[childKey])) {
            hierarchyValue[childKey] = new Map();
        }
        if (!childCollection || childCollection.size === 0) {
            const dim = hierarchyValue.dimension;
            const isValid = this.extractValueFromDimension(dim, rec) === val.value;
            if (isValid) {
                if (hierarchyValue[recordsKey]) {
                    hierarchyValue[recordsKey].push(rec);
                }
                else {
                    hierarchyValue[recordsKey] = [rec];
                }
            }
        }
        else {
            const hierarchyChild = hierarchyValue[childKey];
            for (const [_key, child] of childCollection) {
                let hierarchyChildValue = hierarchyChild.get(child.value);
                if (!hierarchyChildValue) {
                    hierarchyChild.set(child.value, child);
                    hierarchyChildValue = child;
                }
                if (hierarchyChildValue[recordsKey]) {
                    const copy = Object.assign({}, rec);
                    if (rec[recordsKey]) {
                        // not all nested children are valid
                        const nestedValue = hierarchyChildValue.value;
                        const dimension = hierarchyChildValue.dimension;
                        const validRecs = rec[recordsKey].filter(x => this.extractValueFromDimension(dimension, x) === nestedValue);
                        copy[recordsKey] = validRecs;
                    }
                    hierarchyChildValue[recordsKey].push(copy);
                }
                else {
                    hierarchyChildValue[recordsKey] = [rec];
                }
                if (child[childKey] && child[childKey].size > 0) {
                    this.applyHierarchyChildren(hierarchyChild, child, rec, pivotKeys);
                }
            }
        }
    }
    static getAggregateList(val, grid) {
        if (!val.aggregateList) {
            let defaultAggr = this.getAggregatorsForValue(val, grid);
            const isDefault = defaultAggr.find((x) => x.key === val.aggregate.key);
            // resolve custom aggregations
            if (!isDefault && grid.data[0][val.member] !== undefined) {
                // if field exists, then we can apply default aggregations and add the custom one.
                defaultAggr.unshift(val.aggregate);
            }
            else if (!isDefault) {
                // otherwise this is a custom aggregation that is not compatible
                // with the defaults, since it operates on field that is not in the data
                // leave only the custom one.
                defaultAggr = [val.aggregate];
            }
            val.aggregateList = defaultAggr;
        }
        return val.aggregateList;
    }
    static getAggregatorsForValue(value, grid) {
        const dataType = value.dataType || grid.resolveDataTypes(grid.data[0][value.member]);
        switch (dataType) {
            case GridColumnDataType.Number:
            case GridColumnDataType.Currency:
                return IgxPivotNumericAggregate.aggregators();
            case GridColumnDataType.Date:
            case GridColumnDataType.DateTime:
                return IgxPivotDateAggregate.aggregators();
            case GridColumnDataType.Time:
                return IgxPivotTimeAggregate.aggregators();
            default:
                return IgxPivotAggregate.aggregators();
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGl2b3QtdXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lnbml0ZXVpLWFuZ3VsYXIvc3JjL2xpYi9ncmlkcy9waXZvdC1ncmlkL3Bpdm90LXV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFFBQVEsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxzREFBc0QsQ0FBQztBQUN0RixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUc1RixPQUFPLEVBQXdCLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxxQkFBcUIsRUFBRSx3QkFBd0IsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ25JLE9BQU8sRUFBcUcsa0JBQWtCLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUVyTCxNQUFNLE9BQU8sU0FBUztJQUVsQixrRUFBa0U7SUFDM0QsTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUF3QixFQUFFLFNBQTBCLEVBQUUsU0FBcUIsRUFBRSxhQUFpQztRQUN0SSxLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ3JCLDRCQUE0QjtZQUM1QixJQUFJLEdBQUcsQ0FBQyxRQUFRLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3hDLDRCQUE0QjtnQkFDNUIsR0FBRyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRTtvQkFDNUIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxhQUFhLENBQUMsQ0FBQztnQkFDcEUsQ0FBQyxDQUFDLENBQUM7WUFDUCxDQUFD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LGtGQUFrRjtnQkFDbEYsV0FBVyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdkMsQ0FBQztpQkFBTSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ3BCLGdFQUFnRTtnQkFDaEUsd0VBQXdFO2dCQUN4RSw2QkFBNkI7Z0JBQzdCLFdBQVcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNsQyxDQUFDO1lBQ0QsR0FBRyxDQUFDLGFBQWEsR0FBRyxXQUFXLENBQUM7UUFDcEMsQ0FBQztRQUNELE9BQU8sR0FBRyxDQUFDLGFBQWEsQ0FBQztJQUM3QixDQUFDO0lBRU0sTUFBTSxDQUFDLHNCQUFzQixDQUFDLEtBQWtCLEVBQUUsSUFBbUI7UUFDeEUsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNyRixRQUFRLFFBQVEsRUFBRSxDQUFDO1lBQ2YsS0FBSyxrQkFBa0IsQ0FBQyxNQUFNLENBQUM7WUFDL0IsS0FBSyxrQkFBa0IsQ0FBQyxRQUFRO2dCQUM1QixPQUFPLHdCQUF3QixDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2xELEtBQUssa0JBQWtCLENBQUMsSUFBSSxDQUFDO1lBQzdCLEtBQUssa0JBQWtCLENBQUMsUUFBUTtnQkFDNUIsT0FBTyxxQkFBcUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMvQyxLQUFLLGtCQUFrQixDQUFDLElBQUk7Z0JBQ3hCLE9BQU8scUJBQXFCLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDL0M7Z0JBQ0ksT0FBTyxpQkFBaUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvQyxDQUFDO0lBQ0wsQ0FBQztDQUdKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSURhdGFDbG9uZVN0cmF0ZWd5IH0gZnJvbSAnLi4vLi4vZGF0YS1vcGVyYXRpb25zL2RhdGEtY2xvbmUtc3RyYXRlZ3knO1xuaW1wb3J0IHsgRGF0YVV0aWwsIEdyaWRDb2x1bW5EYXRhVHlwZSB9IGZyb20gJy4uLy4uL2RhdGEtb3BlcmF0aW9ucy9kYXRhLXV0aWwnO1xuaW1wb3J0IHsgRmlsdGVyaW5nTG9naWMgfSBmcm9tICcuLi8uLi9kYXRhLW9wZXJhdGlvbnMvZmlsdGVyaW5nLWV4cHJlc3Npb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IEZpbHRlcmluZ0V4cHJlc3Npb25zVHJlZSB9IGZyb20gJy4uLy4uL2RhdGEtb3BlcmF0aW9ucy9maWx0ZXJpbmctZXhwcmVzc2lvbnMtdHJlZSc7XG5pbXBvcnQgeyBJU29ydGluZ0V4cHJlc3Npb24gfSBmcm9tICcuLi8uLi9kYXRhLW9wZXJhdGlvbnMvc29ydGluZy1zdHJhdGVneSc7XG5pbXBvcnQgeyBQaXZvdEdyaWRUeXBlIH0gZnJvbSAnLi4vY29tbW9uL2dyaWQuaW50ZXJmYWNlJztcbmltcG9ydCB7IElHcmlkU29ydGluZ1N0cmF0ZWd5LCBJZ3hTb3J0aW5nIH0gZnJvbSAnLi4vY29tbW9uL3N0cmF0ZWd5JztcbmltcG9ydCB7IElneFBpdm90QWdncmVnYXRlLCBJZ3hQaXZvdERhdGVBZ2dyZWdhdGUsIElneFBpdm90TnVtZXJpY0FnZ3JlZ2F0ZSwgSWd4UGl2b3RUaW1lQWdncmVnYXRlIH0gZnJvbSAnLi9waXZvdC1ncmlkLWFnZ3JlZ2F0ZSc7XG5pbXBvcnQgeyBJUGl2b3RBZ2dyZWdhdG9yLCBJUGl2b3RDb25maWd1cmF0aW9uLCBJUGl2b3REaW1lbnNpb24sIElQaXZvdEdyaWRSZWNvcmQsIElQaXZvdEtleXMsIElQaXZvdFZhbHVlLCBQaXZvdERpbWVuc2lvblR5cGUsIFBpdm90U3VtbWFyeVBvc2l0aW9uIH0gZnJvbSAnLi9waXZvdC1ncmlkLmludGVyZmFjZSc7XG5cbmV4cG9ydCBjbGFzcyBQaXZvdFV0aWwge1xuXG4gICAgLy8gZ28gdGhyb3VnaCBhbGwgY2hpbGRyZW4gYW5kIGFwcGx5IG5ldyBkaW1lbnNpb24gZ3JvdXBzIGFzIGNoaWxkXG4gICAgcHVibGljIHN0YXRpYyBwcm9jZXNzR3JvdXBzKHJlY3M6IElQaXZvdEdyaWRSZWNvcmRbXSwgZGltZW5zaW9uOiBJUGl2b3REaW1lbnNpb24sIHBpdm90S2V5czogSVBpdm90S2V5cywgY2xvbmVTdHJhdGVneTogSURhdGFDbG9uZVN0cmF0ZWd5KSB7XG4gICAgICAgIGZvciAoY29uc3QgcmVjIG9mIHJlY3MpIHtcbiAgICAgICAgICAgIC8vIHByb2Nlc3MgZXhpc3RpbmcgY2hpbGRyZW5cbiAgICAgICAgICAgIGlmIChyZWMuY2hpbGRyZW4gJiYgcmVjLmNoaWxkcmVuLnNpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBoaWVyYXJjaHkgaW4gZGVwdFxuICAgICAgICAgICAgICAgIHJlYy5jaGlsZHJlbi5mb3JFYWNoKCh2YWx1ZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzR3JvdXBzKHZhbHVlcywgZGltZW5zaW9uLCBwaXZvdEtleXMsIGNsb25lU3RyYXRlZ3kpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYWRkIGNoaWxkcmVuIGZvciBjdXJyZW50IGRpbWVuc2lvblxuICAgICAgICAgICAgY29uc3QgaGllcmFyY2h5RmllbGRzID0gUGl2b3RVdGlsXG4gICAgICAgICAgICAgICAgLmdldEZpZWxkc0hpZXJhcmNoeShyZWMucmVjb3JkcywgW2RpbWVuc2lvbl0sIFBpdm90RGltZW5zaW9uVHlwZS5Sb3csIHBpdm90S2V5cywgY2xvbmVTdHJhdGVneSk7XG4gICAgICAgICAgICBjb25zdCBzaWJsaW5nRGF0YSA9IFBpdm90VXRpbFxuICAgICAgICAgICAgICAgIC5wcm9jZXNzSGllcmFyY2h5KGhpZXJhcmNoeUZpZWxkcywgcGl2b3RLZXlzLCAwKTtcbiAgICAgICAgICAgIHJlYy5jaGlsZHJlbi5zZXQoZGltZW5zaW9uLm1lbWJlck5hbWUsIHNpYmxpbmdEYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZmxhdHRlbkdyb3VwcyhkYXRhOiBJUGl2b3RHcmlkUmVjb3JkW10sIGRpbWVuc2lvbjogSVBpdm90RGltZW5zaW9uLCBleHBhbnNpb25TdGF0ZXMsIGRlZmF1bHRFeHBhbmQ6IGJvb2xlYW4sIHBhcmVudD86IElQaXZvdERpbWVuc2lvbiwgcGFyZW50UmVjPzogSVBpdm90R3JpZFJlY29yZCkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHJlYyA9IGRhdGFbaV07XG4gICAgICAgICAgICBjb25zdCBmaWVsZCA9IGRpbWVuc2lvbi5tZW1iZXJOYW1lO1xuICAgICAgICAgICAgaWYgKCFmaWVsZCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgcmVjb3Jkc0RhdGEgPSByZWMuY2hpbGRyZW4uZ2V0KGZpZWxkKTtcbiAgICAgICAgICAgIGlmICghcmVjb3Jkc0RhdGEgJiYgcGFyZW50KSB7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgcGFyZW50XG4gICAgICAgICAgICAgICAgcmVjb3Jkc0RhdGEgPSByZWMuY2hpbGRyZW4uZ2V0KHBhcmVudC5tZW1iZXJOYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAocmVjb3Jkc0RhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGltZW5zaW9uID0gcGFyZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhcmVudFJlYykge1xuICAgICAgICAgICAgICAgIHBhcmVudFJlYy5kaW1lbnNpb25WYWx1ZXMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50Lm1lbWJlck5hbWUgIT09IGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjLmRpbWVuc2lvblZhbHVlcy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaW0gPSBwYXJlbnRSZWMuZGltZW5zaW9ucy5maW5kKHggPT4geC5tZW1iZXJOYW1lID09PSBrZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjLmRpbWVuc2lvbnMudW5zaGlmdChkaW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBjb25zdCBleHBhbnNpb25Sb3dLZXkgPSBQaXZvdFV0aWwuZ2V0UmVjb3JkS2V5KHJlYywgZGltZW5zaW9uKTtcbiAgICAgICAgICAgIGNvbnN0IGlzRXhwYW5kZWQgPSBleHBhbnNpb25TdGF0ZXMuZ2V0KGV4cGFuc2lvblJvd0tleSkgPT09IHVuZGVmaW5lZCA/XG4gICAgICAgICAgICAgICAgZGVmYXVsdEV4cGFuZCA6XG4gICAgICAgICAgICAgICAgZXhwYW5zaW9uU3RhdGVzLmdldChleHBhbnNpb25Sb3dLZXkpO1xuICAgICAgICAgICAgY29uc3Qgc2hvdWxkRXhwYW5kID0gaXNFeHBhbmRlZCB8fCAhZGltZW5zaW9uLmNoaWxkTGV2ZWwgfHwgIXJlYy5kaW1lbnNpb25WYWx1ZXMuZ2V0KGRpbWVuc2lvbi5tZW1iZXJOYW1lKTtcbiAgICAgICAgICAgIGlmIChzaG91bGRFeHBhbmQgJiYgcmVjb3Jkc0RhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGltZW5zaW9uLmNoaWxkTGV2ZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGF0dGVuR3JvdXBzKHJlY29yZHNEYXRhLCBkaW1lbnNpb24uY2hpbGRMZXZlbCwgZXhwYW5zaW9uU3RhdGVzLCBkZWZhdWx0RXhwYW5kLCBkaW1lbnNpb24sIHJlYyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29weSBwYXJlbnQgdmFsdWVzIGFuZCBkaW1zIGluIGNoaWxkXG4gICAgICAgICAgICAgICAgICAgIHJlY29yZHNEYXRhLmZvckVhY2goeCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWMuZGltZW5zaW9uVmFsdWVzLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGltZW5zaW9uLm1lbWJlck5hbWUgIT09IGtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4LmRpbWVuc2lvblZhbHVlcy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpbSA9IHJlYy5kaW1lbnNpb25zLmZpbmQoeSA9PiB5Lm1lbWJlck5hbWUgPT09IGtleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHguZGltZW5zaW9ucy51bnNoaWZ0KGRpbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGF0YS5zcGxpY2UoaSArIDEsIDAsIC4uLnJlY29yZHNEYXRhKTtcbiAgICAgICAgICAgICAgICBpICs9IHJlY29yZHNEYXRhLmxlbmd0aDtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBmbGF0dGVuR3JvdXBzSG9yaXpvbnRhbGx5KGRhdGE6IElQaXZvdEdyaWRSZWNvcmRbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGltZW5zaW9uOiBJUGl2b3REaW1lbnNpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGFuc2lvblN0YXRlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdEV4cGFuZDogYm9vbGVhbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZURpbWVuc2lvbnM6IElQaXZvdERpbWVuc2lvbltdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdW1tYXJpZXNQb3NpdGlvbjogUGl2b3RTdW1tYXJ5UG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudD86IElQaXZvdERpbWVuc2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50UmVjPzogSVBpdm90R3JpZFJlY29yZCkge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHJlYyA9IGRhdGFbaV07XG4gICAgICAgICAgICBjb25zdCBmaWVsZCA9IGRpbWVuc2lvbi5tZW1iZXJOYW1lO1xuICAgICAgICAgICAgaWYgKCFmaWVsZCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIXZpc2libGVEaW1lbnNpb25zLmZpbmQocmVjRGltID0+IHJlY0RpbS5tZW1iZXJOYW1lID09PSByZWMuZGltZW5zaW9uc1swXS5tZW1iZXJOYW1lKSkge1xuICAgICAgICAgICAgICAgIHZpc2libGVEaW1lbnNpb25zLnB1c2gocmVjLmRpbWVuc2lvbnNbMF0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgcmVjb3Jkc0RhdGEgPSByZWMuY2hpbGRyZW4uZ2V0KGZpZWxkKTtcbiAgICAgICAgICAgIGlmICghcmVjb3Jkc0RhdGEgJiYgcGFyZW50KSB7XG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgcGFyZW50XG4gICAgICAgICAgICAgICAgcmVjb3Jkc0RhdGEgPSByZWMuY2hpbGRyZW4uZ2V0KHBhcmVudC5tZW1iZXJOYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAocmVjb3Jkc0RhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgZGltZW5zaW9uID0gcGFyZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhcmVudFJlYykge1xuICAgICAgICAgICAgICAgIHBhcmVudFJlYy5kaW1lbnNpb25WYWx1ZXMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZWMuZGltZW5zaW9uVmFsdWVzLnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGltID0gcGFyZW50UmVjLmRpbWVuc2lvbnMuZmluZCh4ID0+IHgubWVtYmVyTmFtZSA9PT0ga2V5KTtcbiAgICAgICAgICAgICAgICAgICAgcmVjLmRpbWVuc2lvbnMudW5zaGlmdChkaW0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBleHBhbnNpb25Sb3dLZXkgPSBQaXZvdFV0aWwuZ2V0UmVjb3JkS2V5KHJlYywgZGltZW5zaW9uKTtcbiAgICAgICAgICAgIGNvbnN0IGlzRXhwYW5kZWQgPSBleHBhbnNpb25TdGF0ZXMuZ2V0KGV4cGFuc2lvblJvd0tleSkgPT09IHVuZGVmaW5lZCA/XG4gICAgICAgICAgICAgICAgZGVmYXVsdEV4cGFuZCA6XG4gICAgICAgICAgICAgICAgZXhwYW5zaW9uU3RhdGVzLmdldChleHBhbnNpb25Sb3dLZXkpO1xuICAgICAgICAgICAgY29uc3Qgc2hvdWxkRXhwYW5kID0gaXNFeHBhbmRlZCB8fCAhZGltZW5zaW9uLmNoaWxkTGV2ZWwgfHwgIXJlYy5kaW1lbnNpb25WYWx1ZXMuZ2V0KGRpbWVuc2lvbi5tZW1iZXJOYW1lKTtcbiAgICAgICAgICAgIGlmIChzaG91bGRFeHBhbmQgJiYgcmVjb3Jkc0RhdGEgJiYgIXJlYy50b3RhbFJlY29yZERpbWVuc2lvbk5hbWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGltZW5zaW9uLmNoaWxkTGV2ZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGF0dGVuR3JvdXBzSG9yaXpvbnRhbGx5KHJlY29yZHNEYXRhLCBkaW1lbnNpb24uY2hpbGRMZXZlbCwgZXhwYW5zaW9uU3RhdGVzLCBkZWZhdWx0RXhwYW5kLCB2aXNpYmxlRGltZW5zaW9ucywgc3VtbWFyaWVzUG9zaXRpb24sIGRpbWVuc2lvbiwgcmVjKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBjb3B5IHBhcmVudCB2YWx1ZXMgYW5kIGRpbXMgaW4gY2hpbGRcbiAgICAgICAgICAgICAgICAgICAgcmVjb3Jkc0RhdGEuZm9yRWFjaCh4ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYy5kaW1lbnNpb25WYWx1ZXMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaW1lbnNpb24ubWVtYmVyTmFtZSAhPT0ga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHguZGltZW5zaW9uVmFsdWVzLnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGltID0gcmVjLmRpbWVuc2lvbnMuZmluZCh5ID0+IHkubWVtYmVyTmFtZSA9PT0ga2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeC5kaW1lbnNpb25zLnVuc2hpZnQoZGltKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZWNvcmRzRGF0YS5mb3JFYWNoKChjaGlsZFJlYykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGRSZWMuZGltZW5zaW9ucy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYy5kaW1lbnNpb25WYWx1ZXMuZm9yRWFjaCgodmFsdWU6IHN0cmluZywga2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRSZWMuZGltZW5zaW9uVmFsdWVzLnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY2hpbGRSZWMuZGltZW5zaW9ucy5mb3JFYWNoKChkaW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdmlzaWJsZURpbWVuc2lvbnMuZmluZChyZWNEaW0gPT4gcmVjRGltLm1lbWJlck5hbWUgPT09IGRpbS5tZW1iZXJOYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGVEaW1lbnNpb25zLnB1c2goZGltKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjdXJEaW1WYWx1ZSA9IHJlYy5kaW1lbnNpb25WYWx1ZXMuZ2V0KGRpbWVuc2lvbi5tZW1iZXJOYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAoZGltZW5zaW9uLmhvcml6b250YWxTdW1tYXJ5ICYmIGN1ckRpbVZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlYy50b3RhbFJlY29yZERpbWVuc2lvbk5hbWUgPSBkaW1lbnNpb24ubWVtYmVyTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgcmVjLmRpbWVuc2lvblZhbHVlcy5zZXQoZGltZW5zaW9uLm1lbWJlck5hbWUsIGAke2N1ckRpbVZhbHVlfSBUb3RhbGApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3VtbWFyaWVzUG9zaXRpb24gPT09IFBpdm90U3VtbWFyeVBvc2l0aW9uLlRvcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3Jkc0RhdGEudW5zaGlmdChyZWMpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3Jkc0RhdGEucHVzaChyZWMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGF0YS5zcGxpY2UoaSwgMSwgLi4ucmVjb3Jkc0RhdGEpO1xuICAgICAgICAgICAgICAgIGkgKz0gcmVjb3Jkc0RhdGEubGVuZ3RoIC0gMTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBhc3NpZ25MZXZlbHMoZGltcykge1xuICAgICAgICBmb3IgKGNvbnN0IGRpbSBvZiBkaW1zKSB7XG4gICAgICAgICAgICBsZXQgY3VyckRpbSA9IGRpbTtcbiAgICAgICAgICAgIGxldCBsdmwgPSAwO1xuICAgICAgICAgICAgd2hpbGUgKGN1cnJEaW0uY2hpbGRMZXZlbCkge1xuICAgICAgICAgICAgICAgIGN1cnJEaW0ubGV2ZWwgPSBsdmw7XG4gICAgICAgICAgICAgICAgY3VyckRpbSA9IGN1cnJEaW0uY2hpbGRMZXZlbDtcbiAgICAgICAgICAgICAgICBsdmwrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJEaW0ubGV2ZWwgPSBsdmw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBnZXRGaWVsZHNIaWVyYXJjaHkoZGF0YTogYW55W10sIGRpbWVuc2lvbnM6IElQaXZvdERpbWVuc2lvbltdLFxuICAgICAgICBkaW1lbnNpb25UeXBlOiBQaXZvdERpbWVuc2lvblR5cGUsIHBpdm90S2V5czogSVBpdm90S2V5cywgY2xvbmVTdHJhdGVneTogSURhdGFDbG9uZVN0cmF0ZWd5KTogTWFwPHN0cmluZywgYW55PiB7XG4gICAgICAgIGNvbnN0IGhpZXJhcmNoeSA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XG4gICAgICAgIGZvciAoY29uc3QgcmVjIG9mIGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHMgPSBkaW1lbnNpb25UeXBlID09PSBQaXZvdERpbWVuc2lvblR5cGUuQ29sdW1uID9cbiAgICAgICAgICAgICAgICB0aGlzLmV4dHJhY3RWYWx1ZXNGb3JDb2x1bW4oZGltZW5zaW9ucywgcmVjLCBwaXZvdEtleXMpIDpcbiAgICAgICAgICAgICAgICB0aGlzLmV4dHJhY3RWYWx1ZXNGb3JSb3coZGltZW5zaW9ucywgcmVjLCBwaXZvdEtleXMsIGNsb25lU3RyYXRlZ3kpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBbX2tleSwgdmFsXSBvZiB2YWxzKSB7IC8vIHRoaXMgc2hvdWxkIGdvIGluIGRlcHRoIGFsc28gdmFscy5jaGlsZHJlblxuICAgICAgICAgICAgICAgIGlmIChoaWVyYXJjaHkuZ2V0KHZhbC52YWx1ZSkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5SGllcmFyY2h5Q2hpbGRyZW4oaGllcmFyY2h5LCB2YWwsIHJlYywgcGl2b3RLZXlzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBoaWVyYXJjaHkuc2V0KHZhbC52YWx1ZSwgY2xvbmVTdHJhdGVneS5jbG9uZSh2YWwpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseUhpZXJhcmNoeUNoaWxkcmVuKGhpZXJhcmNoeSwgdmFsLCByZWMsIHBpdm90S2V5cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBoaWVyYXJjaHk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBzb3J0KGRhdGE6IElQaXZvdEdyaWRSZWNvcmRbXSwgZXhwcmVzc2lvbnM6IElTb3J0aW5nRXhwcmVzc2lvbltdLCBzb3J0aW5nOiBJR3JpZFNvcnRpbmdTdHJhdGVneSA9IG5ldyBJZ3hTb3J0aW5nKCkpOiBhbnlbXSB7XG4gICAgICAgIGRhdGEuZm9yRWFjaChyZWMgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSByZWMuY2hpbGRyZW47XG4gICAgICAgICAgICBpZiAoY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKHggPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNvcnQoeCwgZXhwcmVzc2lvbnMsIHNvcnRpbmcpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIERhdGFVdGlsLnNvcnQoZGF0YSwgZXhwcmVzc2lvbnMsIHNvcnRpbmcpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZXh0cmFjdFZhbHVlRnJvbURpbWVuc2lvbihkaW06IElQaXZvdERpbWVuc2lvbiwgcmVjRGF0YTogYW55KSB7XG4gICAgICAgIHJldHVybiBkaW0ubWVtYmVyRnVuY3Rpb24gPyBkaW0ubWVtYmVyRnVuY3Rpb24uY2FsbChudWxsLCByZWNEYXRhKSA6IHJlY0RhdGFbZGltLm1lbWJlck5hbWVdO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0RGltZW5zaW9uRGVwdGgoZGltOiBJUGl2b3REaW1lbnNpb24pOiBudW1iZXIge1xuICAgICAgICBsZXQgbHZsID0gMDtcbiAgICAgICAgd2hpbGUgKGRpbS5jaGlsZExldmVsKSB7XG4gICAgICAgICAgICBsdmwrKztcbiAgICAgICAgICAgIGRpbSA9IGRpbS5jaGlsZExldmVsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsdmw7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBleHRyYWN0VmFsdWVzRm9yUm93KGRpbXM6IElQaXZvdERpbWVuc2lvbltdLCByZWNEYXRhOiBhbnksIHBpdm90S2V5czogSVBpdm90S2V5cywgY2xvbmVTdHJhdGVneTogSURhdGFDbG9uZVN0cmF0ZWd5KSB7XG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XG4gICAgICAgIGZvciAoY29uc3QgY29sIG9mIGRpbXMpIHtcbiAgICAgICAgICAgIGlmIChyZWNEYXRhW3Bpdm90S2V5cy5sZXZlbF0gJiYgcmVjRGF0YVtwaXZvdEtleXMubGV2ZWxdID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkRGF0YSA9IHJlY0RhdGFbcGl2b3RLZXlzLnJlY29yZHNdO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEZpZWxkc0hpZXJhcmNoeShjaGlsZERhdGEsIFtjb2xdLCBQaXZvdERpbWVuc2lvblR5cGUuUm93LCBwaXZvdEtleXMsIGNsb25lU3RyYXRlZ3kpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZXh0cmFjdFZhbHVlRnJvbURpbWVuc2lvbihjb2wsIHJlY0RhdGEpO1xuICAgICAgICAgICAgY29uc3Qgb2JqVmFsdWUgPSB7fTtcbiAgICAgICAgICAgIG9ialZhbHVlWyd2YWx1ZSddID0gdmFsdWU7XG4gICAgICAgICAgICBvYmpWYWx1ZVsnZGltZW5zaW9uJ10gPSBjb2w7XG4gICAgICAgICAgICBpZiAoY29sLmNoaWxkTGV2ZWwpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZFZhbHVlcyA9IHRoaXMuZXh0cmFjdFZhbHVlc0ZvclJvdyhbY29sLmNoaWxkTGV2ZWxdLCByZWNEYXRhLCBwaXZvdEtleXMsIGNsb25lU3RyYXRlZ3kpO1xuICAgICAgICAgICAgICAgIG9ialZhbHVlW3Bpdm90S2V5cy5jaGlsZHJlbl0gPSBjaGlsZFZhbHVlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbHVlcy5zZXQodmFsdWUsIG9ialZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBleHRyYWN0VmFsdWVzRm9yQ29sdW1uKGRpbXM6IElQaXZvdERpbWVuc2lvbltdLCByZWNEYXRhOiBhbnksIHBpdm90S2V5czogSVBpdm90S2V5cywgcGF0aCA9IFtdKSB7XG4gICAgICAgIGNvbnN0IHZhbHMgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuICAgICAgICBsZXQgbHZsQ29sbGVjdGlvbiA9IHZhbHM7XG4gICAgICAgIGNvbnN0IGZsYXR0ZW5lZERpbXMgPSB0aGlzLmZsYXR0ZW4oZGltcyk7XG4gICAgICAgIGZvciAoY29uc3QgY29sIG9mIGZsYXR0ZW5lZERpbXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5leHRyYWN0VmFsdWVGcm9tRGltZW5zaW9uKGNvbCwgcmVjRGF0YSk7XG4gICAgICAgICAgICBwYXRoLnB1c2godmFsdWUpO1xuICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBwYXRoLmpvaW4ocGl2b3RLZXlzLmNvbHVtbkRpbWVuc2lvblNlcGFyYXRvcik7XG4gICAgICAgICAgICBjb25zdCBuZXdPYmogPSB7IHZhbHVlOiBuZXdWYWx1ZSwgZXhwYW5kYWJsZTogY29sLmV4cGFuZGFibGUsIGNoaWxkcmVuOiBudWxsLCBkaW1lbnNpb246IGNvbCB9O1xuICAgICAgICAgICAgaWYgKCFuZXdPYmouY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICBuZXdPYmouY2hpbGRyZW4gPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbHZsQ29sbGVjdGlvbi5zZXQobmV3VmFsdWUsIG5ld09iaik7XG4gICAgICAgICAgICBsdmxDb2xsZWN0aW9uID0gbmV3T2JqLmNoaWxkcmVuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWxzO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZmxhdHRlbihhcnIsIGx2bCA9IDApIHtcbiAgICAgICAgY29uc3QgbmV3QXJyID0gYXJyLnJlZHVjZSgoYWNjLCBpdGVtKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIGl0ZW0ubGV2ZWwgPSBsdmw7XG4gICAgICAgICAgICAgICAgYWNjLnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uY2hpbGRMZXZlbCkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmV4cGFuZGFibGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBhY2MgPSBhY2MuY29uY2F0KHRoaXMuZmxhdHRlbihbaXRlbS5jaGlsZExldmVsXSwgbHZsICsgMSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIFtdKTtcbiAgICAgICAgcmV0dXJuIG5ld0FycjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGFwcGx5QWdncmVnYXRpb25zKHJlYzogSVBpdm90R3JpZFJlY29yZCwgaGllcmFyY2hpZXMsIHZhbHVlcywgcGl2b3RLZXlzOiBJUGl2b3RLZXlzKSB7XG4gICAgICAgIGlmIChoaWVyYXJjaGllcy5zaXplID09PSAwKSB7XG4gICAgICAgICAgICAvLyBubyBjb2x1bW4gZ3JvdXBzXG4gICAgICAgICAgICBjb25zdCBhZ2dyZWdhdGlvblJlc3VsdCA9IHRoaXMuYWdncmVnYXRlKHJlYy5yZWNvcmRzLCB2YWx1ZXMpO1xuICAgICAgICAgICAgdGhpcy5hcHBseUFnZ3JlZ2F0aW9uUmVjb3JkRGF0YShhZ2dyZWdhdGlvblJlc3VsdCwgdW5kZWZpbmVkLCByZWMsIHBpdm90S2V5cyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaGllcmFyY2hpZXMuZm9yRWFjaCgoaGllcmFyY2h5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGhpZXJhcmNoeVtwaXZvdEtleXMuY2hpbGRyZW5dO1xuICAgICAgICAgICAgaWYgKGNoaWxkcmVuICYmIGNoaWxkcmVuLnNpemUgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBseUFnZ3JlZ2F0aW9ucyhyZWMsIGNoaWxkcmVuLCB2YWx1ZXMsIHBpdm90S2V5cyk7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGRSZWNvcmRzID0gdGhpcy5jb2xsZWN0UmVjb3JkcyhjaGlsZHJlbiwgcGl2b3RLZXlzKTtcbiAgICAgICAgICAgICAgICBoaWVyYXJjaHlbcGl2b3RLZXlzLmFnZ3JlZ2F0aW9uc10gPSB0aGlzLmFnZ3JlZ2F0ZShjaGlsZFJlY29yZHMsIHZhbHVlcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBseUFnZ3JlZ2F0aW9uUmVjb3JkRGF0YShoaWVyYXJjaHlbcGl2b3RLZXlzLmFnZ3JlZ2F0aW9uc10sIGhpZXJhcmNoeS52YWx1ZSwgcmVjLCBwaXZvdEtleXMpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoaWVyYXJjaHlbcGl2b3RLZXlzLnJlY29yZHNdKSB7XG4gICAgICAgICAgICAgICAgaGllcmFyY2h5W3Bpdm90S2V5cy5hZ2dyZWdhdGlvbnNdID0gdGhpcy5hZ2dyZWdhdGUoaGllcmFyY2h5W3Bpdm90S2V5cy5yZWNvcmRzXSwgdmFsdWVzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5QWdncmVnYXRpb25SZWNvcmREYXRhKGhpZXJhcmNoeVtwaXZvdEtleXMuYWdncmVnYXRpb25zXSwgaGllcmFyY2h5LnZhbHVlLCByZWMsIHBpdm90S2V5cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzdGF0aWMgYXBwbHlBZ2dyZWdhdGlvblJlY29yZERhdGEoYWdncmVnYXRpb25EYXRhOiBhbnksIGdyb3VwTmFtZTogc3RyaW5nLCByZWM6IElQaXZvdEdyaWRSZWNvcmQsIHBpdm90S2V5czogSVBpdm90S2V5cykge1xuICAgICAgICBjb25zdCBhZ2dyZWdhdGlvbktleXMgPSBPYmplY3Qua2V5cyhhZ2dyZWdhdGlvbkRhdGEpO1xuICAgICAgICBpZiAoYWdncmVnYXRpb25LZXlzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGFnZ3JlZ2F0aW9uS2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBhZ2dyZWdhdGlvbktleSA9IGdyb3VwTmFtZSA/IGdyb3VwTmFtZSArIHBpdm90S2V5cy5jb2x1bW5EaW1lbnNpb25TZXBhcmF0b3IgKyBrZXkgOiBrZXk7XG4gICAgICAgICAgICAgICAgcmVjLmFnZ3JlZ2F0aW9uVmFsdWVzLnNldChhZ2dyZWdhdGlvbktleSwgYWdncmVnYXRpb25EYXRhW2tleV0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSAgaWYgKGFnZ3JlZ2F0aW9uS2V5cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IGFnZ3JlZ2F0aW9uS2V5ID0gYWdncmVnYXRpb25LZXlzWzBdO1xuICAgICAgICAgICAgcmVjLmFnZ3JlZ2F0aW9uVmFsdWVzLnNldChncm91cE5hbWUgfHwgYWdncmVnYXRpb25LZXksIGFnZ3JlZ2F0aW9uRGF0YVthZ2dyZWdhdGlvbktleV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBhZ2dyZWdhdGUocmVjb3JkcywgdmFsdWVzOiBJUGl2b3RWYWx1ZVtdKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgICAgICBmb3IgKGNvbnN0IHBpdm90VmFsdWUgb2YgdmFsdWVzKSB7XG4gICAgICAgICAgICBjb25zdCBhZ2dyZWdhdG9yID0gUGl2b3RVdGlsLmdldEFnZ3JlZ2F0b3JGb3JUeXBlKHBpdm90VmFsdWUuYWdncmVnYXRlLCBwaXZvdFZhbHVlLmRhdGFUeXBlKTtcbiAgICAgICAgICAgIGlmICghYWdncmVnYXRvcikge1xuICAgICAgICAgICAgICAgIHRocm93IGBObyB2YWxpZCBhZ2dyZWdhdG9yIGZvdW5kIGZvciAke3Bpdm90VmFsdWUubWVtYmVyfS4gUGxlYXNlIHNldCBlaXRoZXIgYSB2YWxpZCBhZ2dyZWdhdG9yTmFtZSBvciBhZ2dyZWdhdG9yYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdFtwaXZvdFZhbHVlLm1lbWJlcl0gPSBhZ2dyZWdhdG9yKHJlY29yZHMubWFwKHIgPT4gcltwaXZvdFZhbHVlLm1lbWJlcl0pLCByZWNvcmRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBnZXRBZ2dyZWdhdG9yRm9yVHlwZShhZ2dyZWdhdGU6IElQaXZvdEFnZ3JlZ2F0b3IsIGRhdGFUeXBlOiBHcmlkQ29sdW1uRGF0YVR5cGUpIHtcbiAgICAgICAgbGV0IGFnZ3JlZ2F0b3IgPSBhZ2dyZWdhdGUuYWdncmVnYXRvcjtcbiAgICAgICAgaWYgKGFnZ3JlZ2F0ZS5hZ2dyZWdhdG9yTmFtZSkge1xuICAgICAgICAgICAgbGV0IGFnZ3JlZ2F0b3JzID0gSWd4UGl2b3ROdW1lcmljQWdncmVnYXRlLmFnZ3JlZ2F0b3JzKCk7XG4gICAgICAgICAgICBpZiAoIWRhdGFUeXBlIHx8IGRhdGFUeXBlID09PSAnZGF0ZScgfHwgZGF0YVR5cGUgPT09ICdkYXRlVGltZScpIHtcbiAgICAgICAgICAgICAgICBhZ2dyZWdhdG9ycyA9IGFnZ3JlZ2F0b3JzLmNvbmNhdChJZ3hQaXZvdERhdGVBZ2dyZWdhdGUuYWdncmVnYXRvcnMoKSlcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YVR5cGUgPT09ICd0aW1lJykge1xuICAgICAgICAgICAgICAgIGFnZ3JlZ2F0b3JzID0gYWdncmVnYXRvcnMuY29uY2F0KElneFBpdm90VGltZUFnZ3JlZ2F0ZS5hZ2dyZWdhdG9ycygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFnZ3JlZ2F0b3IgPSBhZ2dyZWdhdG9ycy5maW5kKHggPT4geC5rZXkudG9Mb2NhbGVMb3dlckNhc2UoKSA9PT0gYWdncmVnYXRlLmFnZ3JlZ2F0b3JOYW1lLnRvTG9jYWxlTG93ZXJDYXNlKCkpPy5hZ2dyZWdhdG9yO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhZ2dyZWdhdG9yO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgcHJvY2Vzc0hpZXJhcmNoeShoaWVyYXJjaGllcywgcGl2b3RLZXlzLCBsZXZlbCA9IDAsIHJvb3REYXRhID0gZmFsc2UpOiBJUGl2b3RHcmlkUmVjb3JkW10ge1xuICAgICAgICBjb25zdCBmbGF0RGF0YTogSVBpdm90R3JpZFJlY29yZFtdID0gW107XG4gICAgICAgIGhpZXJhcmNoaWVzLmZvckVhY2goKGgsIGtleSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmllbGQgPSBoLmRpbWVuc2lvbi5tZW1iZXJOYW1lO1xuICAgICAgICAgICAgY29uc3QgcmVjOiBJUGl2b3RHcmlkUmVjb3JkID0ge1xuICAgICAgICAgICAgICAgIGRpbWVuc2lvblZhbHVlczogbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKSxcbiAgICAgICAgICAgICAgICBhZ2dyZWdhdGlvblZhbHVlczogbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKSxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogbmV3IE1hcDxzdHJpbmcsIElQaXZvdEdyaWRSZWNvcmRbXT4oKSxcbiAgICAgICAgICAgICAgICBkaW1lbnNpb25zOiBbaC5kaW1lbnNpb25dXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmVjLmRpbWVuc2lvblZhbHVlcy5zZXQoZmllbGQsIGtleSk7XG4gICAgICAgICAgICBpZiAoaFtwaXZvdEtleXMucmVjb3Jkc10pIHtcbiAgICAgICAgICAgICAgICByZWMucmVjb3JkcyA9IHRoaXMuZ2V0RGlyZWN0TGVhZnMoaFtwaXZvdEtleXMucmVjb3Jkc10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVjLmxldmVsID0gbGV2ZWw7XG4gICAgICAgICAgICBmbGF0RGF0YS5wdXNoKHJlYyk7XG4gICAgICAgICAgICBpZiAoaFtwaXZvdEtleXMuY2hpbGRyZW5dICYmIGhbcGl2b3RLZXlzLmNoaWxkcmVuXS5zaXplID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5lc3RlZERhdGEgPSB0aGlzLnByb2Nlc3NIaWVyYXJjaHkoaFtwaXZvdEtleXMuY2hpbGRyZW5dLFxuICAgICAgICAgICAgICAgICAgICBwaXZvdEtleXMsIGxldmVsICsgMSwgcm9vdERhdGEpO1xuICAgICAgICAgICAgICAgIHJlYy5yZWNvcmRzID0gdGhpcy5nZXREaXJlY3RMZWFmcyhuZXN0ZWREYXRhKTtcbiAgICAgICAgICAgICAgICByZWMuY2hpbGRyZW4uc2V0KGZpZWxkLCBuZXN0ZWREYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGZsYXREYXRhO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0RGlyZWN0TGVhZnMocmVjb3JkczogSVBpdm90R3JpZFJlY29yZFtdKSB7XG4gICAgICAgIGxldCBsZWFmcyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHJlYyBvZiByZWNvcmRzKSB7XG4gICAgICAgICAgICBpZiAocmVjLnJlY29yZHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVjLnJlY29yZHMuZmlsdGVyKHggPT4gIXgucmVjb3JkcyAmJiBsZWFmcy5pbmRleE9mKHgpID09PSAtMSk7XG4gICAgICAgICAgICAgICAgbGVhZnMgPSBsZWFmcy5jb25jYXQoZGF0YSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxlYWZzLnB1c2gocmVjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGVhZnM7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBnZXRSZWNvcmRLZXkocmVjOiBJUGl2b3RHcmlkUmVjb3JkLCBjdXJyZW50RGltOiBJUGl2b3REaW1lbnNpb24pIHtcbiAgICAgICAgY29uc3QgcGFyZW50RmllbGRzID0gW107XG5cbiAgICAgICAgY29uc3QgY3VycmVudERpbUluZGV4ID0gcmVjLmRpbWVuc2lvbnMuZmluZEluZGV4KHggPT4geC5tZW1iZXJOYW1lID09PSBjdXJyZW50RGltLm1lbWJlck5hbWUpICsgMTtcbiAgICAgICAgY29uc3QgcHJldkRpbXMgPSByZWMuZGltZW5zaW9ucy5zbGljZSgwLCBjdXJyZW50RGltSW5kZXgpO1xuICAgICAgICBmb3IgKGNvbnN0IHByZXYgb2YgcHJldkRpbXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHByZXZWYWx1ZSA9IHJlYy5kaW1lbnNpb25WYWx1ZXMuZ2V0KHByZXYubWVtYmVyTmFtZSk7XG4gICAgICAgICAgICBwYXJlbnRGaWVsZHMucHVzaChwcmV2VmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHBhcmVudEZpZWxkcy5qb2luKCctJyk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBidWlsZEV4cHJlc3Npb25UcmVlKGNvbmZpZzogSVBpdm90Q29uZmlndXJhdGlvbikge1xuICAgICAgICBjb25zdCBhbGxEaW1lbnNpb25zID0gKGNvbmZpZz8ucm93cyB8fCBbXSkuY29uY2F0KChjb25maWc/LmNvbHVtbnMgfHwgW10pKS5jb25jYXQoY29uZmlnPy5maWx0ZXJzIHx8IFtdKS5maWx0ZXIoeCA9PiB4ICE9PSBudWxsICYmIHggIT09IHVuZGVmaW5lZCk7XG4gICAgICAgIGNvbnN0IGVuYWJsZWREaW1lbnNpb25zID0gYWxsRGltZW5zaW9ucy5maWx0ZXIoeCA9PiB4ICYmIHguZW5hYmxlZCk7XG5cbiAgICAgICAgY29uc3QgZXhwcmVzc2lvbnNUcmVlID0gbmV3IEZpbHRlcmluZ0V4cHJlc3Npb25zVHJlZShGaWx0ZXJpbmdMb2dpYy5BbmQpO1xuICAgICAgICAvLyBhZGQgZXhwcmVzc2lvbiB0cmVlcyBmcm9tIGFsbCBmaWx0ZXJzXG4gICAgICAgIFBpdm90VXRpbC5mbGF0dGVuKGVuYWJsZWREaW1lbnNpb25zKS5mb3JFYWNoKCh4OiBJUGl2b3REaW1lbnNpb24pID0+IHtcbiAgICAgICAgICAgIGlmICh4LmZpbHRlciAmJiB4LmZpbHRlci5maWx0ZXJpbmdPcGVyYW5kcykge1xuICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zVHJlZS5maWx0ZXJpbmdPcGVyYW5kcy5wdXNoKC4uLnguZmlsdGVyLmZpbHRlcmluZ09wZXJhbmRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGV4cHJlc3Npb25zVHJlZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXRpYyBjb2xsZWN0UmVjb3JkcyhjaGlsZHJlbiwgcGl2b3RLZXlzOiBJUGl2b3RLZXlzKSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBbXTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaCh2YWx1ZSA9PiByZXN1bHQgPSByZXN1bHQuY29uY2F0KHZhbHVlW3Bpdm90S2V5cy5yZWNvcmRzXSkpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhdGljIGFwcGx5SGllcmFyY2h5Q2hpbGRyZW4oaGllcmFyY2h5LCB2YWwsIHJlYywgcGl2b3RLZXlzOiBJUGl2b3RLZXlzKSB7XG4gICAgICAgIGNvbnN0IHJlY29yZHNLZXkgPSBwaXZvdEtleXMucmVjb3JkcztcbiAgICAgICAgY29uc3QgY2hpbGRLZXkgPSBwaXZvdEtleXMuY2hpbGRyZW47XG4gICAgICAgIGNvbnN0IGNoaWxkQ29sbGVjdGlvbiA9IHZhbFtjaGlsZEtleV07XG4gICAgICAgIGNvbnN0IGhpZXJhcmNoeVZhbHVlID0gaGllcmFyY2h5LmdldCh2YWwudmFsdWUpO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShoaWVyYXJjaHlWYWx1ZVtjaGlsZEtleV0pKSB7XG4gICAgICAgICAgICBoaWVyYXJjaHlWYWx1ZVtjaGlsZEtleV0gPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY2hpbGRDb2xsZWN0aW9uIHx8IGNoaWxkQ29sbGVjdGlvbi5zaXplID09PSAwKSB7XG4gICAgICAgICAgICBjb25zdCBkaW0gPSBoaWVyYXJjaHlWYWx1ZS5kaW1lbnNpb247XG4gICAgICAgICAgICBjb25zdCBpc1ZhbGlkID0gdGhpcy5leHRyYWN0VmFsdWVGcm9tRGltZW5zaW9uKGRpbSwgcmVjKSA9PT0gdmFsLnZhbHVlO1xuICAgICAgICAgICAgaWYgKGlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoaGllcmFyY2h5VmFsdWVbcmVjb3Jkc0tleV0pIHtcbiAgICAgICAgICAgICAgICAgICAgaGllcmFyY2h5VmFsdWVbcmVjb3Jkc0tleV0ucHVzaChyZWMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhpZXJhcmNoeVZhbHVlW3JlY29yZHNLZXldID0gW3JlY107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgaGllcmFyY2h5Q2hpbGQgPSBoaWVyYXJjaHlWYWx1ZVtjaGlsZEtleV07XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtfa2V5LCBjaGlsZF0gb2YgY2hpbGRDb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgbGV0IGhpZXJhcmNoeUNoaWxkVmFsdWUgPSBoaWVyYXJjaHlDaGlsZC5nZXQoY2hpbGQudmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmICghaGllcmFyY2h5Q2hpbGRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBoaWVyYXJjaHlDaGlsZC5zZXQoY2hpbGQudmFsdWUsIGNoaWxkKTtcbiAgICAgICAgICAgICAgICAgICAgaGllcmFyY2h5Q2hpbGRWYWx1ZSA9IGNoaWxkO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChoaWVyYXJjaHlDaGlsZFZhbHVlW3JlY29yZHNLZXldKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvcHkgPSBPYmplY3QuYXNzaWduKHt9LCByZWMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVjW3JlY29yZHNLZXldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBub3QgYWxsIG5lc3RlZCBjaGlsZHJlbiBhcmUgdmFsaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5lc3RlZFZhbHVlID0gaGllcmFyY2h5Q2hpbGRWYWx1ZS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpbWVuc2lvbiA9IGhpZXJhcmNoeUNoaWxkVmFsdWUuZGltZW5zaW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsaWRSZWNzID0gcmVjW3JlY29yZHNLZXldLmZpbHRlcih4ID0+IHRoaXMuZXh0cmFjdFZhbHVlRnJvbURpbWVuc2lvbihkaW1lbnNpb24sIHgpID09PSBuZXN0ZWRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb3B5W3JlY29yZHNLZXldID0gdmFsaWRSZWNzO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGhpZXJhcmNoeUNoaWxkVmFsdWVbcmVjb3Jkc0tleV0ucHVzaChjb3B5KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBoaWVyYXJjaHlDaGlsZFZhbHVlW3JlY29yZHNLZXldID0gW3JlY107XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkW2NoaWxkS2V5XSAmJiBjaGlsZFtjaGlsZEtleV0uc2l6ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBseUhpZXJhcmNoeUNoaWxkcmVuKGhpZXJhcmNoeUNoaWxkLCBjaGlsZCwgcmVjLCBwaXZvdEtleXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0QWdncmVnYXRlTGlzdCh2YWw6IElQaXZvdFZhbHVlLCBncmlkOiBQaXZvdEdyaWRUeXBlKTogSVBpdm90QWdncmVnYXRvcltdIHtcbiAgICAgICAgaWYgKCF2YWwuYWdncmVnYXRlTGlzdCkge1xuICAgICAgICAgICAgbGV0IGRlZmF1bHRBZ2dyID0gdGhpcy5nZXRBZ2dyZWdhdG9yc0ZvclZhbHVlKHZhbCwgZ3JpZCk7XG4gICAgICAgICAgICBjb25zdCBpc0RlZmF1bHQgPSBkZWZhdWx0QWdnci5maW5kKFxuICAgICAgICAgICAgICAgICh4KSA9PiB4LmtleSA9PT0gdmFsLmFnZ3JlZ2F0ZS5rZXlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICAvLyByZXNvbHZlIGN1c3RvbSBhZ2dyZWdhdGlvbnNcbiAgICAgICAgICAgIGlmICghaXNEZWZhdWx0ICYmIGdyaWQuZGF0YVswXVt2YWwubWVtYmVyXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgZmllbGQgZXhpc3RzLCB0aGVuIHdlIGNhbiBhcHBseSBkZWZhdWx0IGFnZ3JlZ2F0aW9ucyBhbmQgYWRkIHRoZSBjdXN0b20gb25lLlxuICAgICAgICAgICAgICAgIGRlZmF1bHRBZ2dyLnVuc2hpZnQodmFsLmFnZ3JlZ2F0ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCFpc0RlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UgdGhpcyBpcyBhIGN1c3RvbSBhZ2dyZWdhdGlvbiB0aGF0IGlzIG5vdCBjb21wYXRpYmxlXG4gICAgICAgICAgICAgICAgLy8gd2l0aCB0aGUgZGVmYXVsdHMsIHNpbmNlIGl0IG9wZXJhdGVzIG9uIGZpZWxkIHRoYXQgaXMgbm90IGluIHRoZSBkYXRhXG4gICAgICAgICAgICAgICAgLy8gbGVhdmUgb25seSB0aGUgY3VzdG9tIG9uZS5cbiAgICAgICAgICAgICAgICBkZWZhdWx0QWdnciA9IFt2YWwuYWdncmVnYXRlXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbC5hZ2dyZWdhdGVMaXN0ID0gZGVmYXVsdEFnZ3I7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbC5hZ2dyZWdhdGVMaXN0O1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0QWdncmVnYXRvcnNGb3JWYWx1ZSh2YWx1ZTogSVBpdm90VmFsdWUsIGdyaWQ6IFBpdm90R3JpZFR5cGUpOiBJUGl2b3RBZ2dyZWdhdG9yW10ge1xuICAgICAgICBjb25zdCBkYXRhVHlwZSA9IHZhbHVlLmRhdGFUeXBlIHx8IGdyaWQucmVzb2x2ZURhdGFUeXBlcyhncmlkLmRhdGFbMF1bdmFsdWUubWVtYmVyXSk7XG4gICAgICAgIHN3aXRjaCAoZGF0YVR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgR3JpZENvbHVtbkRhdGFUeXBlLk51bWJlcjpcbiAgICAgICAgICAgIGNhc2UgR3JpZENvbHVtbkRhdGFUeXBlLkN1cnJlbmN5OlxuICAgICAgICAgICAgICAgIHJldHVybiBJZ3hQaXZvdE51bWVyaWNBZ2dyZWdhdGUuYWdncmVnYXRvcnMoKTtcbiAgICAgICAgICAgIGNhc2UgR3JpZENvbHVtbkRhdGFUeXBlLkRhdGU6XG4gICAgICAgICAgICBjYXNlIEdyaWRDb2x1bW5EYXRhVHlwZS5EYXRlVGltZTpcbiAgICAgICAgICAgICAgICByZXR1cm4gSWd4UGl2b3REYXRlQWdncmVnYXRlLmFnZ3JlZ2F0b3JzKCk7XG4gICAgICAgICAgICBjYXNlIEdyaWRDb2x1bW5EYXRhVHlwZS5UaW1lOlxuICAgICAgICAgICAgICAgIHJldHVybiBJZ3hQaXZvdFRpbWVBZ2dyZWdhdGUuYWdncmVnYXRvcnMoKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIElneFBpdm90QWdncmVnYXRlLmFnZ3JlZ2F0b3JzKCk7XG4gICAgICAgIH1cbiAgICB9XG5cblxufVxuIl19