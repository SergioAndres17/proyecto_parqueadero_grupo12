import { Inject, Pipe } from '@angular/core';
import { SortingDirection } from '../data-operations/sorting-strategy';
import { IGX_COMBO_COMPONENT } from './combo.common';
import * as i0 from "@angular/core";
/** @hidden */
export class IgxComboFilteringPipe {
    transform(collection, searchValue, displayKey, filteringOptions, filterFunction = defaultFilterFunction, disableFiltering = false) {
        if (!collection) {
            return [];
        }
        if (disableFiltering) {
            return collection;
        }
        filteringOptions.filteringKey = filteringOptions.filteringKey ?? displayKey;
        return filterFunction(collection, searchValue, filteringOptions);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.4", ngImport: i0, type: IgxComboFilteringPipe, deps: [], target: i0.ɵɵFactoryTarget.Pipe }); }
    static { this.ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "18.2.4", ngImport: i0, type: IgxComboFilteringPipe, isStandalone: true, name: "comboFiltering" }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.4", ngImport: i0, type: IgxComboFilteringPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'comboFiltering',
                    standalone: true
                }]
        }] });
/** @hidden */
export class IgxComboGroupingPipe {
    constructor(combo) {
        this.combo = combo;
    }
    transform(collection, groupKey, valueKey, sortingDirection, compareCollator) {
        // TODO: should filteredData be changed here?
        this.combo.filteredData = collection;
        if ((!groupKey && groupKey !== 0) || !collection.length) {
            return collection;
        }
        const groups = Object.entries(groupBy(collection, (item) => item[groupKey] ?? 'Other'));
        if (sortingDirection !== SortingDirection.None) {
            const reverse = sortingDirection === SortingDirection.Desc ? -1 : 1;
            groups.sort((a, b) => {
                return compareCollator.compare(a[0], b[0]) * reverse;
            });
        }
        const result = groups.flatMap(([_, items]) => {
            items.unshift({
                isHeader: true,
                [valueKey]: items[0][groupKey],
                [groupKey]: items[0][groupKey]
            });
            return items;
        });
        return result;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.4", ngImport: i0, type: IgxComboGroupingPipe, deps: [{ token: IGX_COMBO_COMPONENT }], target: i0.ɵɵFactoryTarget.Pipe }); }
    static { this.ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "18.2.4", ngImport: i0, type: IgxComboGroupingPipe, isStandalone: true, name: "comboGrouping" }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.4", ngImport: i0, type: IgxComboGroupingPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'comboGrouping',
                    standalone: true
                }]
        }], ctorParameters: () => [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [IGX_COMBO_COMPONENT]
                }] }] });
function defaultFilterFunction(collection, searchValue, filteringOptions) {
    if (!searchValue) {
        return collection;
    }
    const { caseSensitive, filteringKey } = filteringOptions;
    const term = caseSensitive ? searchValue : searchValue.toLowerCase();
    return collection.filter(item => {
        const str = filteringKey ? `${item[filteringKey]}` : `${item}`;
        return (caseSensitive ? str : str.toLowerCase()).includes(term);
    });
}
function normalizeString(str, caseSensitive = false) {
    return (caseSensitive ? str : str.toLocaleLowerCase())
        .normalize('NFKD')
        .replace(/\p{M}/gu, '');
}
function groupBy(data, key) {
    const result = {};
    const _get = typeof key === 'function' ? key : (item) => item[key];
    for (const item of data) {
        const category = _get(item);
        const group = result[category];
        Array.isArray(group) ? group.push(item) : (result[category] = [item]);
    }
    return result;
}
/**
 * Combo filter function which does not distinguish between accented letters and their base letters.
 * For example, when filtering for "resume", this function will match both "resume" and "résumé".
 *
 * @example
 * ```html
 * <igx-combo [filterFunction]="comboIgnoreDiacriticFilterFunction"></igx-combo>
 * ```
 */
export function comboIgnoreDiacriticsFilter(collection, searchValue, filteringOptions) {
    if (!searchValue) {
        return collection;
    }
    const { caseSensitive, filteringKey } = filteringOptions;
    const term = normalizeString(searchValue, caseSensitive);
    return collection.filter(item => {
        const str = filteringKey ? `${item[filteringKey]}` : `${item}`;
        return normalizeString(str, caseSensitive).includes(term);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYm8ucGlwZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9pZ25pdGV1aS1hbmd1bGFyL3NyYy9saWIvY29tYm8vY29tYm8ucGlwZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBQzVELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBQ3ZFLE9BQU8sRUFBd0MsbUJBQW1CLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7QUFFM0YsY0FBYztBQUtkLE1BQU0sT0FBTyxxQkFBcUI7SUFDdkIsU0FBUyxDQUNaLFVBQWlCLEVBQ2pCLFdBQWdCLEVBQ2hCLFVBQWUsRUFDZixnQkFBd0MsRUFDeEMsaUJBQTJHLHFCQUFxQixFQUNoSSxtQkFBNEIsS0FBSztRQUNqQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDZCxPQUFPLEVBQUUsQ0FBQztRQUNkLENBQUM7UUFDRCxJQUFJLGdCQUFnQixFQUFFLENBQUM7WUFDbkIsT0FBTyxVQUFVLENBQUM7UUFDdEIsQ0FBQztRQUNELGdCQUFnQixDQUFDLFlBQVksR0FBRyxnQkFBZ0IsQ0FBQyxZQUFZLElBQUksVUFBVSxDQUFDO1FBQzVFLE9BQU8sY0FBYyxDQUFDLFVBQVUsRUFBRSxXQUFXLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztJQUNyRSxDQUFDOzhHQWhCUSxxQkFBcUI7NEdBQXJCLHFCQUFxQjs7MkZBQXJCLHFCQUFxQjtrQkFKakMsSUFBSTttQkFBQztvQkFDRixJQUFJLEVBQUUsZ0JBQWdCO29CQUN0QixVQUFVLEVBQUUsSUFBSTtpQkFDbkI7O0FBb0JELGNBQWM7QUFLZCxNQUFNLE9BQU8sb0JBQW9CO0lBRTdCLFlBQWdELEtBQW1CO1FBQW5CLFVBQUssR0FBTCxLQUFLLENBQWM7SUFBSSxDQUFDO0lBRWpFLFNBQVMsQ0FBQyxVQUFp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VUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUM1QixNQUFNLEdBQUcsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUM7UUFDL0QsT0FBTyxlQUFlLENBQUMsR0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5RCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIFBpcGUsIFBpcGVUcmFuc2Zvcm0gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFNvcnRpbmdEaXJlY3Rpb24gfSBmcm9tICcuLi9kYXRhLW9wZXJhdGlvbnMvc29ydGluZy1zdHJhdGVneSc7XG5pbXBvcnQgeyBJQ29tYm9GaWx0ZXJpbmdPcHRpb25zLCBJZ3hDb21ib0Jhc2UsIElHWF9DT01CT19DT01QT05FTlQgfSBmcm9tICcuL2NvbWJvLmNvbW1vbic7XG5cbi8qKiBAaGlkZGVuICovXG5AUGlwZSh7XG4gICAgbmFtZTogJ2NvbWJvRmlsdGVyaW5nJyxcbiAgICBzdGFuZGFsb25lOiB0cnVlXG59KVxuZXhwb3J0IGNsYXNzIElneENvbWJvRmlsdGVyaW5nUGlwZSBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xuICAgIHB1YmxpYyB0cmFuc2Zvcm0oXG4gICAgICAgIGNvbGxlY3Rpb246IGFueVtdLFxuICAgICAgICBzZWFyY2hWYWx1ZTogYW55LFxuICAgICAgICBkaXNwbGF5S2V5OiBhbnksXG4gICAgICAgIGZpbHRlcmluZ09wdGlvbnM6IElDb21ib0ZpbHRlcmluZ09wdGlvbnMsXG4gICAgICAgIGZpbHRlckZ1bmN0aW9uOiAoY29sbGVjdGlvbjogYW55W10sIHNlYXJjaFZhbHVlOiBhbnksIGZpbHRlcmluZ09wdGlvbnM6IElDb21ib0ZpbHRlcmluZ09wdGlvbnMpID0+IGFueVtdID0gZGVmYXVsdEZpbHRlckZ1bmN0aW9uLFxuICAgICAgICBkaXNhYmxlRmlsdGVyaW5nOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKCFjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRpc2FibGVGaWx0ZXJpbmcpIHtcbiAgICAgICAgICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGZpbHRlcmluZ09wdGlvbnMuZmlsdGVyaW5nS2V5ID0gZmlsdGVyaW5nT3B0aW9ucy5maWx0ZXJpbmdLZXkgPz8gZGlzcGxheUtleTtcbiAgICAgICAgcmV0dXJuIGZpbHRlckZ1bmN0aW9uKGNvbGxlY3Rpb24sIHNlYXJjaFZhbHVlLCBmaWx0ZXJpbmdPcHRpb25zKTtcbiAgICB9XG59XG5cbi8qKiBAaGlkZGVuICovXG5AUGlwZSh7XG4gICAgbmFtZTogJ2NvbWJvR3JvdXBpbmcnLFxuICAgIHN0YW5kYWxvbmU6IHRydWVcbn0pXG5leHBvcnQgY2xhc3MgSWd4Q29tYm9Hcm91cGluZ1BpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcblxuICAgIGNvbnN0cnVjdG9yKEBJbmplY3QoSUdYX0NPTUJPX0NPTVBPTkVOVCkgcHVibGljIGNvbWJvOiBJZ3hDb21ib0Jhc2UpIHsgfVxuXG4gICAgcHVibGljIHRyYW5zZm9ybShjb2xsZWN0aW9uOiBhbnlbXSwgZ3JvdXBLZXk6IGFueSwgdmFsdWVLZXk6IGFueSwgc29ydGluZ0RpcmVjdGlvbjogU29ydGluZ0RpcmVjdGlvbiwgY29tcGFyZUNvbGxhdG9yOiBJbnRsLkNvbGxhdG9yKSB7XG4gICAgICAgIC8vIFRPRE86IHNob3VsZCBmaWx0ZXJlZERhdGEgYmUgY2hhbmdlZCBoZXJlP1xuICAgICAgICB0aGlzLmNvbWJvLmZpbHRlcmVkRGF0YSA9IGNvbGxlY3Rpb247XG4gICAgICAgIGlmICgoIWdyb3VwS2V5ICYmIGdyb3VwS2V5ICE9PSAwKSB8fCAhY29sbGVjdGlvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGdyb3VwcyA9IE9iamVjdC5lbnRyaWVzKGdyb3VwQnkoY29sbGVjdGlvbiwgKGl0ZW0pID0+IGl0ZW1bZ3JvdXBLZXldID8/ICdPdGhlcicpKTtcbiAgICAgICAgaWYgKHNvcnRpbmdEaXJlY3Rpb24gIT09IFNvcnRpbmdEaXJlY3Rpb24uTm9uZSkge1xuICAgICAgICAgICAgY29uc3QgcmV2ZXJzZSA9IHNvcnRpbmdEaXJlY3Rpb24gPT09IFNvcnRpbmdEaXJlY3Rpb24uRGVzYyA/IC0xIDogMTtcbiAgICAgICAgICAgIGdyb3Vwcy5zb3J0KChhLGIpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29tcGFyZUNvbGxhdG9yLmNvbXBhcmUoYVswXSwgYlswXSkgKiByZXZlcnNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZ3JvdXBzLmZsYXRNYXAoKFtfLCBpdGVtc10pID0+IHtcbiAgICAgICAgICAgIGl0ZW1zLnVuc2hpZnQoe1xuICAgICAgICAgICAgICAgIGlzSGVhZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIFt2YWx1ZUtleV06IGl0ZW1zWzBdW2dyb3VwS2V5XSxcbiAgICAgICAgICAgICAgICBbZ3JvdXBLZXldOiBpdGVtc1swXVtncm91cEtleV1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZXR1cm4gaXRlbXM7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZGVmYXVsdEZpbHRlckZ1bmN0aW9uPFQ+KGNvbGxlY3Rpb246IFRbXSwgc2VhcmNoVmFsdWU6IHN0cmluZywgZmlsdGVyaW5nT3B0aW9uczogSUNvbWJvRmlsdGVyaW5nT3B0aW9ucyk6IFRbXSB7XG4gICAgaWYgKCFzZWFyY2hWYWx1ZSkge1xuICAgICAgICByZXR1cm4gY29sbGVjdGlvbjtcbiAgICB9XG5cbiAgICBjb25zdCB7IGNhc2VTZW5zaXRpdmUsIGZpbHRlcmluZ0tleSB9ID0gZmlsdGVyaW5nT3B0aW9ucztcbiAgICBjb25zdCB0ZXJtID0gY2FzZVNlbnNpdGl2ZSA/IHNlYXJjaFZhbHVlIDogc2VhcmNoVmFsdWUudG9Mb3dlckNhc2UoKTtcblxuICAgIHJldHVybiBjb2xsZWN0aW9uLmZpbHRlcihpdGVtID0+IHtcbiAgICAgICAgY29uc3Qgc3RyID0gZmlsdGVyaW5nS2V5ID8gYCR7aXRlbVtmaWx0ZXJpbmdLZXldfWAgOiBgJHtpdGVtfWA7XG4gICAgICAgIHJldHVybiAoY2FzZVNlbnNpdGl2ZSA/IHN0ciA6IHN0ci50b0xvd2VyQ2FzZSgpKS5pbmNsdWRlcyh0ZXJtKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplU3RyaW5nKHN0cjogc3RyaW5nLCBjYXNlU2Vuc2l0aXZlID0gZmFsc2UpOiBzdHJpbmcge1xuICAgIHJldHVybiAoY2FzZVNlbnNpdGl2ZSA/IHN0ciA6IHN0ci50b0xvY2FsZUxvd2VyQ2FzZSgpKVxuICAgICAgICAubm9ybWFsaXplKCdORktEJylcbiAgICAgICAgLnJlcGxhY2UoL1xccHtNfS9ndSwgJycpO1xufVxuXG5mdW5jdGlvbiBncm91cEJ5PFQ+KGRhdGE6IFRbXSwga2V5OiBrZXlvZiBUIHwgKChpdGVtOiBUKSA9PiBhbnkpKSB7XG4gICAgY29uc3QgcmVzdWx0OiBSZWNvcmQ8c3RyaW5nLCBUW10+ID0ge307XG4gICAgY29uc3QgX2dldCA9IHR5cGVvZiBrZXkgPT09ICdmdW5jdGlvbicgPyBrZXkgOiAoaXRlbTogVCkgPT4gaXRlbVtrZXldO1xuXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGRhdGEpIHtcbiAgICAgIGNvbnN0IGNhdGVnb3J5ID0gX2dldChpdGVtKTtcbiAgICAgIGNvbnN0IGdyb3VwID0gcmVzdWx0W2NhdGVnb3J5XTtcblxuICAgICAgQXJyYXkuaXNBcnJheShncm91cCkgPyBncm91cC5wdXNoKGl0ZW0pIDogKHJlc3VsdFtjYXRlZ29yeV0gPSBbaXRlbV0pO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogQ29tYm8gZmlsdGVyIGZ1bmN0aW9uIHdoaWNoIGRvZXMgbm90IGRpc3Rpbmd1aXNoIGJldHdlZW4gYWNjZW50ZWQgbGV0dGVycyBhbmQgdGhlaXIgYmFzZSBsZXR0ZXJzLlxuICogRm9yIGV4YW1wbGUsIHdoZW4gZmlsdGVyaW5nIGZvciBcInJlc3VtZVwiLCB0aGlzIGZ1bmN0aW9uIHdpbGwgbWF0Y2ggYm90aCBcInJlc3VtZVwiIGFuZCBcInLDqXN1bcOpXCIuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGh0bWxcbiAqIDxpZ3gtY29tYm8gW2ZpbHRlckZ1bmN0aW9uXT1cImNvbWJvSWdub3JlRGlhY3JpdGljRmlsdGVyRnVuY3Rpb25cIj48L2lneC1jb21ibz5cbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gY29tYm9JZ25vcmVEaWFjcml0aWNzRmlsdGVyPFQ+KGNvbGxlY3Rpb246IFRbXSwgc2VhcmNoVmFsdWU6IHN0cmluZywgZmlsdGVyaW5nT3B0aW9uczogSUNvbWJvRmlsdGVyaW5nT3B0aW9ucyk6IFRbXSB7XG4gICAgaWYgKCFzZWFyY2hWYWx1ZSkge1xuICAgICAgICByZXR1cm4gY29sbGVjdGlvbjtcbiAgICB9XG5cbiAgICBjb25zdCB7IGNhc2VTZW5zaXRpdmUsIGZpbHRlcmluZ0tleSB9ID0gZmlsdGVyaW5nT3B0aW9ucztcbiAgICBjb25zdCB0ZXJtID0gbm9ybWFsaXplU3RyaW5nKHNlYXJjaFZhbHVlLCBjYXNlU2Vuc2l0aXZlKTtcblxuICAgIHJldHVybiBjb2xsZWN0aW9uLmZpbHRlcihpdGVtID0+IHtcbiAgICAgICAgY29uc3Qgc3RyID0gZmlsdGVyaW5nS2V5ID8gYCR7aXRlbVtmaWx0ZXJpbmdLZXldfWAgOiBgJHtpdGVtfWA7XG4gICAgICAgIHJldHVybiBub3JtYWxpemVTdHJpbmcoc3RyLCBjYXNlU2Vuc2l0aXZlKS5pbmNsdWRlcyh0ZXJtKTtcbiAgICB9KTtcbn1cbiJdfQ==